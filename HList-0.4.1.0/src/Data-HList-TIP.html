<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Data/HList/TIP.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>{- |
<a name="line-4"></a>   The HList library
<a name="line-5"></a>
<a name="line-6"></a>   (C) 2004, Oleg Kiselyov, Ralf Laemmel, Keean Schupke
<a name="line-7"></a>
<a name="line-8"></a>   Type-indexed products.
<a name="line-9"></a>   The public interface is described in
<a name="line-10"></a>   &lt;Data-HList-CommonMain.html#t:TIP CommonMain#TIP&gt;
<a name="line-11"></a>-}</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>TIP</span>
<a name="line-14"></a>  <span class='hs-layout'>(</span><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>TIPtuple</span><span class='hs-layout'>,</span>
<a name="line-15"></a>   <span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>TIP</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-16"></a>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HListPrelude</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>FakePrelude</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>Record</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HTypeIndexed</span> <span class='hs-conid'>()</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HOccurs</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>TIPtuple</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-varid'>intercalate</span><span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ix</span><span class='hs-layout'>)</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>LensDefs</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-31"></a><span class='hs-comment'>-- * The newtype for type-indexed products</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="TIP"></a><span class='hs-comment'>-- | TIPs are like 'Record', except element \"i\" of the list \"l\"</span>
<a name="line-34"></a><a name="TIP"></a><span class='hs-comment'>-- has type @Tagged e_i e_i@</span>
<a name="line-35"></a><a name="TIP"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TIP</span><span class='hs-layout'>{</span><span class='hs-varid'>unTIP</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>}</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-38"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Ord</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Ix</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-41"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bounded</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bounded</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a>
<a name="line-44"></a><a name="instance%20Show%20(TIP%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapOut</span> <span class='hs-layout'>(</span><span class='hs-conid'>HShow</span> <span class='hs-varop'>`HComp`</span> <span class='hs-conid'>HUntag</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-45"></a>  <span class='hs-varid'>showsPrec</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-str'>"TIPH["</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span>
<a name="line-46"></a>                              <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>intercalate</span> <span class='hs-str'>","</span> <span class='hs-layout'>(</span><span class='hs-varid'>hMapOut</span> <span class='hs-layout'>(</span><span class='hs-conid'>HShow</span> <span class='hs-varop'>`HComp`</span> <span class='hs-conid'>HUntag</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span>
<a name="line-47"></a>                              <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-chr'>']'</span> <span class='hs-conop'>:</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a>
<a name="line-50"></a><a name="mkTIP"></a><span class='hs-definition'>mkTIP</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span>
<a name="line-51"></a><span class='hs-definition'>mkTIP</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TIP</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="emptyTIP"></a><span class='hs-definition'>emptyTIP</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TIP</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-54"></a><span class='hs-definition'>emptyTIP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkTIP</span> <span class='hs-conid'>HNil</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-57"></a><span class='hs-comment'>-- * Type-indexed type sequences</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="HTypeIndexed"></a><span class='hs-comment'>-- | this constraint ensures that a TIP created by 'mkTIP' has no</span>
<a name="line-60"></a><a name="HTypeIndexed"></a><span class='hs-comment'>-- duplicates</span>
<a name="line-61"></a><a name="HTypeIndexed"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAllTaggedEq</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-conid'>HRLabelSet</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="instance%20HTypeIndexed%20l%20class%20HAllTaggedEq%20(l%20::%20%5b*%5d)%20instance%20HAllTaggedEq%20'%5b%5d%20instance%20(HAllTaggedEq%20l,%20tee%20~%20Tagged%20e%20e')%20=%3e%20HAllTaggedEq%20(tee%20':%20l)%20--%20--------------------------------------------------------------------------%20--%20Implementing%20the%20HListPrelude%20interface%20instance%20(HRLabelSet%20(Tagged%20e%20e%20':%20l),%20HTypeIndexed%20l)%20=%3e%20HExtend%20e%20(TIP%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAllTaggedEq</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-conid'>HRLabelSet</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>l</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="HAllTaggedEq"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HAllTaggedEq</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-66"></a><a name="instance%20HAllTaggedEq%20(tee%20':%20l)%20--%20--------------------------------------------------------------------------%20--%20Implementing%20the%20HListPrelude%20interface%20instance%20(HRLabelSet%20(Tagged%20e%20e%20':%20l),%20HTypeIndexed%20l)%20=%3e%20HExtend%20e%20(TIP%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAllTaggedEq</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-67"></a><a name="instance%20HAllTaggedEq%20(tee%20':%20l)%20--%20--------------------------------------------------------------------------%20--%20Implementing%20the%20HListPrelude%20interface%20instance%20(HRLabelSet%20(Tagged%20e%20e%20':%20l),%20HTypeIndexed%20l)%20=%3e%20HExtend%20e%20(TIP%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAllTaggedEq</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>tee</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAllTaggedEq</span> <span class='hs-layout'>(</span><span class='hs-varid'>tee</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-68"></a>
<a name="line-69"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-70"></a><span class='hs-comment'>-- Implementing the HListPrelude interface</span>
<a name="line-71"></a>
<a name="line-72"></a><a name="instance%20HExtend%20e%20(TIP%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HRLabelSet</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HExtend</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-73"></a> <span class='hs-keyword'>where</span>
<a name="line-74"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HExtendR</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-75"></a>  <span class='hs-varid'>e</span> <span class='hs-varop'>.*.</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkTIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-76"></a>
<a name="line-77"></a>
<a name="line-78"></a>
<a name="line-79"></a><a name="instance%20HasField%20e%20(TIP%20l)%20e'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>e'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HasField</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>Record</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HasField</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>e'</span> <span class='hs-keyword'>where</span>
<a name="line-80"></a>    <span class='hs-varid'>hLookupByLabel</span> <span class='hs-varid'>lab</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hLookupByLabel</span> <span class='hs-varid'>lab</span> <span class='hs-layout'>(</span><span class='hs-conid'>Record</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-81"></a>
<a name="line-82"></a><span class='hs-comment'>-- | One occurrence and nothing is left</span>
<a name="line-83"></a><span class='hs-comment'>--</span>
<a name="line-84"></a><span class='hs-comment'>-- This variation provides an extra feature for singleton lists.</span>
<a name="line-85"></a><span class='hs-comment'>-- That is, the result type is unified with the element in the list.</span>
<a name="line-86"></a><span class='hs-comment'>-- Hence the explicit provision of a result type can be omitted.</span>
<a name="line-87"></a><span class='hs-comment'>--</span>
<a name="line-88"></a>
<a name="line-89"></a><a name="instance%20HOccurs%20e%20(TIP%20'%5btee%5d)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>tee</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HOccurs</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>tee</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-90"></a>  <span class='hs-varid'>hOccurs</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="instance%20HOccurs%20e%20(TIP%20(x%20':%20y%20':%20l))"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HasField</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>Record</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-93"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HOccurs</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-94"></a>  <span class='hs-varid'>hOccurs</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Record</span> <span class='hs-varid'>l</span> <span class='hs-varop'>.!.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Label</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Label</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-95"></a>
<a name="line-96"></a>
<a name="line-97"></a><a name="instance%20HAppend%20(TIP%20l)%20(TIP%20l')"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppend</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-98"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppend</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-99"></a> <span class='hs-keyword'>where</span>
<a name="line-100"></a>  <span class='hs-varid'>hAppend</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkTIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>hAppend</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-101"></a>
<a name="line-102"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendR</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-103"></a>
<a name="line-104"></a>
<a name="line-105"></a><span class='hs-comment'>-- instance HOccurrence HList e l l' =&gt; HOccurrence TIP e l l'</span>
<a name="line-106"></a><span class='hs-comment'>--  where</span>
<a name="line-107"></a><span class='hs-comment'>--   hOccurrence e = TIP . hOccurrence e . unTIP</span>
<a name="line-108"></a>
<a name="line-109"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-110"></a><span class='hs-comment'>-- * Shielding type-indexed operations</span>
<a name="line-111"></a><span class='hs-comment'>-- $note The absence of signatures is deliberate! They all must be inferred.</span>
<a name="line-112"></a>
<a name="line-113"></a><a name="onRecord"></a><span class='hs-definition'>onRecord</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-conid'>Record</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Record</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>mkTIP</span> <span class='hs-varid'>l'</span>
<a name="line-114"></a>
<a name="line-115"></a><a name="instance%20HDeleteAtLabel%20TIP%20e%20v%20v'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HDeleteAtLabel</span> <span class='hs-conid'>Record</span> <span class='hs-varid'>e</span> <span class='hs-varid'>v</span> <span class='hs-varid'>v'</span><span class='hs-layout'>,</span>
<a name="line-116"></a>          <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>v'</span><span class='hs-layout'>)</span>
<a name="line-117"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HDeleteAtLabel</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>e</span> <span class='hs-varid'>v</span> <span class='hs-varid'>v'</span> <span class='hs-keyword'>where</span>
<a name="line-118"></a>  <span class='hs-varid'>hDeleteAtLabel</span> <span class='hs-varid'>e</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onRecord</span> <span class='hs-layout'>(</span><span class='hs-varid'>hDeleteAtLabel</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span>
<a name="line-119"></a>
<a name="line-120"></a>
<a name="line-121"></a><a name="tipyUpdate"></a><span class='hs-definition'>tipyUpdate</span>  <span class='hs-varid'>e</span> <span class='hs-varid'>t</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hTPupdateAtLabel</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromValue</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-varid'>t</span>
<a name="line-122"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>fromValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Label</span> <span class='hs-varid'>e</span>
<a name="line-123"></a>        <span class='hs-varid'>fromValue</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Label</span>
<a name="line-124"></a>
<a name="line-125"></a><a name="instance%20HUpdateAtLabel%20TIP%20e'%20e%20r%20r'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HUpdateAtLabel</span> <span class='hs-conid'>Record</span> <span class='hs-varid'>e'</span> <span class='hs-varid'>e</span> <span class='hs-varid'>r</span> <span class='hs-varid'>r'</span><span class='hs-layout'>,</span>
<a name="line-126"></a>          <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>r'</span><span class='hs-layout'>,</span>
<a name="line-127"></a>         <span class='hs-varid'>e</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HUpdateAtLabel</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>e'</span> <span class='hs-varid'>e</span> <span class='hs-varid'>r</span> <span class='hs-varid'>r'</span> <span class='hs-keyword'>where</span>
<a name="line-128"></a>  <span class='hs-varid'>hUpdateAtLabel</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onRecord</span> <span class='hs-layout'>(</span><span class='hs-varid'>hUpdateAtLabel</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-129"></a>
<a name="line-130"></a>
<a name="line-131"></a><a name="tipyProject"></a><span class='hs-comment'>-- | Use 'Labels' to specify the first argument</span>
<a name="line-132"></a><span class='hs-definition'>tipyProject</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onRecord</span> <span class='hs-layout'>(</span><span class='hs-varid'>hProjectByLabels</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span>
<a name="line-133"></a>
<a name="line-134"></a><span class='hs-comment'>-- | provides a @Lens' (TIP s) a@. 'hLens'' @:: Label a -&gt; Lens' (TIP s) a@</span>
<a name="line-135"></a><span class='hs-comment'>-- is another option.</span>
<a name="line-136"></a><span class='hs-cpp'>#if __GLASGOW_HASKELL__ &lt; 707</span>
<a name="line-137"></a><a name="tipyLens'"></a><span class='hs-definition'>tipyLens'</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>tipyLens</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- rejected by GHC-7.10RC1</span>
<a name="line-138"></a><span class='hs-cpp'>#else</span>
<a name="line-139"></a><span class='hs-definition'>tipyLens'</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>hLens</span> <span class='hs-varid'>x</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>asTIP</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- rejected by GHC-7.6.3</span>
<a name="line-140"></a>  <span class='hs-keyword'>where</span>
<a name="line-141"></a>    <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getA</span> <span class='hs-varid'>f</span>
<a name="line-142"></a>    <span class='hs-varid'>getA</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Label</span> <span class='hs-varid'>a</span>
<a name="line-143"></a>    <span class='hs-varid'>getA</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Label</span>
<a name="line-144"></a>
<a name="line-145"></a>    <span class='hs-varid'>asTIP</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span>
<a name="line-146"></a>    <span class='hs-varid'>asTIP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-147"></a><span class='hs-cpp'>#endif</span>
<a name="line-148"></a>
<a name="line-149"></a><a name="tipyLens"></a><span class='hs-comment'>{- | provides a @Lens (TIP s) (TIP t) a b@
<a name="line-150"></a>
<a name="line-151"></a>When using @set@ (also known as @.~@), 'tipyLens'' can address the
<a name="line-152"></a>ambiguity as to which field \"a\" should actually be updated.
<a name="line-153"></a>
<a name="line-154"></a>-}</span>
<a name="line-155"></a><span class='hs-definition'>tipyLens</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hLens</span> <span class='hs-varid'>x</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>asTIP</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-156"></a>  <span class='hs-keyword'>where</span>
<a name="line-157"></a>    <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getA</span> <span class='hs-varid'>f</span>
<a name="line-158"></a>    <span class='hs-varid'>getA</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Label</span> <span class='hs-varid'>a</span>
<a name="line-159"></a>    <span class='hs-varid'>getA</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Label</span>
<a name="line-160"></a>
<a name="line-161"></a>    <span class='hs-varid'>asTIP</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span>
<a name="line-162"></a>    <span class='hs-varid'>asTIP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-163"></a>
<a name="line-164"></a>
<a name="line-165"></a><a name="tipyProject2"></a><span class='hs-comment'>-- | The same as 'tipyProject', except also return the</span>
<a name="line-166"></a><span class='hs-comment'>-- types not requested in the @proxy@ argument</span>
<a name="line-167"></a><span class='hs-definition'>tipyProject2</span> <span class='hs-varid'>ps</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTIP</span> <span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>mkTIP</span> <span class='hs-varid'>l''</span><span class='hs-layout'>)</span>
<a name="line-168"></a> <span class='hs-keyword'>where</span>
<a name="line-169"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>h2projectByLabels</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>l</span>
<a name="line-170"></a>
<a name="line-171"></a>
<a name="line-172"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-173"></a>
<a name="line-174"></a><span class='hs-comment'>-- | Subtyping for TIPs</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="instance%20SubType%20(TIP%20l1)%20(TIP%20(e%20':%20l2))%20--%20--------------------------------------------------------------------------%20--%20*%20conversion%20to%20and%20from%20'HList'%20%7b-%20%7c%20'TagR'%20can%20also%20be%20used%20to%20avoid%20redundancy%20when%20defining%20types%20for%20TIC%20and%20TIP.%20%3e%20type%20XShort%20=%20TagR%20%5bA,B,C,D%5d%20%3e%20type%20XLong%20=%20%5bTagged%20A%20A,%20Tagged%20B%20B,%20Tagged%20C%20C,%20Tagged%20D%20D%5d%20an%20equivalent%20FD%20version,%20which%20is%20slightly%20better%20with%20respect%20to%20simplifying%20types%20containing%20type%20variables%20(in%20ghc-7.8%20and%207.6):%20%3chttp://stackoverflow.com/questions/24110410/%3e%20With%20ghc-7.10%20(%3chttp://ghc.haskell.org/trac/ghc/ticket/10009%3e)%20the%20FD%20version%20is%20superior%20to%20the%20TF%20version:%20@%20class%20(UntagR%20(TagR%20a)%20~%20a)%20=%3e%20TagUntag%20a%20where%20type%20TagR%20a%20::%20%5b*%5d%20hTagSelf%20::%20HList%20a%20-%3e%20HList%20(TagR%20a)%20hUntagSelf%20::%20HList%20(TagR%20a)%20-%3e%20HList%20a%20instance%20TagUntag%20'%5b%5d%20where%20type%20TagR%20'%5b%5d%20=%20'%5b%5d%20hTagSelf%20_%20=%20HNil%20hUntagSelf%20_%20=%20HNil%20instance%20TagUntag%20xs%20=%3e%20TagUntag%20(x%20':%20xs)%20where%20type%20TagR%20(x%20':%20xs)%20=%20Tagged%20x%20x%20':%20TagR%20xs%20hTagSelf%20(HCons%20x%20xs)%20=%20Tagged%20x%20%60HCons%60%20hTagSelf%20xs%20hUntagSelf%20(HCons%20(Tagged%20x)%20xs)%20=%20x%20%60HCons%60%20hUntagSelf%20xs%20type%20family%20UntagR%20(xs%20::%20%5b*%5d)%20::%20%5b*%5d%20type%20instance%20UntagR%20'%5b%5d%20=%20'%5b%5d%20type%20instance%20UntagR%20(x%20':%20xs)%20=%20Untag1%20x%20':%20UntagR%20xs%20@%20Length%20information%20should%20flow%20backwards%20%3e%3e%3e%20let%20len2%20x%20=%20x%20%60asTypeOf%60%20(undefined%20::%20HList%20'%5ba,b%5d)%20%3e%3e%3e%20let%20f%20=%20len2%20$%20hTagSelf%20(hReplicate%20Proxy%20())%20%3e%3e%3e%20:t%20f%20f%20::%20HList%20'%5bTagged%20()%20(),%20Tagged%20()%20()%5d%20-%7d%20class%20SameLength%20a%20ta%20=%3e%20TagUntagFD%20a%20ta%20%7c%20a%20-%3e%20ta,%20ta%20-%3e%20a"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>SubType</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-177"></a><a name="instance%20SubType%20(TIP%20l1)%20(TIP%20(e%20':%20l2))%20--%20--------------------------------------------------------------------------%20--%20*%20conversion%20to%20and%20from%20'HList'%20%7b-%20%7c%20'TagR'%20can%20also%20be%20used%20to%20avoid%20redundancy%20when%20defining%20types%20for%20TIC%20and%20TIP.%20%3e%20type%20XShort%20=%20TagR%20%5bA,B,C,D%5d%20%3e%20type%20XLong%20=%20%5bTagged%20A%20A,%20Tagged%20B%20B,%20Tagged%20C%20C,%20Tagged%20D%20D%5d%20an%20equivalent%20FD%20version,%20which%20is%20slightly%20better%20with%20respect%20to%20simplifying%20types%20containing%20type%20variables%20(in%20ghc-7.8%20and%207.6):%20%3chttp://stackoverflow.com/questions/24110410/%3e%20With%20ghc-7.10%20(%3chttp://ghc.haskell.org/trac/ghc/ticket/10009%3e)%20the%20FD%20version%20is%20superior%20to%20the%20TF%20version:%20@%20class%20(UntagR%20(TagR%20a)%20~%20a)%20=%3e%20TagUntag%20a%20where%20type%20TagR%20a%20::%20%5b*%5d%20hTagSelf%20::%20HList%20a%20-%3e%20HList%20(TagR%20a)%20hUntagSelf%20::%20HList%20(TagR%20a)%20-%3e%20HList%20a%20instance%20TagUntag%20'%5b%5d%20where%20type%20TagR%20'%5b%5d%20=%20'%5b%5d%20hTagSelf%20_%20=%20HNil%20hUntagSelf%20_%20=%20HNil%20instance%20TagUntag%20xs%20=%3e%20TagUntag%20(x%20':%20xs)%20where%20type%20TagR%20(x%20':%20xs)%20=%20Tagged%20x%20x%20':%20TagR%20xs%20hTagSelf%20(HCons%20x%20xs)%20=%20Tagged%20x%20%60HCons%60%20hTagSelf%20xs%20hUntagSelf%20(HCons%20(Tagged%20x)%20xs)%20=%20x%20%60HCons%60%20hUntagSelf%20xs%20type%20family%20UntagR%20(xs%20::%20%5b*%5d)%20::%20%5b*%5d%20type%20instance%20UntagR%20'%5b%5d%20=%20'%5b%5d%20type%20instance%20UntagR%20(x%20':%20xs)%20=%20Untag1%20x%20':%20UntagR%20xs%20@%20Length%20information%20should%20flow%20backwards%20%3e%3e%3e%20let%20len2%20x%20=%20x%20%60asTypeOf%60%20(undefined%20::%20HList%20'%5ba,b%5d)%20%3e%3e%3e%20let%20f%20=%20len2%20$%20hTagSelf%20(hReplicate%20Proxy%20())%20%3e%3e%3e%20:t%20f%20f%20::%20HList%20'%5bTagged%20()%20(),%20Tagged%20()%20()%5d%20-%7d%20class%20SameLength%20a%20ta%20=%3e%20TagUntagFD%20a%20ta%20%7c%20a%20-%3e%20ta,%20ta%20-%3e%20a"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HOccurs</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>SubType</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-178"></a>      <span class='hs-keyglyph'>=&gt;</span>  <span class='hs-conid'>SubType</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-179"></a>
<a name="line-180"></a>
<a name="line-181"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-182"></a><span class='hs-comment'>-- * conversion to and from 'HList'</span>
<a name="line-183"></a>
<a name="line-184"></a><a name="TagUntagFD"></a><span class='hs-comment'>{- | 'TagR' can also be used to avoid redundancy when defining types for TIC and TIP.
<a name="line-185"></a>
<a name="line-186"></a>&gt;  type XShort = TagR [A,B,C,D]
<a name="line-187"></a>
<a name="line-188"></a>&gt;  type XLong = [Tagged A A, Tagged B B, Tagged C C, Tagged D D]
<a name="line-189"></a>
<a name="line-190"></a>
<a name="line-191"></a>an equivalent FD version, which is slightly better with respect to
<a name="line-192"></a>simplifying types containing type variables (in ghc-7.8 and 7.6):
<a name="line-193"></a>&lt;<a href="http://stackoverflow.com/questions/24110410/">http://stackoverflow.com/questions/24110410/</a>&gt;
<a name="line-194"></a>
<a name="line-195"></a>With ghc-7.10 (&lt;<a href="http://ghc.haskell.org/trac/ghc/ticket/10009">http://ghc.haskell.org/trac/ghc/ticket/10009</a>&gt;) the FD version is superior
<a name="line-196"></a>to the TF version:
<a name="line-197"></a>
<a name="line-198"></a>@
<a name="line-199"></a>class (UntagR (TagR a) ~ a) =&gt; TagUntag a where
<a name="line-200"></a>    type TagR a :: [*]
<a name="line-201"></a>    hTagSelf :: HList a -&gt; HList (TagR a)
<a name="line-202"></a>    hUntagSelf :: HList (TagR a) -&gt; HList a
<a name="line-203"></a>
<a name="line-204"></a>instance TagUntag '[] where
<a name="line-205"></a>    type TagR '[] = '[]
<a name="line-206"></a>    hTagSelf _ = HNil
<a name="line-207"></a>    hUntagSelf _ = HNil
<a name="line-208"></a>
<a name="line-209"></a>instance TagUntag xs =&gt; TagUntag (x ': xs) where
<a name="line-210"></a>    type TagR (x ': xs) = Tagged x x ': TagR xs
<a name="line-211"></a>    hTagSelf (HCons x xs) = Tagged x `HCons` hTagSelf xs
<a name="line-212"></a>    hUntagSelf (HCons (Tagged x) xs) = x `HCons` hUntagSelf xs
<a name="line-213"></a>
<a name="line-214"></a>type family UntagR (xs :: [*]) :: [*]
<a name="line-215"></a>type instance UntagR '[] = '[]
<a name="line-216"></a>type instance UntagR (x ': xs) = Untag1 x ': UntagR xs
<a name="line-217"></a>@
<a name="line-218"></a>
<a name="line-219"></a>Length information should flow backwards
<a name="line-220"></a>
<a name="line-221"></a>&gt;&gt;&gt; let len2 x = x `asTypeOf` (undefined :: HList '[a,b])
<a name="line-222"></a>&gt;&gt;&gt; let f = len2 $ hTagSelf (hReplicate Proxy ())
<a name="line-223"></a>&gt;&gt;&gt; :t f
<a name="line-224"></a>f :: HList '[Tagged () (), Tagged () ()]
<a name="line-225"></a>
<a name="line-226"></a>-}</span>
<a name="line-227"></a><a name="TagUntagFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>SameLength</span> <span class='hs-varid'>a</span> <span class='hs-varid'>ta</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TagUntagFD</span> <span class='hs-varid'>a</span> <span class='hs-varid'>ta</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ta</span><span class='hs-layout'>,</span> <span class='hs-varid'>ta</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-228"></a>    <span class='hs-varid'>hTagSelf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ta</span>
<a name="line-229"></a>    <span class='hs-varid'>hUntagSelf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ta</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span>
<a name="line-230"></a>
<a name="line-231"></a><a name="instance%20TagUntagFD%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>TagUntagFD</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-232"></a>    <span class='hs-varid'>hTagSelf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-233"></a>    <span class='hs-varid'>hUntagSelf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-234"></a>
<a name="line-235"></a><a name="instance%20TagUntagFD%20(x%20':%20xs)%20(txx%20':%20ys)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>TagUntagFD</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span><span class='hs-layout'>,</span> <span class='hs-varid'>txx</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>x</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-236"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TagUntagFD</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>txx</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-237"></a>    <span class='hs-varid'>hTagSelf</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hTagSelf</span> <span class='hs-varid'>xs</span>
<a name="line-238"></a>    <span class='hs-varid'>hUntagSelf</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hUntagSelf</span> <span class='hs-varid'>xs</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="TagUntag"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TagUntag</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TagUntagFD</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-conid'>TagR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-241"></a>
<a name="line-242"></a><a name="UntagTag"></a><span class='hs-comment'>-- | Sometimes the type variables available have @TagR@ already applied</span>
<a name="line-243"></a><a name="UntagTag"></a><span class='hs-comment'>-- (ie the lists have elements like @Tagged X X@). Then this abbreviation</span>
<a name="line-244"></a><a name="UntagTag"></a><span class='hs-comment'>-- is useful:</span>
<a name="line-245"></a><a name="UntagTag"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TagUntagFD</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-246"></a>
<a name="line-247"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>TagR</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-248"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>UntagR</span> <span class='hs-layout'>(</span><span class='hs-varid'>ta</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-249"></a>
<a name="line-250"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>TagR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-251"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>UntagR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-252"></a>
<a name="line-253"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>TagR</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>x</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>TagR</span> <span class='hs-varid'>xs</span>
<a name="line-254"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>UntagR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>y</span> <span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>UntagR</span> <span class='hs-varid'>ys</span>
<a name="line-255"></a>
<a name="line-256"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>Untag1</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span>
<a name="line-257"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Untag1</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-258"></a>
<a name="line-259"></a>
<a name="line-260"></a><a name="tipHList"></a><span class='hs-comment'>-- | @Iso (TIP (TagR a)) (TIP (TagR b)) (HList a) (HList b)@</span>
<a name="line-261"></a><span class='hs-definition'>tipHList</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iso</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hUntagSelf</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hTagSelf</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span>
<a name="line-262"></a>
<a name="line-263"></a><a name="tipHList'"></a><span class='hs-comment'>-- | @Iso' (TIP (TagR s)) (HList a)@</span>
<a name="line-264"></a><span class='hs-definition'>tipHList'</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>tipHList</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-265"></a>
<a name="line-266"></a>
<a name="line-267"></a><span class='hs-comment'>-- * conversion to and from 'Record'</span>
<a name="line-268"></a>
<a name="line-269"></a><a name="tipRecord"></a><span class='hs-comment'>-- | @Iso (TIP s) (TIP t) (Record s) (Record t)@</span>
<a name="line-270"></a><span class='hs-comment'>--</span>
<a name="line-271"></a><span class='hs-comment'>-- 'typeIndexed' may be more appropriate</span>
<a name="line-272"></a><span class='hs-definition'>tipRecord</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isoNewtype</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Record</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>Record</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span>
<a name="line-273"></a>
<a name="line-274"></a><a name="tipRecord'"></a><span class='hs-comment'>-- | @Iso' (TIP (TagR s)) (Record a)@</span>
<a name="line-275"></a><span class='hs-definition'>tipRecord'</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>tipRecord</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-276"></a>
<a name="line-277"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-278"></a><span class='hs-comment'>-- * Zip</span>
<a name="line-279"></a>
<a name="line-280"></a><a name="instance%20HZip%20TIP%20x%20y%20xy"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HZipList</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-281"></a>          <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>xy</span><span class='hs-layout'>,</span>
<a name="line-282"></a>          <span class='hs-conid'>SameLengths</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span><span class='hs-varid'>xy</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-283"></a>          <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span>
<a name="line-284"></a>          <span class='hs-conid'>HUnzip</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span>
<a name="line-285"></a>          <span class='hs-comment'>-- HTypeIndexed xy is always satisfied given the above</span>
<a name="line-286"></a>          <span class='hs-comment'>-- constraints (with a handwaving proof), so don't require</span>
<a name="line-287"></a>          <span class='hs-comment'>-- callers of hZip/hUnzip to supply such proof</span>
<a name="line-288"></a>    <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HZip</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span> <span class='hs-keyword'>where</span>
<a name="line-289"></a>  <span class='hs-varid'>hZip</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hZipTIP</span>
<a name="line-290"></a>
<a name="line-291"></a>
<a name="line-292"></a><a name="instance%20HUnzip%20TIP%20x%20y%20xy"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HZipList</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>UntagR</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-293"></a>          <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-conid'>UntagTag</span> <span class='hs-varid'>xy</span><span class='hs-layout'>,</span>
<a name="line-294"></a>          <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTypeIndexed</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span>
<a name="line-295"></a>          <span class='hs-conid'>SameLengths</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span><span class='hs-varid'>xy</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HUnzip</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span> <span class='hs-keyword'>where</span>
<a name="line-296"></a>  <span class='hs-varid'>hUnzip</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hUnzipTIP</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="hZipTIP"></a><span class='hs-comment'>-- | specialization of 'hZip'</span>
<a name="line-299"></a><span class='hs-definition'>hZipTIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>hTagSelf</span> <span class='hs-layout'>(</span><span class='hs-varid'>hZipList</span> <span class='hs-layout'>(</span><span class='hs-varid'>hUntagSelf</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hUntagSelf</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-300"></a>
<a name="line-301"></a><a name="hUnzipTIP"></a><span class='hs-comment'>-- | specialization of 'hUnzip'</span>
<a name="line-302"></a><span class='hs-definition'>hUnzipTIP</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hUnzipList</span> <span class='hs-layout'>(</span><span class='hs-varid'>hUntagSelf</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-303"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>hTagSelf</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTIP</span> <span class='hs-layout'>(</span><span class='hs-varid'>hTagSelf</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-304"></a>
<a name="line-305"></a>
<a name="line-306"></a>
<a name="line-307"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-308"></a><span class='hs-comment'>-- * TIP Transform</span>
<a name="line-309"></a>
<a name="line-310"></a><span class='hs-comment'>{- |
<a name="line-311"></a>
<a name="line-312"></a>Transforming a TIP: applying to a TIP a (polyvariadic) function
<a name="line-313"></a>that takes arguments from a TIP and updates the TIP with the result.
<a name="line-314"></a>
<a name="line-315"></a>In more detail: we have a typed-indexed collection TIP and we
<a name="line-316"></a>would like to apply a transformation function to it, whose argument
<a name="line-317"></a>types and the result type are all in the TIP. The function should locate
<a name="line-318"></a>its arguments based on their types, and update the TIP
<a name="line-319"></a>with the result. The function may have any number of arguments,
<a name="line-320"></a>including zero; the order of arguments should not matter.
<a name="line-321"></a>
<a name="line-322"></a>The problem was posed by Andrew U. Frank on Haskell-Cafe, Sep 10, 2009.
<a name="line-323"></a>&lt;<a href="http://www.haskell.org/pipermail/haskell-cafe/2009-September/066217.html">http://www.haskell.org/pipermail/haskell-cafe/2009-September/066217.html</a>&gt;
<a name="line-324"></a>The problem is an interesting variation of the keyword argument problem.
<a name="line-325"></a>
<a name="line-326"></a>Examples can be found in @examples/TIPTransform.hs@ and @examples/TIPTransformM.hs@
<a name="line-327"></a>-}</span>
<a name="line-328"></a>
<a name="line-329"></a><a name="TransTIP"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>TransTIP</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-330"></a>    <span class='hs-varid'>ttip</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span>
<a name="line-331"></a>
<a name="line-332"></a><a name="instance%20TransTIP%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMember</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>op</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-333"></a>          <span class='hs-conid'>Arity</span> <span class='hs-varid'>op</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span>
<a name="line-334"></a>          <span class='hs-conid'>TransTIP1</span> <span class='hs-varid'>b</span> <span class='hs-varid'>n</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-335"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-336"></a>    <span class='hs-varid'>ttip</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttip1</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span><span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-337"></a>
<a name="line-338"></a><a name="TransTIP1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>TransTIP1</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-339"></a>    <span class='hs-varid'>ttip1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span>
<a name="line-340"></a>
<a name="line-341"></a><a name="instance%20TransTIP1%20True%20n%20op%20db"></a><span class='hs-comment'>-- If op is found in a TIP, update the TIP with op</span>
<a name="line-342"></a><a name="instance%20TransTIP1%20True%20n%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTPupdateAtLabel</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>op</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span>
<a name="line-343"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP1</span> <span class='hs-conid'>True</span> <span class='hs-varid'>n</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-344"></a>    <span class='hs-varid'>ttip1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tipyUpdate</span>
<a name="line-345"></a>
<a name="line-346"></a><a name="instance%20TransTIP1%20False%20(HSucc%20n)%20(arg%20-%3e%20op)%20db"></a><span class='hs-comment'>-- If op is not found in a TIP, it must be a function. Try to look up</span>
<a name="line-347"></a><a name="instance%20TransTIP1%20False%20(HSucc%20n)%20(arg%20-%3e%20op)%20db"></a><span class='hs-comment'>-- its argument in a TIP and recur.</span>
<a name="line-348"></a><a name="instance%20TransTIP1%20False%20(HSucc%20n)%20(arg%20-%3e%20op)%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMember</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-349"></a>          <span class='hs-conid'>TransTIP2</span> <span class='hs-varid'>b</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-350"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP1</span> <span class='hs-conid'>False</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-351"></a>    <span class='hs-varid'>ttip1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttip2</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-352"></a>
<a name="line-353"></a><a name="instance%20TransTIP1%20False%20HZero%20notfun%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Fail</span> <span class='hs-chr'>'</span><span class='hs-layout'>(</span><span class='hs-conid'>TypeNotFound</span> <span class='hs-varid'>notfun</span><span class='hs-layout'>,</span> <span class='hs-str'>"in TIP"</span><span class='hs-layout'>,</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP1</span> <span class='hs-conid'>False</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>notfun</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-354"></a>    <span class='hs-varid'>ttip1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"TransTIP1 Fail must have no instances"</span>
<a name="line-355"></a>
<a name="line-356"></a><a name="TransTIP2"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>TransTIP2</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-357"></a>    <span class='hs-varid'>ttip2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span>
<a name="line-358"></a>
<a name="line-359"></a><a name="instance%20TransTIP2%20True%20arg%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HOccurs</span> <span class='hs-varid'>arg</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-360"></a>         <span class='hs-conid'>TransTIP</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-361"></a>   <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP2</span> <span class='hs-conid'>True</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-362"></a>    <span class='hs-varid'>ttip2</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttip</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>hOccurs</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span>
<a name="line-363"></a>
<a name="line-364"></a><a name="instance%20TransTIP2%20False%20arg%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Fail</span> <span class='hs-chr'>'</span><span class='hs-layout'>(</span><span class='hs-conid'>TypeNotFound</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-str'>"in TIP"</span><span class='hs-layout'>,</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIP2</span> <span class='hs-conid'>False</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-365"></a>    <span class='hs-varid'>ttip2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"TransTIP2 Fail must have no instances"</span>
<a name="line-366"></a>
<a name="line-367"></a><span class='hs-comment'>-- ** Monadic version</span>
<a name="line-368"></a>
<a name="line-369"></a><a name="TransTIPM"></a><span class='hs-comment'>{- |
<a name="line-370"></a>
<a name="line-371"></a>In March 2010, Andrew Frank extended the problem for monadic operations.
<a name="line-372"></a>This is the monadic version of @TIPTransform.hs@ in the present directory.
<a name="line-373"></a>
<a name="line-374"></a>This is the TF implementation. When specifying the operation to perform over
<a name="line-375"></a>a TIP, we can leave it polymorphic over the monad. The type checker
<a name="line-376"></a>will instantiate the monad based on the context.
<a name="line-377"></a>
<a name="line-378"></a>-}</span>
<a name="line-379"></a><a name="TransTIPM"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM</span> <span class='hs-varid'>m</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-380"></a>    <span class='hs-varid'>ttipM</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-381"></a>
<a name="line-382"></a><a name="instance%20TransTIPM%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- Check to see if the operation is a computation whose result</span>
<a name="line-383"></a><a name="instance%20TransTIPM%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- is in the TIP. The type variable m' of the kind *-&gt;* below</span>
<a name="line-384"></a><a name="instance%20TransTIPM%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- can be instantiated either to a monad type constructor, or (arg-&gt;).</span>
<a name="line-385"></a><a name="instance%20TransTIPM%20m%20(m'%20op)%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMember</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>op</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-386"></a>           <span class='hs-conid'>Arity</span> <span class='hs-layout'>(</span><span class='hs-varid'>m'</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span>
<a name="line-387"></a>           <span class='hs-conid'>TransTIPM1</span> <span class='hs-varid'>b</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>m'</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-388"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>m'</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-389"></a>    <span class='hs-varid'>ttipM</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttipM1</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="TransTIPM1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM1</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-392"></a>    <span class='hs-varid'>ttipM1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-393"></a>
<a name="line-394"></a><a name="instance%20TransTIPM1%20True%20n%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- If op is found in a TIP, update the TIP with op.</span>
<a name="line-395"></a><a name="instance%20TransTIPM1%20True%20n%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- The type variable m' must be equal to the type of the monad</span>
<a name="line-396"></a><a name="instance%20TransTIPM1%20True%20n%20m%20(m'%20op)%20db"></a><span class='hs-comment'>-- in which the final result is reported.</span>
<a name="line-397"></a><a name="instance%20TransTIPM1%20True%20n%20m%20(m'%20op)%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>m'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTPupdateAtLabel</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>op</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-398"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM1</span> <span class='hs-conid'>True</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>m'</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-399"></a>    <span class='hs-varid'>ttipM1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-400"></a>         <span class='hs-varid'>op'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>op</span>
<a name="line-401"></a>         <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tipyUpdate</span> <span class='hs-varid'>op'</span> <span class='hs-varid'>db</span>
<a name="line-402"></a>
<a name="line-403"></a><a name="instance%20TransTIPM1%20False%20HZero%20m%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fail</span> <span class='hs-chr'>'</span><span class='hs-layout'>(</span><span class='hs-conid'>TypeNotFound</span> <span class='hs-varid'>op</span><span class='hs-layout'>,</span> <span class='hs-str'>"in TIP"</span><span class='hs-layout'>,</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-404"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM1</span> <span class='hs-conid'>False</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>m</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-405"></a>    <span class='hs-varid'>ttipM1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"TransTIPM1 Fail must have no instances"</span>
<a name="line-406"></a>
<a name="line-407"></a><a name="instance%20TransTIPM1%20False%20(HSucc%20n)%20m%20(arg-%3e%20op)%20db"></a><span class='hs-comment'>-- If op is not found in a TIP, it must be a function. Look up</span>
<a name="line-408"></a><a name="instance%20TransTIPM1%20False%20(HSucc%20n)%20m%20(arg-%3e%20op)%20db"></a><span class='hs-comment'>-- its argument in a TIP and recur.</span>
<a name="line-409"></a><a name="instance%20TransTIPM1%20False%20(HSucc%20n)%20m%20(arg-%3e%20op)%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span>
<a name="line-410"></a>          <span class='hs-conid'>HMember</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-411"></a>          <span class='hs-conid'>TransTIPM2</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-412"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM1</span> <span class='hs-conid'>False</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-413"></a>    <span class='hs-varid'>ttipM1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttipM2</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-414"></a>
<a name="line-415"></a>
<a name="line-416"></a><a name="TransTIPM2"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>TransTIPM2</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-417"></a>    <span class='hs-varid'>ttipM2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-418"></a>
<a name="line-419"></a><a name="instance%20TransTIPM2%20True%20m%20arg%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HOccurs</span> <span class='hs-varid'>arg</span> <span class='hs-layout'>(</span><span class='hs-conid'>TIP</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>TransTIPM</span> <span class='hs-varid'>m</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-420"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM2</span> <span class='hs-conid'>True</span> <span class='hs-varid'>m</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-421"></a>    <span class='hs-varid'>ttipM2</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>db</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ttipM</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>hOccurs</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>db</span>
<a name="line-422"></a>
<a name="line-423"></a>
<a name="line-424"></a><a name="instance%20TransTIPM2%20False%20m%20arg%20op%20db"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fail</span> <span class='hs-chr'>'</span><span class='hs-layout'>(</span><span class='hs-conid'>TypeNotFound</span> <span class='hs-varid'>op</span><span class='hs-layout'>,</span> <span class='hs-str'>"in TIP"</span><span class='hs-layout'>,</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-425"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TransTIPM2</span> <span class='hs-conid'>False</span> <span class='hs-varid'>m</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>op</span> <span class='hs-varid'>db</span> <span class='hs-keyword'>where</span>
<a name="line-426"></a>    <span class='hs-varid'>ttipM2</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"TransTIPM1 Fail must have no instances"</span>
<a name="line-427"></a>
<a name="line-428"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-429"></a>
<a name="line-430"></a><span class='hs-comment'>-- tests for tipyTuple. These only work if tipyTuple is compiled</span>
<a name="line-431"></a><span class='hs-comment'>-- in a module that has NoMonoLocalBinds enabled</span>
<a name="line-432"></a><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tipyTuple</span> <span class='hs-layout'>(</span> <span class='hs-chr'>'1'</span> <span class='hs-varop'>.*.</span> <span class='hs-conid'>True</span> <span class='hs-varop'>.*.</span> <span class='hs-varid'>emptyTIP</span> <span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span><span class='hs-layout'>,</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span>
<a name="line-433"></a><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tipyTuple</span> <span class='hs-layout'>(</span> <span class='hs-chr'>'1'</span> <span class='hs-varop'>.*.</span> <span class='hs-conid'>True</span> <span class='hs-varop'>.*.</span> <span class='hs-varid'>emptyTIP</span> <span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bool</span><span class='hs-layout'>,</span> <span class='hs-conid'>Char</span><span class='hs-layout'>)</span>
<a name="line-434"></a>
<a name="line-435"></a>
<a name="line-436"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-437"></a>
<a name="line-438"></a><span class='hs-comment'>-- * Sample code</span>
<a name="line-439"></a>
<a name="line-440"></a><span class='hs-comment'>{- $setup
<a name="line-441"></a>
<a name="line-442"></a>[@Assume@]
<a name="line-443"></a>
<a name="line-444"></a>&gt;&gt;&gt; import Data.HList.TypeEqO
<a name="line-445"></a>&gt;&gt;&gt; import Data.HList.FakePrelude
<a name="line-446"></a>&gt;&gt;&gt; import Data.HList.HOccurs
<a name="line-447"></a>
<a name="line-448"></a>&gt;&gt;&gt; :{
<a name="line-449"></a>newtype Key    = Key Integer deriving (Show,Eq,Ord)
<a name="line-450"></a>newtype Name   = Name String deriving (Show,Eq)
<a name="line-451"></a>data Breed     = Cow | Sheep deriving (Show,Eq)
<a name="line-452"></a>newtype Price  = Price Float deriving (Show,Eq,Ord)
<a name="line-453"></a>data Disease   = BSE | FM deriving (Show,Eq)
<a name="line-454"></a>type Animal =  TagR '[Key,Name,Breed,Price]
<a name="line-455"></a>:}
<a name="line-456"></a>
<a name="line-457"></a>&gt;&gt;&gt; :{
<a name="line-458"></a>let myTipyCow :: TIP Animal -- optional
<a name="line-459"></a>    myTipyCow = Key 42 .*.  Name "Angus" .*.  Cow .*.  Price 75.5 .*. emptyTIP
<a name="line-460"></a>    animalKey :: (HOccurs Key l, SubType l (TIP Animal)) =&gt; l -&gt; Key
<a name="line-461"></a>    animalKey = hOccurs
<a name="line-462"></a>:}
<a name="line-463"></a>
<a name="line-464"></a>-}</span>
<a name="line-465"></a>
<a name="line-466"></a><span class='hs-comment'>{- $sessionlog
<a name="line-467"></a>[@Session log@]
<a name="line-468"></a>
<a name="line-469"></a>&gt;&gt;&gt; :t myTipyCow
<a name="line-470"></a>myTipyCow :: TIP Animal
<a name="line-471"></a>
<a name="line-472"></a>&gt;&gt;&gt; hOccurs myTipyCow :: Breed
<a name="line-473"></a>Cow
<a name="line-474"></a>
<a name="line-475"></a>&gt;&gt;&gt; BSE .*. myTipyCow
<a name="line-476"></a>TIPH[BSE,Key 42,Name "Angus",Cow,Price 75.5]
<a name="line-477"></a>
<a name="line-478"></a>
<a name="line-479"></a>
<a name="line-480"></a>&gt;&gt;&gt; Sheep .*. hDeleteAtLabel (Label::Label Breed) myTipyCow
<a name="line-481"></a>TIPH[Sheep,Key 42,Name "Angus",Price 75.5]
<a name="line-482"></a>
<a name="line-483"></a>&gt;&gt;&gt; tipyUpdate Sheep myTipyCow
<a name="line-484"></a>TIPH[Key 42,Name "Angus",Sheep,Price 75.5]
<a name="line-485"></a>
<a name="line-486"></a>
<a name="line-487"></a>&gt;&gt;&gt; tipyProject2 (Proxy :: Labels '[Name,Price]) myTipyCow
<a name="line-488"></a>(TIPH[Name "Angus",Price 75.5],TIPH[Key 42,Cow])
<a name="line-489"></a>
<a name="line-490"></a>&gt;&gt;&gt; tipyProject (Proxy :: Labels '[Name,Price]) myTipyCow
<a name="line-491"></a>TIPH[Name "Angus",Price 75.5]
<a name="line-492"></a>
<a name="line-493"></a>-}</span>
<a name="line-494"></a>
<a name="line-495"></a>
<a name="line-496"></a><span class='hs-comment'>{- $sessionlog2
<a name="line-497"></a>
<a name="line-498"></a>Don't bother repeating the type error:
<a name="line-499"></a>
<a name="line-500"></a>
<a name="line-501"></a>&gt;&gt;&gt; Sheep .*. myTipyCow
<a name="line-502"></a>...
<a name="line-503"></a>...No instance for (Fail (DuplicatedLabel (Label Breed)))
<a name="line-504"></a>...
<a name="line-505"></a>
<a name="line-506"></a>-}</span>
</pre></body>
</html>
