<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Data/HList/RecordPuns.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE TemplateHaskell #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE NoPolyKinds #-}</span>
<a name="line-3"></a><span class='hs-comment'>{- | Description : quasiquoter inspired by -XNamedFieldPuns -}</span>
<a name="line-4"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>RecordPuns</span> <span class='hs-layout'>(</span>
<a name="line-5"></a>    <span class='hs-comment'>-- $ex</span>
<a name="line-6"></a>    <span class='hs-varid'>pun</span>
<a name="line-7"></a>
<a name="line-8"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>Haskell</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>Haskell</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span><span class='hs-varop'>.</span><span class='hs-conid'>Quote</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>Record</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>FakePrelude</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-comment'>{- $ex
<a name="line-18"></a>
<a name="line-19"></a>&gt;&gt;&gt; :set -XQuasiQuotes -XViewPatterns
<a name="line-20"></a>
<a name="line-21"></a>[@patterns@]
<a name="line-22"></a>
<a name="line-23"></a>&gt;&gt;&gt; let y = Label :: Label "y"
<a name="line-24"></a>&gt;&gt;&gt; let x = Label :: Label "x"
<a name="line-25"></a>&gt;&gt;&gt; [pun| x y |] &lt;- return (x .=. 3 .*. y .=. "hi" .*. emptyRecord)
<a name="line-26"></a>&gt;&gt;&gt; print (x,y)
<a name="line-27"></a>(3,"hi")
<a name="line-28"></a>
<a name="line-29"></a>[@expressions@]
<a name="line-30"></a>
<a name="line-31"></a>Compare with the standard way to construct records above
<a name="line-32"></a>
<a name="line-33"></a>&gt;&gt;&gt; let x = 3; y = "hi"
<a name="line-34"></a>&gt;&gt;&gt; [pun|x y|]
<a name="line-35"></a>Record{x=3,y="hi"}
<a name="line-36"></a>
<a name="line-37"></a>[@nesting@]
<a name="line-38"></a>
<a name="line-39"></a>Nesting is supported. The idea is that variables inside
<a name="line-40"></a>@{ }@ are in another record. More concretely:
<a name="line-41"></a>
<a name="line-42"></a>&gt; [pun| ab@{ a b } y z c{d} |]
<a name="line-43"></a>
<a name="line-44"></a>as a pattern, it will bindings from an original record @x@,
<a name="line-45"></a>if you interpret (.) as a left-associative field lookup (as it
<a name="line-46"></a>is in other languages):
<a name="line-47"></a>
<a name="line-48"></a>&gt; let ab = xab
<a name="line-49"></a>&gt;     a = x.ab.a
<a name="line-50"></a>&gt;     b = x.ab.b
<a name="line-51"></a>&gt;     y = x.y
<a name="line-52"></a>&gt;     z = x.z
<a name="line-53"></a>&gt;     -- c is not bound
<a name="line-54"></a>&gt;     d = x.c.d
<a name="line-55"></a>
<a name="line-56"></a>as an expression, it creates a new record which needs the variables
<a name="line-57"></a>@ab a b y z d@ in-scope. @ab@ needs to be a record, and if it has
<a name="line-58"></a>fields called @a@ or @b@ they are overridden by the values of @a@ and @b@
<a name="line-59"></a>which are in scope.
<a name="line-60"></a>
<a name="line-61"></a>@( )@ parens mean the same thing as @{ }@, except the pattern match
<a name="line-62"></a>restricts the fields in the record supplied to be exactly the ones
<a name="line-63"></a>provided. In other words
<a name="line-64"></a>
<a name="line-65"></a>&gt; [pun| (x _ y{}) |] = list
<a name="line-66"></a>&gt; -- desugars to something like:
<a name="line-67"></a>&gt; Record ((Tagged x :: Tagged "x" s1) `HCons`
<a name="line-68"></a>&gt;         (Tagged _ :: Tagged t   s2) `HCons`
<a name="line-69"></a>&gt;         (Tagged _ :: Tagged "y" s3) `HCons`
<a name="line-70"></a>&gt;          HNil) = list
<a name="line-71"></a>
<a name="line-72"></a>Where the @s1@ and @s2@ are allowed to fit whatever is in the HList.
<a name="line-73"></a>Note that this also introduces the familiar wild card pattern (@_@),
<a name="line-74"></a>and shows again how to ensure a label is present but not bind a variable
<a name="line-75"></a>to it.
<a name="line-76"></a>
<a name="line-77"></a>See also @examples/pun.hs@. In @{}@ patterns, @pun@ can work with
<a name="line-78"></a>'Variant' too.
<a name="line-79"></a>
<a name="line-80"></a>-}</span>
<a name="line-81"></a>
<a name="line-82"></a>
<a name="line-83"></a><a name="pun"></a><span class='hs-comment'>-- | requires labels to be promoted strings (kind Symbol), as provided by</span>
<a name="line-84"></a><span class='hs-comment'>-- "Data.HList.Label6" (ie. the label for foo is @Label :: Label \"foo\"@),</span>
<a name="line-85"></a><span class='hs-comment'>-- or "Data.HList.Labelable"</span>
<a name="line-86"></a><span class='hs-definition'>pun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>QuasiQuoter</span>
<a name="line-87"></a><span class='hs-definition'>pun</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>QuasiQuoter</span> <span class='hs-layout'>{</span>
<a name="line-88"></a>    <span class='hs-varid'>quotePat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>suppressWarning</span> <span class='hs-varid'>mp</span> <span class='hs-varop'>.</span> <span class='hs-varid'>parseRec</span><span class='hs-layout'>,</span>
<a name="line-89"></a>    <span class='hs-varid'>quoteExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>suppressWarning</span> <span class='hs-varid'>me</span> <span class='hs-varop'>.</span> <span class='hs-varid'>parseRec</span><span class='hs-layout'>,</span>
<a name="line-90"></a>    <span class='hs-varid'>quoteDec</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Data.HList.RecordPuns.quoteDec"</span><span class='hs-layout'>,</span>
<a name="line-91"></a>    <span class='hs-varid'>quoteType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Data.HList.RecordPuns.quoteType"</span>
<a name="line-92"></a> <span class='hs-layout'>}</span>
<a name="line-93"></a>
<a name="line-94"></a>
<a name="line-95"></a><a name="suppressWarning"></a><span class='hs-comment'>-- | the warning about @implicit {} added@ doesn't</span>
<a name="line-96"></a><span class='hs-comment'>-- make sense at top level (but it does if you say</span>
<a name="line-97"></a><span class='hs-comment'>-- have  [pun| x @ y |]</span>
<a name="line-98"></a><span class='hs-definition'>suppressWarning</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-99"></a><span class='hs-definition'>suppressWarning</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-100"></a>
<a name="line-101"></a><a name="extracts"></a><span class='hs-comment'>-- like  \x -&gt; (x .!. x1, x .!. x2)</span>
<a name="line-102"></a><span class='hs-definition'>extracts</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-103"></a>    <span class='hs-varid'>record</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newName</span> <span class='hs-str'>"record"</span>
<a name="line-104"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>val</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupE</span>
<a name="line-105"></a>            <span class='hs-keyglyph'>[</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>record</span><span class='hs-layout'>)</span> <span class='hs-varop'>.!.</span> <span class='hs-varop'>$</span><span class='hs-varid'>label</span>  <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-106"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span>
<a name="line-107"></a>                <span class='hs-keyword'>let</span> <span class='hs-varid'>label</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>Label</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Label</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>litT</span> <span class='hs-layout'>(</span><span class='hs-varid'>strTyLit</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-108"></a>                <span class='hs-varid'>x</span> <span class='hs-varop'>/=</span> <span class='hs-str'>"_"</span>
<a name="line-109"></a>                <span class='hs-keyglyph'>]</span>
<a name="line-110"></a>
<a name="line-111"></a>        <span class='hs-comment'>-- constrain the type of the supplied record to have at least</span>
<a name="line-112"></a>        <span class='hs-comment'>-- as many elements as are extracted. In other words:</span>
<a name="line-113"></a>        <span class='hs-comment'>--</span>
<a name="line-114"></a>        <span class='hs-comment'>-- &gt; f :: r (e1 ': e2 ': e3 ': e4 ': es) -&gt; () -- is inferred</span>
<a name="line-115"></a>        <span class='hs-comment'>-- &gt; f [pun| { _ _ _ _ } |] = ()</span>
<a name="line-116"></a>        <span class='hs-varid'>ensureLength</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>record</span><span class='hs-layout'>)</span> <span class='hs-varop'>`asTypeOf`</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>minLen</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-117"></a>
<a name="line-118"></a>    <span class='hs-varid'>lamE</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>varP</span> <span class='hs-varid'>record</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span>  <span class='hs-varop'>$</span><span class='hs-varid'>val</span> <span class='hs-varop'>`const`</span> <span class='hs-varop'>$</span><span class='hs-varid'>ensureLength</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-119"></a>
<a name="line-120"></a>
<a name="line-121"></a><a name="minLen"></a><span class='hs-comment'>-- | generates an @undefined :: r xs@, such that @xs :: [k]@ has</span>
<a name="line-122"></a><span class='hs-comment'>-- at least as long as the input list</span>
<a name="line-123"></a><span class='hs-definition'>minLen</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ExpQ</span>
<a name="line-124"></a><span class='hs-definition'>minLen</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Data.HList.RecordPuns.minLen"</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>r</span> <span class='hs-layout'>(</span><span class='hs-varid'>es</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-125"></a><span class='hs-definition'>minLen</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span> <span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>error</span> <span class='hs-str'>"Data.HList.RecordPuns.minLen"</span>
<a name="line-126"></a>                        <span class='hs-keyglyph'>::</span> <span class='hs-varid'>r</span> <span class='hs-varid'>es</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>minLen</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-127"></a>
<a name="line-128"></a><a name="mkPair"></a><span class='hs-definition'>mkPair</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ExpQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ExpQ</span>
<a name="line-129"></a><span class='hs-definition'>mkPair</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xe</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-conid'>Label</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Label</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>litT</span> <span class='hs-layout'>(</span><span class='hs-varid'>strTyLit</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>.=.</span> <span class='hs-varop'>$</span><span class='hs-varid'>xe</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-130"></a>
<a name="line-131"></a>
<a name="line-132"></a>
<a name="line-133"></a><a name="me"></a><span class='hs-definition'>me</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Tree</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ExpQ</span>
<a name="line-134"></a><span class='hs-definition'>me</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>mkPair</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varop'>.*.</span> <span class='hs-varop'>$</span><span class='hs-varid'>acc</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>emptyRecord</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>mes</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-definition'>me</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-sel'>_as</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Data.HList.RecordPuns.mp impossible"</span>
<a name="line-136"></a><span class='hs-definition'>me</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-137"></a>    <span class='hs-varid'>reportWarning</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Data.HList.RecordPuns.mp implicit {} added around:"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>a</span>
<a name="line-138"></a>    <span class='hs-varid'>me</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-139"></a>
<a name="line-140"></a><a name="mes"></a><span class='hs-definition'>mes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>ExpQ</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-141"></a><span class='hs-definition'>mes</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>V</span> <span class='hs-str'>"@"</span><span class='hs-conop'>:</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>me</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`hLeftUnion`</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>dyn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mes</span> <span class='hs-varid'>c</span>
<a name="line-142"></a><span class='hs-definition'>mes</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>C</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>me</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mes</span> <span class='hs-varid'>c</span>
<a name="line-143"></a><span class='hs-definition'>mes</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>D</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>me</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mes</span> <span class='hs-varid'>c</span>
<a name="line-144"></a><span class='hs-definition'>mes</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>varE</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mes</span> <span class='hs-varid'>b</span>
<a name="line-145"></a><span class='hs-definition'>mes</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-146"></a><span class='hs-definition'>mes</span> <span class='hs-varid'>inp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Data.HList.RecordPuns.mes: cannot translate remaining:"</span> <span class='hs-varop'>++</span>
<a name="line-147"></a>                        <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppTree</span> <span class='hs-varid'>inp</span><span class='hs-layout'>)</span>
<a name="line-148"></a>
<a name="line-149"></a><a name="mp"></a><span class='hs-definition'>mp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Tree</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PatQ</span>
<a name="line-150"></a><span class='hs-definition'>mp</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-151"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>extractPats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mps</span> <span class='hs-keyword'>as</span>
<a name="line-152"></a>        <span class='hs-varid'>tupleP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupP</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>binding</span><span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>extractPats</span><span class='hs-layout'>,</span> <span class='hs-varid'>binding</span> <span class='hs-varop'>/=</span> <span class='hs-str'>"_"</span> <span class='hs-keyglyph'>]</span>
<a name="line-153"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>viewP</span> <span class='hs-layout'>(</span><span class='hs-varid'>extracts</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>extractPats</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>tupleP</span>
<a name="line-154"></a>
<a name="line-155"></a>
<a name="line-156"></a><span class='hs-definition'>mp</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>conP</span> <span class='hs-chr'>'</span><span class='hs-conid'>Record</span>
<a name="line-157"></a>  <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span> <span class='hs-keyglyph'>\</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>conP</span> <span class='hs-chr'>'</span><span class='hs-conid'>HCons</span>
<a name="line-158"></a>                <span class='hs-keyglyph'>[</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>ty</span>
<a name="line-159"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>==</span> <span class='hs-str'>"_"</span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>undefined</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Tagged</span> <span class='hs-varid'>anyLabel</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-160"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>undefined</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Tagged</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>litT</span> <span class='hs-layout'>(</span><span class='hs-varid'>strTyLit</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-161"></a>                  <span class='hs-keyword'>in</span> <span class='hs-varid'>viewP</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`asTypeOf`</span> <span class='hs-varop'>$</span><span class='hs-varid'>ty</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-162"></a>                      <span class='hs-layout'>(</span><span class='hs-varid'>conP</span> <span class='hs-chr'>'</span><span class='hs-conid'>Tagged</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-163"></a>                <span class='hs-varid'>xs</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-164"></a>          <span class='hs-layout'>(</span><span class='hs-varid'>conP</span> <span class='hs-chr'>'</span><span class='hs-conid'>HNil</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-165"></a>          <span class='hs-layout'>(</span><span class='hs-varid'>mps</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-166"></a><span class='hs-definition'>mp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-167"></a>    <span class='hs-varid'>reportWarning</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Data.HList.RecordPuns.mp implicit {} added around:"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>a</span>
<a name="line-168"></a>    <span class='hs-varid'>mp</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="mps"></a><span class='hs-definition'>mps</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>PatQ</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-171"></a><span class='hs-definition'>mps</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>V</span> <span class='hs-str'>"@"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>asP</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>mp</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>  <span class='hs-varid'>mps</span> <span class='hs-varid'>c</span>
<a name="line-172"></a><span class='hs-definition'>mps</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>C</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>mp</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mps</span> <span class='hs-varid'>c</span>
<a name="line-173"></a><span class='hs-definition'>mps</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-conid'>D</span> <span class='hs-varid'>b</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>mp</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mps</span> <span class='hs-varid'>c</span>
<a name="line-174"></a><span class='hs-definition'>mps</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-str'>"_"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-str'>"_"</span><span class='hs-layout'>,</span> <span class='hs-varid'>wildP</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mps</span> <span class='hs-varid'>b</span>
<a name="line-175"></a><span class='hs-definition'>mps</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>varP</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mps</span> <span class='hs-varid'>b</span>
<a name="line-176"></a><span class='hs-definition'>mps</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-177"></a><span class='hs-definition'>mps</span> <span class='hs-varid'>inp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Data.HList.RecordPuns.mps: cannot translate remaining pattern:"</span> <span class='hs-varop'>++</span>
<a name="line-178"></a>                        <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppTree</span> <span class='hs-varid'>inp</span><span class='hs-layout'>)</span>
<a name="line-179"></a>
<a name="line-180"></a><a name="Tree"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Tree</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>C</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- ^ curly @{ }@</span>
<a name="line-181"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>D</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- ^ @(  )@</span>
<a name="line-182"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>V</span> <span class='hs-conid'>String</span> <span class='hs-comment'>-- ^ variable</span>
<a name="line-183"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Show</span>
<a name="line-184"></a>
<a name="line-185"></a><a name="parseRec"></a><span class='hs-comment'>{- |
<a name="line-186"></a>
<a name="line-187"></a>&gt;&gt;&gt; parseRec "{ a b c {d e f}  } d"
<a name="line-188"></a>C [C [V "a",V "b",V "c",C [V "d",V "e",V "f"]],V "d"]
<a name="line-189"></a>
<a name="line-190"></a>&gt;&gt;&gt; ppTree $ parseRec "{a b c {d e {} f @ g}}"
<a name="line-191"></a>"{a b c {d e {} f @ g}}"
<a name="line-192"></a>
<a name="line-193"></a>&gt;&gt;&gt; ppTree $ parseRec "a b c {d e {} f @ g}"
<a name="line-194"></a>"{a b c {d e {} f @ g}}"
<a name="line-195"></a>
<a name="line-196"></a>&gt;&gt;&gt; ppTree $ parseRec "(a b { (d) e } )"
<a name="line-197"></a>"(a b {(d) e})"
<a name="line-198"></a>
<a name="line-199"></a>-}</span>
<a name="line-200"></a><span class='hs-definition'>parseRec</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Tree</span>
<a name="line-201"></a><span class='hs-definition'>parseRec</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>parseRec'</span> <span class='hs-num'>0</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lexing</span> <span class='hs-varid'>str</span> <span class='hs-keyword'>of</span>
<a name="line-202"></a>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-comment'>-- avoid adding another layer if possible</span>
<a name="line-203"></a>    <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>C</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="parseRec'"></a><span class='hs-definition'>parseRec'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Tree</span><span class='hs-keyglyph'>]</span>
<a name="line-206"></a><span class='hs-definition'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-varid'>accum</span>  <span class='hs-layout'>(</span><span class='hs-str'>"{"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseRec'</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span> <span class='hs-conop'>:</span> <span class='hs-varid'>accum</span><span class='hs-layout'>)</span> <span class='hs-varid'>rest</span>
<a name="line-207"></a><span class='hs-definition'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-varid'>accum</span>  <span class='hs-layout'>(</span><span class='hs-str'>"("</span> <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseRec'</span>  <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span> <span class='hs-conop'>:</span> <span class='hs-varid'>accum</span><span class='hs-layout'>)</span> <span class='hs-varid'>rest</span>
<a name="line-208"></a><span class='hs-definition'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-str'>"}"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseRec'</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>  <span class='hs-varid'>rest</span>
<a name="line-209"></a><span class='hs-definition'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-str'>")"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>  <span class='hs-varid'>rest</span>
<a name="line-210"></a><span class='hs-definition'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span>   <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span>
<a name="line-211"></a>         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`notElem`</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"{"</span><span class='hs-layout'>,</span><span class='hs-str'>"}"</span><span class='hs-layout'>,</span><span class='hs-str'>"("</span><span class='hs-layout'>,</span><span class='hs-str'>")"</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseRec'</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span>   <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>rest</span>
<a name="line-212"></a><span class='hs-definition'>parseRec'</span> <span class='hs-num'>0</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-213"></a><span class='hs-definition'>parseRec'</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>accum</span> <span class='hs-varid'>e</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-layout'>(</span><span class='hs-str'>"Data.HList.RecordPuns.parseRec' unexpected: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>e</span>
<a name="line-214"></a>                                            <span class='hs-varop'>++</span> <span class='hs-str'>"\n parsed:"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>accum</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-215"></a>
<a name="line-216"></a><a name="ppTree"></a><span class='hs-definition'>ppTree</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Tree</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-217"></a><span class='hs-definition'>ppTree</span> <span class='hs-layout'>(</span><span class='hs-conid'>C</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"{"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>unwords</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppTree</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>"}"</span>
<a name="line-218"></a><span class='hs-definition'>ppTree</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"("</span> <span class='hs-varop'>++</span> <span class='hs-varid'>unwords</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppTree</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>")"</span>
<a name="line-219"></a><span class='hs-definition'>ppTree</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-220"></a>
<a name="line-221"></a><a name="lexing"></a><span class='hs-definition'>lexing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unfoldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>lex</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>of</span>
<a name="line-222"></a>                    <span class='hs-layout'>(</span><span class='hs-str'>""</span><span class='hs-layout'>,</span> <span class='hs-str'>""</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-223"></a>                    <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>e</span>
<a name="line-224"></a>                    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre></body>
</html>
