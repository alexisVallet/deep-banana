<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Data/HList/HList.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{- |
<a name="line-2"></a>   The HList library
<a name="line-3"></a>
<a name="line-4"></a>   (C) 2004, Oleg Kiselyov, Ralf Laemmel, Keean Schupke
<a name="line-5"></a>
<a name="line-6"></a>   Basic declarations for typeful heterogeneous lists.
<a name="line-7"></a>
<a name="line-8"></a>   Excuse the unstructured haddocks: while there are many declarations here
<a name="line-9"></a>   some are alternative implementations should be grouped, and the definitions
<a name="line-10"></a>   here are analgous to many list functions in the "Prelude".
<a name="line-11"></a> -}</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span> <span class='hs-keyword'>where</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>FakePrelude</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HList</span><span class='hs-varop'>.</span><span class='hs-conid'>HListPrelude</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>ParserCombinators</span><span class='hs-varop'>.</span><span class='hs-conid'>ReadP</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>LensDefs</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ix</span><span class='hs-layout'>)</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-26"></a><span class='hs-comment'>-- * Heterogeneous type sequences</span>
<a name="line-27"></a><span class='hs-comment'>{- $note
<a name="line-28"></a>
<a name="line-29"></a>There are three sensible ways to define HLists:
<a name="line-30"></a>
<a name="line-31"></a>@
<a name="line-32"></a>data HList (l::[*]) where
<a name="line-33"></a>    HNil  :: HList '[]
<a name="line-34"></a>    HCons :: e -&gt; HList l -&gt; HList (e ': l)
<a name="line-35"></a>@
<a name="line-36"></a>
<a name="line-37"></a>This ensures that sequences can only be formed with Nil
<a name="line-38"></a>and Cons. The argument to HList is a promoted lists (kind @[*]@),
<a name="line-39"></a>which has a more attractive syntax.
<a name="line-40"></a>
<a name="line-41"></a>
<a name="line-42"></a>Earlier versions of HList used an algebraic data type:
<a name="line-43"></a>
<a name="line-44"></a>@
<a name="line-45"></a>data HCons a b = HCons a b
<a name="line-46"></a>data HNil = HNil
<a name="line-47"></a>@
<a name="line-48"></a>
<a name="line-49"></a>Disadvantages:
<a name="line-50"></a>
<a name="line-51"></a>* values with types like @HCons Int Double@ to be created,
<a name="line-52"></a>  which are nonsense to the functions in HList
<a name="line-53"></a>
<a name="line-54"></a>* some recursive functions do not need a class with the GADT. For example:
<a name="line-55"></a>
<a name="line-56"></a>  @
<a name="line-57"></a>    hInit :: HListGADT (x ': xs) -&gt; HListGADT (HInit (x ': xs))
<a name="line-58"></a>    hInit (HCons x xs@(HCons _ _)) = HCons x (hInit xs)
<a name="line-59"></a>    hInit (HCons _ HNil) = HNil
<a name="line-60"></a>
<a name="line-61"></a>    type family HInit (xs :: [k]) :: [k]
<a name="line-62"></a>  @
<a name="line-63"></a>
<a name="line-64"></a>  but without the GADT, 'hInit' is written as in a class,
<a name="line-65"></a>  which complicates inferred types
<a name="line-66"></a>
<a name="line-67"></a>
<a name="line-68"></a>Advantages
<a name="line-69"></a>
<a name="line-70"></a>* lazy pattern matches are allowed, so lazy pattern matching
<a name="line-71"></a>  on a value @undefined :: HList [a,b,c]@ can create the
<a name="line-72"></a>  spine of the list. 'hProxies' avoids the use of 'undefined',
<a name="line-73"></a>  but a slightly more complicated class context has to be written
<a name="line-74"></a>  or inferred.
<a name="line-75"></a>
<a name="line-76"></a>* type inference is better if you want to directly pattern match
<a name="line-77"></a>&lt;<a href="http://stackoverflow.com/questions/19077037/is-there-any-deeper-type-theoretic-reason-ghc-cant-infer-this-type">http://stackoverflow.com/questions/19077037/is-there-any-deeper-type-theoretic-reason-ghc-cant-infer-this-type</a> see stackoverflow post here&gt;
<a name="line-78"></a>
<a name="line-79"></a>* better pattern exhaustiveness checking (as of ghc-7.8)
<a name="line-80"></a>
<a name="line-81"></a>* standalone deriving works
<a name="line-82"></a>
<a name="line-83"></a>* Data.Coerce.coerce works because the parameters have role representational,
<a name="line-84"></a>  not nominal as they are for the GADT and data family. Probably the GADT/type
<a name="line-85"></a>  family actually do have a representational role:
<a name="line-86"></a>  &lt;<a href="http://stackoverflow.com/questions/24222552/does-this-gadt-actually-have-type-role-representational">http://stackoverflow.com/questions/24222552/does-this-gadt-actually-have-type-role-representational</a>&gt;
<a name="line-87"></a>
<a name="line-88"></a>
<a name="line-89"></a>
<a name="line-90"></a>The data family version (currently used) gives the same type constructor
<a name="line-91"></a>@HList :: [*] -&gt; *@ as the GADT, while pattern matching behaves
<a name="line-92"></a>like the algebraic data type. Furthermore, nonsense values like
<a name="line-93"></a>@HCons 1 2 :: HCons Int Int@ cannot be written with the data family.
<a name="line-94"></a>
<a name="line-95"></a>A variation on the data family version is
<a name="line-96"></a>
<a name="line-97"></a>&gt; data instance HList '[] = HNil
<a name="line-98"></a>&gt; newtype instance HList (x ': xs) = HCons1 (x, HList xs)
<a name="line-99"></a>&gt; pattern HCons x xs = HCons1 (x, xs)
<a name="line-100"></a>
<a name="line-101"></a>This allows HList to have a nominal role, but on the other
<a name="line-102"></a>hand the PatternSynonym is not supported with ghc-7.6 and
<a name="line-103"></a>exhaustiveness checking is not as good (warnings for _ being
<a name="line-104"></a>unmatched)
<a name="line-105"></a>
<a name="line-106"></a>-}</span>
<a name="line-107"></a>
<a name="line-108"></a>
<a name="line-109"></a><span class='hs-keyword'>data</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-keyglyph'>::</span><span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-110"></a>
<a name="line-111"></a><span class='hs-keyword'>data</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-112"></a><span class='hs-keyword'>data</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span>
<a name="line-113"></a>
<a name="line-114"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-115"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-116"></a>
<a name="line-117"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-118"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Ord</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-119"></a>
<a name="line-120"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Ix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-121"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ix</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Ix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-122"></a>
<a name="line-123"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Bounded</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-124"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bounded</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Bounded</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bounded</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-125"></a>
<a name="line-126"></a>
<a name="line-127"></a><span class='hs-comment'>-- Enum cannot be derived</span>
<a name="line-128"></a>
<a name="line-129"></a>
<a name="line-130"></a><span class='hs-comment'>-- | creates a HList of Proxies</span>
<a name="line-131"></a>
<a name="line-132"></a><a name="HProxiesFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HProxiesFD</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>pxs</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>pxs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xs</span> <span class='hs-comment'>-- DropProxy pxs ~ xs</span>
<a name="line-133"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pxs</span> <span class='hs-comment'>-- AddProxy xs ~ pxs</span>
<a name="line-134"></a>      <span class='hs-keyword'>where</span> <span class='hs-varid'>hProxies</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>pxs</span>
<a name="line-135"></a>
<a name="line-136"></a><a name="HProxies"></a><span class='hs-comment'>{- Ideally we could write:
<a name="line-137"></a>
<a name="line-138"></a>&gt; class DropProxy (AddProxy xs) ~ xs =&gt; HProxies xs where
<a name="line-139"></a>&gt;     hProxies :: HList (AddProxy xs)
<a name="line-140"></a>
<a name="line-141"></a>See https://ghc.haskell.org/trac/ghc/ticket/10009 -}</span>
<a name="line-142"></a><a name="HProxies"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HProxies</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HProxiesFD</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddProxy</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-143"></a>
<a name="line-144"></a>
<a name="line-145"></a><span class='hs-comment'>{- | Add 'Proxy' to a type
<a name="line-146"></a>
<a name="line-147"></a>&gt;&gt;&gt; let x = undefined :: HList (AddProxy [Char,Int])
<a name="line-148"></a>&gt;&gt;&gt; :t x
<a name="line-149"></a>x :: HList '[Proxy Char, Proxy Int]
<a name="line-150"></a>
<a name="line-151"></a>
<a name="line-152"></a>-}</span>
<a name="line-153"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>AddProxy</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span>
<a name="line-154"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>AddProxy</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-155"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>AddProxy</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AddProxy</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>AddProxy</span> <span class='hs-varid'>xs</span>
<a name="line-156"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>AddProxy</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x</span>
<a name="line-157"></a>
<a name="line-158"></a><span class='hs-comment'>-- | inverse of 'AddProxy'</span>
<a name="line-159"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>DropProxy</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span>
<a name="line-160"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>DropProxy</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DropProxy</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>DropProxy</span> <span class='hs-varid'>xs</span>
<a name="line-161"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>DropProxy</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-162"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>DropProxy</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-163"></a>
<a name="line-164"></a><a name="instance%20HProxiesFD%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HProxiesFD</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-165"></a>    <span class='hs-varid'>hProxies</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-166"></a>
<a name="line-167"></a><a name="instance%20HProxiesFD%20(x%20':%20xs)%20(Proxy%20x%20':%20pxs)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HProxiesFD</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>pxs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HProxiesFD</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>pxs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-168"></a>    <span class='hs-varid'>hProxies</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hProxies</span>
<a name="line-169"></a>
<a name="line-170"></a>
<a name="line-171"></a>
<a name="line-172"></a><a name="instance%20Show%20(HList%20'%5b%5d)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-173"></a>    <span class='hs-varid'>show</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"H[]"</span>
<a name="line-174"></a>
<a name="line-175"></a><a name="instance%20Show%20(HList%20(e%20':%20l))"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-176"></a>    <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-chr'>'H'</span><span class='hs-conop'>:</span><span class='hs-chr'>'['</span><span class='hs-conop'>:</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varid'>l</span>
<a name="line-177"></a>                       <span class='hs-keyword'>in</span> <span class='hs-str'>"H["</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span>
<a name="line-178"></a>                                  <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>s</span> <span class='hs-varop'>==</span> <span class='hs-str'>"]"</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>else</span> <span class='hs-str'>","</span> <span class='hs-varop'>++</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-179"></a>
<a name="line-180"></a>
<a name="line-181"></a><a name="instance%20Read%20(HList%20'%5b%5d)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Read</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-182"></a>    <span class='hs-varid'>readsPrec</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>stripPrefix</span> <span class='hs-str'>"H[]"</span> <span class='hs-varid'>str</span> <span class='hs-keyword'>of</span>
<a name="line-183"></a>                        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>[]</span>
<a name="line-184"></a>                        <span class='hs-conid'>Just</span> <span class='hs-varid'>rest</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-185"></a>
<a name="line-186"></a><a name="instance%20Read%20(HList%20(e%20':%20l))"></a><span class='hs-keyword'>instance</span>
<a name="line-187"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>HProxies</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span>
<a name="line-188"></a>    <span class='hs-conid'>HSequence</span> <span class='hs-conid'>ReadP</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReadP</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>readP_l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-189"></a>    <span class='hs-conid'>HMapCxt</span> <span class='hs-conid'>HList</span> <span class='hs-conid'>ReadElement</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddProxy</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>readP_l</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=&gt;</span>
<a name="line-190"></a>      <span class='hs-conid'>Read</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-191"></a>  <span class='hs-varid'>readsPrec</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readP_to_S</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-192"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>string</span> <span class='hs-str'>"H["</span>
<a name="line-193"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>hProxies</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddProxy</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-194"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>parsers</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readS_to_P</span> <span class='hs-varid'>reads</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hMap</span> <span class='hs-conid'>ReadElement</span> <span class='hs-varid'>l</span>
<a name="line-195"></a>    <span class='hs-varid'>hlist</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>hSequence</span> <span class='hs-varid'>parsers</span>
<a name="line-196"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>string</span> <span class='hs-str'>"]"</span>
<a name="line-197"></a>    <span class='hs-varid'>return</span> <span class='hs-varid'>hlist</span>
<a name="line-198"></a>
<a name="line-199"></a>
<a name="line-200"></a><a name="ReadElement"></a><span class='hs-comment'>-- similar to ReadComponent used to define instance Read Record</span>
<a name="line-201"></a><a name="ReadElement"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ReadElement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ReadElement</span>
<a name="line-202"></a>
<a name="line-203"></a><a name="instance%20ApplyAB%20ReadElement%20(Proxy%20x)%20y"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>ReadP</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>ReadElement</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>where</span>
<a name="line-204"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-conid'>ReadElement</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-205"></a>      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>string</span> <span class='hs-str'>","</span>
<a name="line-206"></a>      <span class='hs-varid'>readS_to_P</span> <span class='hs-varid'>reads</span>
<a name="line-207"></a>
<a name="line-208"></a>
<a name="line-209"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>2</span> <span class='hs-varop'>`HCons`</span>
<a name="line-210"></a>
<a name="line-211"></a>
<a name="line-212"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-213"></a><span class='hs-comment'>-- * Basic list functions</span>
<a name="line-214"></a>
<a name="line-215"></a><a name="hHead"></a><span class='hs-comment'>-- | 'head'</span>
<a name="line-216"></a><span class='hs-definition'>hHead</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span>
<a name="line-217"></a><span class='hs-definition'>hHead</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-218"></a>
<a name="line-219"></a><a name="hTail"></a><span class='hs-comment'>-- | 'tail'</span>
<a name="line-220"></a><span class='hs-definition'>hTail</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span>
<a name="line-221"></a><span class='hs-definition'>hTail</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-222"></a>
<a name="line-223"></a><a name="hLast"></a><span class='hs-comment'>-- | 'last'</span>
<a name="line-224"></a><span class='hs-definition'>hLast</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hHead</span> <span class='hs-layout'>(</span><span class='hs-varid'>hReverse_</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-225"></a>
<a name="line-226"></a>
<a name="line-227"></a><a name="HInit"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HInit</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>where</span>
<a name="line-228"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>HInitR</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-229"></a>    <span class='hs-varid'>hInit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HInitR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-230"></a>
<a name="line-231"></a><a name="instance%20HInit%20'%5bx%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HInit</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-232"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>HInitR</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-233"></a>    <span class='hs-varid'>hInit</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-234"></a>
<a name="line-235"></a><a name="instance%20HInit%20(a%20':%20b%20':%20c)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HInit</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HInit</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-236"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>HInitR</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HInitR</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-237"></a>    <span class='hs-varid'>hInit</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>bc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hInit</span> <span class='hs-varid'>bc</span>
<a name="line-238"></a>
<a name="line-239"></a>
<a name="line-240"></a><span class='hs-comment'>-- | Length, but see 'HLengthEq' instead</span>
<a name="line-241"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span>
<a name="line-242"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HLength</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HZero</span>
<a name="line-243"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HSucc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HLength</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-244"></a>
<a name="line-245"></a><a name="hLength"></a><span class='hs-definition'>hLength</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span>
<a name="line-246"></a><span class='hs-definition'>hLength</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>  <span class='hs-conid'>Proxy</span>
<a name="line-247"></a>
<a name="line-248"></a><a name="instance%20HExtend%20e%20(HList%20l)"></a><span class='hs-comment'>-- ** Append</span>
<a name="line-249"></a><a name="instance%20HExtend%20e%20(HList%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HExtend</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-250"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HExtendR</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-251"></a>  <span class='hs-layout'>(</span><span class='hs-varop'>.*.</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span>
<a name="line-252"></a>
<a name="line-253"></a><a name="instance%20HAppend%20(HList%20l1)%20(HList%20l2)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendList</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppend</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-254"></a>  <span class='hs-varid'>hAppend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hAppendList</span>
<a name="line-255"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendR</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-256"></a>
<a name="line-257"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HAppendListR</span> <span class='hs-layout'>(</span><span class='hs-varid'>l1</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span>
<a name="line-258"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendListR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-259"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendListR</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span>
<a name="line-260"></a>
<a name="line-261"></a>
<a name="line-262"></a><a name="HAppendList"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HAppendList</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-keyword'>where</span>
<a name="line-263"></a>  <span class='hs-comment'>-- | the same as 'hAppend'</span>
<a name="line-264"></a>  <span class='hs-varid'>hAppendList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-265"></a>
<a name="line-266"></a><a name="instance%20HAppendList%20'%5b%5d%20l2"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>l2</span> <span class='hs-keyword'>where</span>
<a name="line-267"></a>  <span class='hs-varid'>hAppendList</span> <span class='hs-conid'>HNil</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-268"></a>
<a name="line-269"></a><a name="instance%20HAppendList%20(x%20':%20l)%20l'"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendList</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppendList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-keyword'>where</span>
<a name="line-270"></a>  <span class='hs-varid'>hAppendList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>hAppendList</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-271"></a>
<a name="line-272"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-273"></a>
<a name="line-274"></a><span class='hs-comment'>-- ** Alternative append</span>
<a name="line-275"></a>
<a name="line-276"></a>
<a name="line-277"></a><a name="append'"></a><span class='hs-comment'>-- | 'hAppend'' below is implemented using the same idea</span>
<a name="line-278"></a><span class='hs-definition'>append'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-279"></a><span class='hs-definition'>append'</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-varid'>l</span>
<a name="line-280"></a>
<a name="line-281"></a><a name="hAppend'"></a><span class='hs-comment'>-- | Alternative implementation of 'hAppend'. Demonstrates 'HFoldr'</span>
<a name="line-282"></a><span class='hs-definition'>hAppend'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HFoldr</span> <span class='hs-conid'>FHCons</span> <span class='hs-varid'>v</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-283"></a><span class='hs-definition'>hAppend'</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldr</span> <span class='hs-conid'>FHCons</span> <span class='hs-varid'>l'</span> <span class='hs-varid'>l</span>
<a name="line-284"></a>
<a name="line-285"></a><a name="FHCons"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FHCons</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FHCons</span>
<a name="line-286"></a>
<a name="line-287"></a><a name="instance%20ApplyAB%20FHCons%20x%20y"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>FHCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span>  <span class='hs-keyword'>where</span>
<a name="line-288"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span>
<a name="line-289"></a>
<a name="line-290"></a>
<a name="line-291"></a><span class='hs-comment'>-- ** Historical append</span>
<a name="line-292"></a>
<a name="line-293"></a><span class='hs-comment'>{- $
<a name="line-294"></a>
<a name="line-295"></a>The original HList code is included below. In both cases
<a name="line-296"></a>we had to program the algorithm twice, at the term and the type levels.
<a name="line-297"></a>
<a name="line-298"></a>[@The class HAppend@]
<a name="line-299"></a>
<a name="line-300"></a>&gt; class HAppend l l' l'' | l l' -&gt; l''
<a name="line-301"></a>&gt;  where
<a name="line-302"></a>&gt;   hAppend :: l -&gt; l' -&gt; l''
<a name="line-303"></a>&gt;
<a name="line-304"></a>
<a name="line-305"></a>[@The instance following the normal append@]
<a name="line-306"></a>
<a name="line-307"></a>&gt; instance HList l =&gt; HAppend HNil l l
<a name="line-308"></a>&gt;  where
<a name="line-309"></a>&gt;   hAppend HNil l = l
<a name="line-310"></a>&gt;
<a name="line-311"></a>&gt; instance (HList l, HAppend l l' l'')
<a name="line-312"></a>&gt;       =&gt; HAppend (HCons x l) l' (HCons x l'')
<a name="line-313"></a>&gt;  where
<a name="line-314"></a>&gt;   hAppend (HCons x l) l' = HCons x (hAppend l l')
<a name="line-315"></a>
<a name="line-316"></a>-}</span>
<a name="line-317"></a>
<a name="line-318"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-319"></a><span class='hs-comment'>-- * Reversing HLists</span>
<a name="line-320"></a>
<a name="line-321"></a><span class='hs-comment'>-- Append the reversed l1 to l2</span>
<a name="line-322"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HRevAppR</span> <span class='hs-layout'>(</span><span class='hs-varid'>l1</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span>
<a name="line-323"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HRevAppR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-324"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HRevAppR</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HRevAppR</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-325"></a>
<a name="line-326"></a>
<a name="line-327"></a><a name="HRevApp"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HRevApp</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-varid'>l3</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l3</span> <span class='hs-keyword'>where</span>
<a name="line-328"></a>    <span class='hs-varid'>hRevApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l3</span>
<a name="line-329"></a>
<a name="line-330"></a><a name="instance%20HRevApp%20'%5b%5d%20l2%20l2"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HRevApp</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>l2</span> <span class='hs-varid'>l2</span> <span class='hs-keyword'>where</span>
<a name="line-331"></a>    <span class='hs-varid'>hRevApp</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-332"></a>
<a name="line-333"></a><a name="instance%20HRevApp%20(x%20':%20l)%20l'%20z"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HRevApp</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HRevApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-varid'>z</span> <span class='hs-keyword'>where</span>
<a name="line-334"></a>    <span class='hs-varid'>hRevApp</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hRevApp</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-335"></a>
<a name="line-336"></a>
<a name="line-337"></a>
<a name="line-338"></a><a name="HReverse"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HReverse</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>sx</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sx</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>where</span>
<a name="line-339"></a>    <span class='hs-varid'>hReverse</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>sx</span>
<a name="line-340"></a>
<a name="line-341"></a><a name="instance%20HReverse%20xs%20sx"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HRevApp</span> <span class='hs-varid'>xs</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>sx</span><span class='hs-layout'>,</span>
<a name="line-342"></a>          <span class='hs-conid'>HRevApp</span> <span class='hs-varid'>sx</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HReverse</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>sx</span> <span class='hs-keyword'>where</span>
<a name="line-343"></a>    <span class='hs-varid'>hReverse</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hRevApp</span> <span class='hs-varid'>l</span> <span class='hs-conid'>HNil</span>
<a name="line-344"></a>
<a name="line-345"></a><a name="hReverse_"></a><span class='hs-comment'>-- | a version of 'hReverse' that does not allow the type</span>
<a name="line-346"></a><span class='hs-comment'>-- information to flow backwards</span>
<a name="line-347"></a><span class='hs-definition'>hReverse_</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hRevApp</span> <span class='hs-varid'>l</span> <span class='hs-conid'>HNil</span>
<a name="line-348"></a>
<a name="line-349"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-350"></a>
<a name="line-351"></a><span class='hs-comment'>--</span>
<a name="line-352"></a><span class='hs-comment'>-- * A nicer notation for lists</span>
<a name="line-353"></a><span class='hs-comment'>--</span>
<a name="line-354"></a>
<a name="line-355"></a>
<a name="line-356"></a><a name="hEnd"></a><span class='hs-comment'>-- | List termination</span>
<a name="line-357"></a><span class='hs-definition'>hEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span>
<a name="line-358"></a><span class='hs-definition'>hEnd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-359"></a>
<a name="line-360"></a><span class='hs-comment'>{- ^
<a name="line-361"></a>   Note:
<a name="line-362"></a>
<a name="line-363"></a>        [@x :: HList a@] means: @forall a. x :: HList a@
<a name="line-364"></a>
<a name="line-365"></a>        [@hEnd x@] means: @exists a. x :: HList a@
<a name="line-366"></a>-}</span>
<a name="line-367"></a>
<a name="line-368"></a>
<a name="line-369"></a><span class='hs-comment'>-- |  Building lists</span>
<a name="line-370"></a>
<a name="line-371"></a><a name="hBuild"></a><span class='hs-definition'>hBuild</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HBuild'</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>r</span>
<a name="line-372"></a><span class='hs-definition'>hBuild</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>hBuild'</span> <span class='hs-conid'>HNil</span>
<a name="line-373"></a>
<a name="line-374"></a><a name="HBuild'"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HBuild'</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>where</span>
<a name="line-375"></a>    <span class='hs-varid'>hBuild'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-376"></a>
<a name="line-377"></a><a name="instance%20HBuild'%20l%20(HList%20l')"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HReverse</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span>
<a name="line-378"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HBuild'</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-379"></a>  <span class='hs-varid'>hBuild'</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hReverse</span> <span class='hs-varid'>l</span>
<a name="line-380"></a>
<a name="line-381"></a><a name="instance%20HBuild'%20l%20(a-%3er)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HBuild'</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-382"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HBuild'</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-383"></a>  <span class='hs-varid'>hBuild'</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hBuild'</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-384"></a>
<a name="line-385"></a><span class='hs-comment'>-- ** examples</span>
<a name="line-386"></a><span class='hs-comment'>{- $examplesNote
<a name="line-387"></a>
<a name="line-388"></a>The classes above allow the third (shortest) way to make a list
<a name="line-389"></a>(containing a,b,c) in this case
<a name="line-390"></a>
<a name="line-391"></a>&gt; list = a `HCons` b `HCons` c `HCons` HNil
<a name="line-392"></a>&gt; list = a .*. b .*. c .*. HNil
<a name="line-393"></a>&gt; list = hEnd $ hBuild a b c
<a name="line-394"></a>
<a name="line-395"></a>&gt;&gt;&gt; let x = hBuild True in hEnd x
<a name="line-396"></a>H[True]
<a name="line-397"></a>
<a name="line-398"></a>&gt;&gt;&gt; let x = hBuild True 'a' in hEnd x
<a name="line-399"></a>H[True,'a']
<a name="line-400"></a>
<a name="line-401"></a>&gt;&gt;&gt; let x = hBuild True 'a' "ok" in hEnd x
<a name="line-402"></a>H[True,'a',"ok"]
<a name="line-403"></a>
<a name="line-404"></a>hBuild can also produce a Record, such that
<a name="line-405"></a>
<a name="line-406"></a>&gt; hBuild x y ^. from unlabeled
<a name="line-407"></a>
<a name="line-408"></a>can also be produced using
<a name="line-409"></a>
<a name="line-410"></a>@
<a name="line-411"></a>'hEndR' $ hBuild x y
<a name="line-412"></a>@
<a name="line-413"></a>
<a name="line-414"></a>-}</span>
<a name="line-415"></a>
<a name="line-416"></a><span class='hs-comment'>-- *** historical</span>
<a name="line-417"></a><span class='hs-comment'>{- $hbuild the show instance has since changed, but these uses of
<a name="line-418"></a>'hBuild'/'hEnd' still work
<a name="line-419"></a>
<a name="line-420"></a>&gt; HList&gt; let x = hBuild True in hEnd x
<a name="line-421"></a>&gt; HCons True HNil
<a name="line-422"></a>
<a name="line-423"></a>&gt; HList&gt; let x = hBuild True 'a' in hEnd x
<a name="line-424"></a>&gt; HCons True (HCons 'a' HNil)
<a name="line-425"></a>
<a name="line-426"></a>&gt; HList&gt; let x = hBuild True 'a' "ok" in hEnd x
<a name="line-427"></a>&gt; HCons True (HCons 'a' (HCons "ok" HNil))
<a name="line-428"></a>
<a name="line-429"></a>&gt; HList&gt; hEnd (hBuild (Key 42) (Name "Angus") Cow (Price 75.5))
<a name="line-430"></a>&gt; HCons (Key 42) (HCons (Name "Angus") (HCons Cow (HCons (Price 75.5) HNil)))
<a name="line-431"></a>
<a name="line-432"></a>&gt; HList&gt; hEnd (hBuild (Key 42) (Name "Angus") Cow (Price 75.5)) == angus
<a name="line-433"></a>&gt; True
<a name="line-434"></a>
<a name="line-435"></a>-}</span>
<a name="line-436"></a>
<a name="line-437"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-438"></a>
<a name="line-439"></a><span class='hs-comment'>-- * folds</span>
<a name="line-440"></a><span class='hs-comment'>-- ** foldr</span>
<a name="line-441"></a><span class='hs-comment'>-- $foldNote  Consume a heterogenous list.</span>
<a name="line-442"></a>
<a name="line-443"></a>
<a name="line-444"></a><a name="HFoldr"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>where</span>
<a name="line-445"></a>    <span class='hs-varid'>hFoldr</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-446"></a>
<a name="line-447"></a><a name="instance%20HFoldr%20f%20v%20'%5b%5d%20v'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>v'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>v'</span> <span class='hs-keyword'>where</span>
<a name="line-448"></a>    <span class='hs-varid'>hFoldr</span>       <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span>
<a name="line-449"></a>
<a name="line-450"></a><a name="instance%20HFoldr%20f%20v%20(e%20':%20l)%20r'"></a><span class='hs-comment'>-- | uses 'ApplyAB' not 'Apply'</span>
<a name="line-451"></a><a name="instance%20HFoldr%20f%20v%20(e%20':%20l)%20r'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>r'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-452"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r'</span> <span class='hs-keyword'>where</span>
<a name="line-453"></a>    <span class='hs-varid'>hFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>hFoldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-454"></a>
<a name="line-455"></a>
<a name="line-456"></a><a name="HScanr"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>ls</span> <span class='hs-varid'>rs</span> <span class='hs-keyword'>where</span>
<a name="line-457"></a>    <span class='hs-varid'>hScanr</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ls</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>rs</span>
<a name="line-458"></a>
<a name="line-459"></a><a name="instance%20HScanr%20f%20z%20'%5b%5d%20lz"></a><span class='hs-keyword'>instance</span> <span class='hs-varid'>lz</span> <span class='hs-keyglyph'>~</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>z</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>lz</span> <span class='hs-keyword'>where</span>
<a name="line-460"></a>    <span class='hs-varid'>hScanr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>z</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>z</span> <span class='hs-conid'>HNil</span>
<a name="line-461"></a>
<a name="line-462"></a><a name="instance%20HScanr%20f%20z%20(x%20':%20xs)%20srrs"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>HScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-463"></a>          <span class='hs-varid'>srrs</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>r</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>srrs</span> <span class='hs-keyword'>where</span>
<a name="line-464"></a>    <span class='hs-varid'>hScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-465"></a>        <span class='hs-keyword'>case</span> <span class='hs-varid'>hScanr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-466"></a>            <span class='hs-conid'>HCons</span> <span class='hs-varid'>r</span> <span class='hs-varid'>rs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>r</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>rs</span>
<a name="line-467"></a>
<a name="line-468"></a><a name="HFoldr1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>where</span>
<a name="line-469"></a>    <span class='hs-varid'>hFoldr1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-470"></a>
<a name="line-471"></a><a name="instance%20HFoldr1%20f%20'%5bv%5d%20v'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>v'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>v'</span> <span class='hs-keyword'>where</span>
<a name="line-472"></a>    <span class='hs-varid'>hFoldr1</span>      <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span>
<a name="line-473"></a>
<a name="line-474"></a><a name="instance%20HFoldr1%20f%20(e%20':%20e'%20':%20l)%20r'"></a><span class='hs-comment'>-- | uses 'ApplyAB' not 'Apply'</span>
<a name="line-475"></a><a name="instance%20HFoldr1%20f%20(e%20':%20e'%20':%20l)%20r'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>r'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-476"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r'</span> <span class='hs-keyword'>where</span>
<a name="line-477"></a>    <span class='hs-varid'>hFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>hFoldr1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-478"></a>
<a name="line-479"></a>
<a name="line-480"></a><span class='hs-comment'>-- ** foldl</span>
<a name="line-481"></a>
<a name="line-482"></a><a name="HFoldl"></a><span class='hs-comment'>{- | like 'foldl'
<a name="line-483"></a>
<a name="line-484"></a>
<a name="line-485"></a>&gt;&gt;&gt; hFoldl (uncurry $ flip (:)) [] (1 `HCons` 2 `HCons` HNil)
<a name="line-486"></a>[2,1]
<a name="line-487"></a>
<a name="line-488"></a>
<a name="line-489"></a>-}</span>
<a name="line-490"></a><a name="HFoldl"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFoldl</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-491"></a>    <span class='hs-varid'>hFoldl</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-492"></a>
<a name="line-493"></a><a name="instance%20HFoldl%20f%20z%20(x%20':%20xs)%20r"></a><span class='hs-keyword'>instance</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>z'</span> <span class='hs-varid'>r</span> <span class='hs-varid'>x</span> <span class='hs-varid'>zx</span> <span class='hs-varid'>xs</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>zx</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>zx</span> <span class='hs-varid'>z'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HFoldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z'</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-494"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>where</span>
<a name="line-495"></a>    <span class='hs-varid'>hFoldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldl</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>z'</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-496"></a>
<a name="line-497"></a><a name="instance%20HFoldl%20f%20z%20'%5b%5d%20z'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>z'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFoldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>z'</span> <span class='hs-keyword'>where</span>
<a name="line-498"></a>    <span class='hs-varid'>hFoldl</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>z</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>z</span>
<a name="line-499"></a>
<a name="line-500"></a>
<a name="line-501"></a>
<a name="line-502"></a>
<a name="line-503"></a>
<a name="line-504"></a><span class='hs-comment'>-- * unfolds</span>
<a name="line-505"></a>
<a name="line-506"></a><span class='hs-comment'>-- ** unfold</span>
<a name="line-507"></a><span class='hs-comment'>-- $unfoldNote Produce a heterogenous list. Uses the more limited</span>
<a name="line-508"></a><span class='hs-comment'>-- 'Apply' instead of 'App' since that's all that is needed for uses of this</span>
<a name="line-509"></a><span class='hs-comment'>-- function downstream. Those could in principle be re-written.</span>
<a name="line-510"></a>
<a name="line-511"></a><a name="hUnfold"></a><span class='hs-comment'>-- hUnfold :: (Apply p s, HUnfold' p s) =&gt; p -&gt; s -&gt; HList (HUnfold p s)</span>
<a name="line-512"></a><span class='hs-definition'>hUnfold</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hUnfold'</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>apply</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-513"></a>
<a name="line-514"></a><a name="HUnfold"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HUnfold</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HUnfoldR</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyR</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-515"></a>
<a name="line-516"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HUnfoldR</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-517"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HUnfoldR</span> <span class='hs-varid'>p</span> <span class='hs-conid'>HNothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-518"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HUnfoldR</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HUnfoldR</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyR</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-519"></a>
<a name="line-520"></a><a name="HUnfold'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HUnfold'</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HUnfoldFD</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyR</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HUnfold</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-521"></a>
<a name="line-522"></a><a name="HUnfoldFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HUnfoldFD</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>p</span> <span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-keyword'>where</span>
<a name="line-523"></a>    <span class='hs-varid'>hUnfold'</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>z</span>
<a name="line-524"></a>
<a name="line-525"></a><a name="instance%20HUnfoldFD%20p%20HNothing%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HUnfoldFD</span> <span class='hs-varid'>p</span> <span class='hs-conid'>HNothing</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-526"></a>    <span class='hs-varid'>hUnfold'</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-527"></a>
<a name="line-528"></a><a name="instance%20HUnfoldFD%20p%20(HJust%20(e,s))%20(e%20':%20z)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Apply</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>HUnfoldFD</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyR</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HUnfoldFD</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-529"></a>    <span class='hs-varid'>hUnfold'</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>hUnfold</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-530"></a>
<a name="line-531"></a>
<a name="line-532"></a><span class='hs-comment'>-- ** replicate</span>
<a name="line-533"></a>
<a name="line-534"></a><a name="HReplicateFD"></a><span class='hs-comment'>{- |
<a name="line-535"></a>
<a name="line-536"></a>Sometimes the result type can fix the type of the
<a name="line-537"></a>first argument:
<a name="line-538"></a>
<a name="line-539"></a>&gt;&gt;&gt; hReplicate Proxy () :: HList '[ (), (), () ]
<a name="line-540"></a>H[(),(),()]
<a name="line-541"></a>
<a name="line-542"></a>However, with HReplicate all elements must have the same type, so it may be
<a name="line-543"></a>easier to use 'HList2List':
<a name="line-544"></a>
<a name="line-545"></a>&gt;&gt;&gt; list2HList (repeat 3) :: Maybe (HList [Int, Int, Int])
<a name="line-546"></a>Just H[3,3,3]
<a name="line-547"></a>
<a name="line-548"></a>-}</span>
<a name="line-549"></a><a name="HReplicateFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>es</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HReplicateFD</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-varid'>es</span>
<a name="line-550"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>es</span><span class='hs-layout'>,</span> <span class='hs-varid'>es</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span>
<a name="line-551"></a>    <span class='hs-varid'>hReplicate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>es</span>
<a name="line-552"></a>
<a name="line-553"></a><a name="instance%20HReplicateFD%20HZero%20e%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HReplicateFD</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-554"></a>    <span class='hs-varid'>hReplicate</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-555"></a>
<a name="line-556"></a><a name="instance%20HReplicateFD%20(HSucc%20n)%20e%20(e'%20':%20es)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HReplicateFD</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>es</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HReplicateFD</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-557"></a>    <span class='hs-varid'>hReplicate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hReplicate</span> <span class='hs-layout'>(</span><span class='hs-varid'>hPred</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-558"></a>
<a name="line-559"></a><a name="HReplicate"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HReplicate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HReplicateFD</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>HReplicateR</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-560"></a>
<a name="line-561"></a><span class='hs-comment'>-- | would be associated with 'HReplicate' except we want</span>
<a name="line-562"></a><span class='hs-comment'>-- it to work with `e` of any kind, not just `*` that you can</span>
<a name="line-563"></a><span class='hs-comment'>-- put into a HList. An \"inverse\" of 'HLength'</span>
<a name="line-564"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HReplicateR</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span>
<a name="line-565"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HReplicateR</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-566"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HReplicateR</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HReplicateR</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span>
<a name="line-567"></a>
<a name="line-568"></a><a name="HReplicateF"></a><span class='hs-comment'>{- | HReplicate produces lists that can be converted to ordinary
<a name="line-569"></a>lists
<a name="line-570"></a>
<a name="line-571"></a>&gt;&gt;&gt; let two = hSucc (hSucc hZero)
<a name="line-572"></a>&gt;&gt;&gt; let f = Fun' fromInteger :: Fun' Num Integer
<a name="line-573"></a>
<a name="line-574"></a>&gt;&gt;&gt; :t applyAB f
<a name="line-575"></a>applyAB f :: Num b =&gt; Integer -&gt; b
<a name="line-576"></a>
<a name="line-577"></a>&gt;&gt;&gt; hReplicateF two f 3
<a name="line-578"></a>H[3,3]
<a name="line-579"></a>
<a name="line-580"></a>&gt;&gt;&gt; hReplicateF Proxy f 3 :: HList [Int, Double, Integer]
<a name="line-581"></a>H[3,3.0,3]
<a name="line-582"></a>
<a name="line-583"></a>-}</span>
<a name="line-584"></a><a name="HReplicateF"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>r</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HReplicateF</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span>
<a name="line-585"></a>    <span class='hs-varid'>hReplicateF</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>r</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>r</span>
<a name="line-586"></a>
<a name="line-587"></a><a name="instance%20HReplicateF%20HZero%20f%20z%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HReplicateF</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-588"></a>    <span class='hs-varid'>hReplicateF</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-589"></a>
<a name="line-590"></a><a name="instance%20HReplicateF%20(HSucc%20n)%20f%20z%20(fz%20':%20r')"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>fz</span><span class='hs-layout'>,</span>
<a name="line-591"></a>          <span class='hs-conid'>HReplicateF</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>r'</span><span class='hs-layout'>)</span>
<a name="line-592"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HReplicateF</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>fz</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>r'</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-593"></a>    <span class='hs-varid'>hReplicateF</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hReplicateF</span> <span class='hs-layout'>(</span><span class='hs-varid'>hPred</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span>
<a name="line-594"></a>
<a name="line-595"></a><a name="HIterate"></a><span class='hs-comment'>-- ** iterate</span>
<a name="line-596"></a><a name="HIterate"></a><span class='hs-comment'>{- |
<a name="line-597"></a>
<a name="line-598"></a>This function behaves like 'iterate', with an extra
<a name="line-599"></a>argument to help figure out the result length
<a name="line-600"></a>
<a name="line-601"></a>&gt;&gt;&gt; let three = hSucc (hSucc (hSucc hZero))
<a name="line-602"></a>&gt;&gt;&gt; let f = Fun Just :: Fun '() Maybe
<a name="line-603"></a>
<a name="line-604"></a>&gt;&gt;&gt; :t applyAB f
<a name="line-605"></a>applyAB f :: a -&gt; Maybe a
<a name="line-606"></a>
<a name="line-607"></a>f is applied to different types:
<a name="line-608"></a>
<a name="line-609"></a>&gt;&gt;&gt; hIterate three f ()
<a name="line-610"></a>H[(),Just (),Just (Just ())]
<a name="line-611"></a>
<a name="line-612"></a>It is also possible to specify the length later on,
<a name="line-613"></a>as done with Prelude.'iterate'
<a name="line-614"></a>
<a name="line-615"></a>&gt;&gt;&gt; let take3 x | _ &lt;- hLength x `asTypeOf` three = x
<a name="line-616"></a>&gt;&gt;&gt; take3 $ hIterate Proxy f ()
<a name="line-617"></a>H[(),Just (),Just (Just ())]
<a name="line-618"></a>
<a name="line-619"></a>-}</span>
<a name="line-620"></a><a name="HIterate"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>r</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HIterate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>where</span>
<a name="line-621"></a>    <span class='hs-varid'>hIterate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>r</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>r</span>
<a name="line-622"></a>
<a name="line-623"></a><a name="instance%20HIterate%20HZero%20f%20z%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HIterate</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-624"></a>    <span class='hs-varid'>hIterate</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-625"></a>
<a name="line-626"></a><a name="instance%20HIterate%20(HSucc%20n)%20f%20z%20(z_%20':%20r')"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>z'</span><span class='hs-layout'>,</span>
<a name="line-627"></a>      <span class='hs-conid'>HIterate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z'</span> <span class='hs-varid'>r'</span><span class='hs-layout'>,</span>
<a name="line-628"></a>      <span class='hs-varid'>z</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>z_</span><span class='hs-layout'>)</span>
<a name="line-629"></a>     <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HIterate</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>z_</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>r'</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-630"></a>    <span class='hs-varid'>hIterate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>z</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hIterate</span> <span class='hs-layout'>(</span><span class='hs-varid'>hPred</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>z'</span><span class='hs-layout'>)</span>
<a name="line-631"></a>
<a name="line-632"></a><span class='hs-comment'>-- * concat</span>
<a name="line-633"></a>
<a name="line-634"></a><a name="HConcat"></a><span class='hs-comment'>{- |
<a name="line-635"></a>
<a name="line-636"></a>Like 'concat' but for HLists of HLists.
<a name="line-637"></a>
<a name="line-638"></a>Works in ghci... puzzling as what is different in doctest (it isn't
<a name="line-639"></a>@-XExtendedDefaultRules@)
<a name="line-640"></a>
<a name="line-641"></a>&gt;&gt;&gt; let a = hEnd $ hBuild 1 2 3
<a name="line-642"></a>&gt;&gt;&gt; let b = hEnd $ hBuild 'a' "abc"
<a name="line-643"></a>&gt;&gt;&gt; hConcat $ hBuild a b
<a name="line-644"></a>H[1, 2, 3, 'a', "abc"]
<a name="line-645"></a>
<a name="line-646"></a>-}</span>
<a name="line-647"></a><a name="HConcat"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HConcat</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HConcatFD</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-conid'>HConcatR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-648"></a>
<a name="line-649"></a><a name="hConcat"></a><span class='hs-definition'>hConcat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HConcat</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HConcatR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-650"></a><span class='hs-definition'>hConcat</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hConcatFD</span> <span class='hs-varid'>x</span>
<a name="line-651"></a>
<a name="line-652"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HConcatR</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-653"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HConcatR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-654"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HConcatR</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HAppendListR</span> <span class='hs-layout'>(</span><span class='hs-conid'>UnHList</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HConcatR</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-655"></a>
<a name="line-656"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>UnHList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-657"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>UnHList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-658"></a>
<a name="line-659"></a><a name="HConcatFD"></a><span class='hs-comment'>-- for the benefit of ghc-7.10.1</span>
<a name="line-660"></a><a name="HConcatFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HConcatFD</span> <span class='hs-varid'>xxs</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xs</span>
<a name="line-661"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>hConcatFD</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span>
<a name="line-662"></a>
<a name="line-663"></a><a name="instance%20HConcatFD%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HConcatFD</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-664"></a>    <span class='hs-varid'>hConcatFD</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-665"></a>
<a name="line-666"></a><a name="instance%20HConcatFD%20(HList%20a%20':%20as)%20cs"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HConcatFD</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span><span class='hs-layout'>,</span> <span class='hs-conid'>HAppendFD</span> <span class='hs-varid'>a</span> <span class='hs-varid'>bs</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HConcatFD</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span> <span class='hs-keyword'>where</span>
<a name="line-667"></a>    <span class='hs-varid'>hConcatFD</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`hAppendFD`</span> <span class='hs-varid'>hConcatFD</span> <span class='hs-varid'>xs</span>
<a name="line-668"></a>
<a name="line-669"></a><a name="HAppendFD"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HAppendFD</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>ab</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ab</span> <span class='hs-keyword'>where</span>
<a name="line-670"></a>    <span class='hs-varid'>hAppendFD</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ab</span>
<a name="line-671"></a>
<a name="line-672"></a><a name="instance%20HAppendFD%20'%5b%5d%20b%20b"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendFD</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>b</span> <span class='hs-varid'>b</span> <span class='hs-keyword'>where</span>
<a name="line-673"></a>    <span class='hs-varid'>hAppendFD</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b</span>
<a name="line-674"></a>
<a name="line-675"></a><a name="instance%20HAppendFD%20(a%20':%20as)%20bs%20(a%20':%20cs)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendFD</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppendFD</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>bs</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-676"></a>    <span class='hs-varid'>hAppendFD</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>bs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hAppendFD</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span>
<a name="line-677"></a>
<a name="line-678"></a>
<a name="line-679"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-680"></a><span class='hs-comment'>-- * traversing HLists</span>
<a name="line-681"></a>
<a name="line-682"></a><span class='hs-comment'>-- ** producing HList</span>
<a name="line-683"></a><span class='hs-comment'>-- *** map</span>
<a name="line-684"></a><span class='hs-comment'>-- $mapNote It could be implemented with 'hFoldr', as we show further below</span>
<a name="line-685"></a>
<a name="line-686"></a><span class='hs-comment'>{- | hMap is written such that the length of the result list
<a name="line-687"></a>can be determined from the length of the argument list (and
<a name="line-688"></a>the other way around). Similarly, the type of the elements
<a name="line-689"></a>of the list is propagated in both directions too.
<a name="line-690"></a>
<a name="line-691"></a>&gt;&gt;&gt; :set -XNoMonomorphismRestriction
<a name="line-692"></a>&gt;&gt;&gt; let xs = 1 .*. 'c' .*. HNil
<a name="line-693"></a>&gt;&gt;&gt; :t hMap (HJust ()) xs
<a name="line-694"></a>hMap (HJust ()) xs :: Num y =&gt; HList '[HJust y, HJust Char]
<a name="line-695"></a>
<a name="line-696"></a>
<a name="line-697"></a>These 4 examples show that the constraint on the length (2 in this case)
<a name="line-698"></a>can be applied before or after the 'hMap'. That inference is independent of the
<a name="line-699"></a>direction that type information is propagated for the individual elements.
<a name="line-700"></a>
<a name="line-701"></a>
<a name="line-702"></a>&gt;&gt;&gt; let asLen2 xs = xs `asTypeOf` (undefined :: HList '[a,b])
<a name="line-703"></a>
<a name="line-704"></a>&gt;&gt;&gt; let lr xs = asLen2 (applyAB (HMap HRead) xs)
<a name="line-705"></a>&gt;&gt;&gt; let ls xs = asLen2 (applyAB (HMap HShow) xs)
<a name="line-706"></a>&gt;&gt;&gt; let rl xs = applyAB (HMap HRead) (asLen2 xs)
<a name="line-707"></a>&gt;&gt;&gt; let sl xs = applyAB (HMap HShow) (asLen2 xs)
<a name="line-708"></a>
<a name="line-709"></a>
<a name="line-710"></a>&gt;&gt;&gt; :t lr
<a name="line-711"></a>lr
<a name="line-712"></a>  :: (Read ..., Read ...) =&gt; HList '[String, String] -&gt; HList '[..., ...]
<a name="line-713"></a>
<a name="line-714"></a>&gt;&gt;&gt; :t rl
<a name="line-715"></a>rl
<a name="line-716"></a>  :: (Read ..., Read ...) =&gt; HList '[String, String] -&gt; HList '[..., ...]
<a name="line-717"></a>
<a name="line-718"></a>
<a name="line-719"></a>&gt;&gt;&gt; :t ls
<a name="line-720"></a>ls
<a name="line-721"></a>  :: (Show ..., Show ...) =&gt; HList '[..., ...] -&gt; HList '[String, String]
<a name="line-722"></a>
<a name="line-723"></a>&gt;&gt;&gt; :t sl
<a name="line-724"></a>sl
<a name="line-725"></a>  :: (Show ..., Show ...) =&gt; HList '[..., ...] -&gt; HList '[String, String]
<a name="line-726"></a>
<a name="line-727"></a>-}</span>
<a name="line-728"></a>
<a name="line-729"></a><a name="HMap"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>HMap</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMap</span> <span class='hs-varid'>f</span>
<a name="line-730"></a>
<a name="line-731"></a><a name="hMap"></a><span class='hs-definition'>hMap</span> <span class='hs-varid'>f</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-732"></a>
<a name="line-733"></a><a name="instance%20ApplyAB%20(HMap%20f)%20as%20bs"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapCxt</span> <span class='hs-varid'>r</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>r</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>bs</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>r</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-734"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span> <span class='hs-keyword'>where</span>
<a name="line-735"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMapAux</span> <span class='hs-varid'>f</span>
<a name="line-736"></a>
<a name="line-737"></a>
<a name="line-738"></a><a name="hMapL"></a><span class='hs-comment'>-- | hMap constrained to HList</span>
<a name="line-739"></a><span class='hs-definition'>hMapL</span> <span class='hs-varid'>f</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapL</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-740"></a>
<a name="line-741"></a><a name="HMapL"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>HMapL</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMapL</span> <span class='hs-varid'>f</span>
<a name="line-742"></a>
<a name="line-743"></a><a name="instance%20ApplyAB%20(HMapL%20f)%20as%20bs"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapCxt</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>bs</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapL</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span> <span class='hs-keyword'>where</span>
<a name="line-744"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapL</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMapAux</span> <span class='hs-varid'>f</span>
<a name="line-745"></a>
<a name="line-746"></a>
<a name="line-747"></a><a name="HMapCxt"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLength</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMapAux</span> <span class='hs-varid'>r</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMapCxt</span> <span class='hs-varid'>r</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-748"></a>
<a name="line-749"></a><a name="instance%20HMapCxt%20r%20f%20a%20b%20class%20HMapAux%20(r%20::%20%5b*%5d%20-%3e%20*)%20f%20(x%20::%20%5b*%5d)%20(y%20::%20%5b*%5d)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLength</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMapAux</span> <span class='hs-varid'>r</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMapCxt</span> <span class='hs-varid'>r</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-750"></a>
<a name="line-751"></a>
<a name="line-752"></a>
<a name="line-753"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMapAux</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-754"></a>  <span class='hs-varid'>hMapAux</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SameLength</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>y</span>
<a name="line-755"></a>
<a name="line-756"></a><a name="instance%20HMapAux%20HList%20f%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapAux</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>f</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-757"></a>  <span class='hs-varid'>hMapAux</span>       <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-758"></a>
<a name="line-759"></a><a name="instance%20HMapAux%20HList%20f%20(e%20':%20l)%20(e'%20':%20l')"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMapAux</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>,</span> <span class='hs-conid'>SameLength</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<a name="line-760"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMapAux</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-761"></a>  <span class='hs-varid'>hMapAux</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hMapAux</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span>
<a name="line-762"></a>
<a name="line-763"></a>
<a name="line-764"></a>
<a name="line-765"></a>
<a name="line-766"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-767"></a>
<a name="line-768"></a><span class='hs-comment'>-- **** alternative implementation</span>
<a name="line-769"></a><span class='hs-comment'>-- $note currently broken</span>
<a name="line-770"></a>
<a name="line-771"></a><a name="MapCar"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span>
<a name="line-772"></a>
<a name="line-773"></a><a name="hMapMapCar"></a><span class='hs-comment'>-- | Same as 'hMap' only a different implementation.</span>
<a name="line-774"></a><span class='hs-definition'>hMapMapCar</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-775"></a>    <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l'</span>
<a name="line-776"></a><span class='hs-definition'>hMapMapCar</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-conid'>HNil</span>
<a name="line-777"></a>
<a name="line-778"></a><a name="instance%20ApplyAB%20(MapCar%20f)%20(e,HList%20l)%20(HList%20(e'%20':%20l))"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e'</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-779"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>MapCar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-780"></a>
<a name="line-781"></a>
<a name="line-782"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-783"></a>
<a name="line-784"></a><a name="hComposeList"></a><span class='hs-comment'>-- *** @appEndo . mconcat . map Endo@</span>
<a name="line-785"></a><span class='hs-comment'>{- |
<a name="line-786"></a>
<a name="line-787"></a>&gt;&gt;&gt; let xs = length .*. (+1) .*. (*2) .*. HNil
<a name="line-788"></a>&gt;&gt;&gt; hComposeList xs "abc"
<a name="line-789"></a>8
<a name="line-790"></a>
<a name="line-791"></a>
<a name="line-792"></a>-}</span>
<a name="line-793"></a><span class='hs-definition'>hComposeList</span>
<a name="line-794"></a>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HFoldr</span> <span class='hs-conid'>Comp</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-795"></a><span class='hs-definition'>hComposeList</span> <span class='hs-varid'>fs</span> <span class='hs-varid'>v0</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Comp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Comp</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`asTypeOf`</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>fs</span> <span class='hs-varid'>v0</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>r</span>
<a name="line-796"></a>
<a name="line-797"></a>
<a name="line-798"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-799"></a>
<a name="line-800"></a><span class='hs-comment'>-- *** sequence</span>
<a name="line-801"></a><span class='hs-comment'>{- |
<a name="line-802"></a>   A heterogeneous version of
<a name="line-803"></a>
<a name="line-804"></a>   &gt; sequenceA :: (Applicative m) =&gt; [m a] -&gt; m [a]
<a name="line-805"></a>
<a name="line-806"></a>   Only now we operate on heterogeneous lists, where different elements
<a name="line-807"></a>   may have different types 'a'.
<a name="line-808"></a>   In the argument list of monadic values (m a_i),
<a name="line-809"></a>   although a_i may differ, the monad 'm' must be the same for all
<a name="line-810"></a>   elements. That's why we needed "Data.HList.TypeCastGeneric2" (currently (~)).
<a name="line-811"></a>   The typechecker will complain
<a name="line-812"></a>   if we attempt to use hSequence on a HList of monadic values with different
<a name="line-813"></a>   monads.
<a name="line-814"></a>
<a name="line-815"></a>   The 'hSequence' problem was posed by Matthias Fischmann
<a name="line-816"></a>   in his message on the Haskell-Cafe list on Oct 8, 2006
<a name="line-817"></a>
<a name="line-818"></a>   &lt;<a href="http://www.haskell.org/pipermail/haskell-cafe/2006-October/018708.html">http://www.haskell.org/pipermail/haskell-cafe/2006-October/018708.html</a>&gt;
<a name="line-819"></a>
<a name="line-820"></a>   &lt;<a href="http://www.haskell.org/pipermail/haskell-cafe/2006-October/018784.html">http://www.haskell.org/pipermail/haskell-cafe/2006-October/018784.html</a>&gt;
<a name="line-821"></a> -}</span>
<a name="line-822"></a>
<a name="line-823"></a><a name="HSequence"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>Applicative</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>SameLength</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSequence</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-824"></a>    <span class='hs-varid'>hSequence</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-825"></a><span class='hs-comment'>{- ^
<a name="line-826"></a>
<a name="line-827"></a>[@Maybe@]
<a name="line-828"></a>
<a name="line-829"></a>&gt;&gt;&gt; hSequence $ Just (1 :: Integer) `HCons` (Just 'c') `HCons` HNil
<a name="line-830"></a>Just H[1,'c']
<a name="line-831"></a>
<a name="line-832"></a>&gt;&gt;&gt; hSequence $  return 1 `HCons` Just  'c' `HCons` HNil
<a name="line-833"></a>Just H[1,'c']
<a name="line-834"></a>
<a name="line-835"></a>
<a name="line-836"></a>[@List@]
<a name="line-837"></a>
<a name="line-838"></a>&gt;&gt;&gt; hSequence $ [1] `HCons` ['c'] `HCons` HNil
<a name="line-839"></a>[H[1,'c']]
<a name="line-840"></a>
<a name="line-841"></a>
<a name="line-842"></a>-}</span>
<a name="line-843"></a>
<a name="line-844"></a><a name="instance%20HSequence%20m%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Applicative</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSequence</span> <span class='hs-varid'>m</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-845"></a>    <span class='hs-varid'>hSequence</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>HNil</span>
<a name="line-846"></a>
<a name="line-847"></a><a name="instance%20HSequence%20m%20(m1%20a%20':%20as)%20(a%20':%20bs)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>m1</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Applicative</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>HSequence</span> <span class='hs-varid'>m</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-848"></a>    <span class='hs-conid'>HSequence</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>m1</span> <span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-849"></a>    <span class='hs-varid'>hSequence</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>hSequence</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-850"></a>
<a name="line-851"></a><span class='hs-comment'>-- **** alternative implementation</span>
<a name="line-852"></a>
<a name="line-853"></a><span class='hs-comment'>-- | 'hSequence2' is not recommended over 'hSequence' since it possibly doesn't</span>
<a name="line-854"></a><span class='hs-comment'>-- allow inferring argument types from the result types. Otherwise this version</span>
<a name="line-855"></a><span class='hs-comment'>-- should do exactly the same thing.</span>
<a name="line-856"></a><span class='hs-comment'>--</span>
<a name="line-857"></a><span class='hs-comment'>-- The DataKinds version needs a little help to find the type of the</span>
<a name="line-858"></a><span class='hs-comment'>-- return HNil, unlike the original version, which worked just fine as</span>
<a name="line-859"></a><span class='hs-comment'>--</span>
<a name="line-860"></a><span class='hs-comment'>--  &gt; hSequence l = hFoldr ConsM (return HNil) l</span>
<a name="line-861"></a>
<a name="line-862"></a><a name="hSequence2"></a><span class='hs-definition'>hSequence2</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span>
<a name="line-863"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>rHNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>HNil</span> <span class='hs-varop'>`asTypeOf`</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>undefined</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-864"></a>        <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LiftA2</span> <span class='hs-conid'>FHCons</span><span class='hs-layout'>)</span> <span class='hs-varid'>rHNil</span> <span class='hs-varid'>l</span>
<a name="line-865"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>x</span>
<a name="line-866"></a>
<a name="line-867"></a>
<a name="line-868"></a>
<a name="line-869"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-870"></a>
<a name="line-871"></a>
<a name="line-872"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-873"></a><span class='hs-comment'>-- ** producing homogenous lists</span>
<a name="line-874"></a>
<a name="line-875"></a><span class='hs-comment'>-- *** map (no sequencing)</span>
<a name="line-876"></a><span class='hs-comment'>-- $mapOut This one we implement via hFoldr</span>
<a name="line-877"></a>
<a name="line-878"></a><a name="Mapcar"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span>
<a name="line-879"></a>
<a name="line-880"></a><a name="instance%20ApplyAB%20(Mapcar%20f)%20el%20l"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>~</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e'</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e'</span><span class='hs-layout'>,</span> <span class='hs-varid'>el</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>el</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>where</span>
<a name="line-881"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>applyAB</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-varid'>l</span>
<a name="line-882"></a>
<a name="line-883"></a><a name="HMapOut"></a><span class='hs-comment'>-- A synonym for the complex constraint</span>
<a name="line-884"></a><a name="HMapOut"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HMapOut</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-885"></a>
<a name="line-886"></a><a name="hMapOut"></a><span class='hs-comment'>-- | compare @hMapOut f@ with @'hList2List' . 'hMap' f@</span>
<a name="line-887"></a><span class='hs-definition'>hMapOut</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span><span class='hs-varop'>.</span> <span class='hs-conid'>HMapOut</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-888"></a><span class='hs-definition'>hMapOut</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hFoldr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mapcar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-889"></a>
<a name="line-890"></a>
<a name="line-891"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-892"></a><span class='hs-comment'>-- *** mapM</span>
<a name="line-893"></a>
<a name="line-894"></a><span class='hs-comment'>-- |</span>
<a name="line-895"></a><span class='hs-comment'>--</span>
<a name="line-896"></a><span class='hs-comment'>-- &gt; mapM :: forall b m a. (Monad m) =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]</span>
<a name="line-897"></a><span class='hs-comment'>--</span>
<a name="line-898"></a><span class='hs-comment'>-- Likewise for 'mapM_'.</span>
<a name="line-899"></a><span class='hs-comment'>--</span>
<a name="line-900"></a><span class='hs-comment'>-- See 'hSequence' if the result list should also be heterogenous.</span>
<a name="line-901"></a>
<a name="line-902"></a><a name="hMapM"></a><span class='hs-definition'>hMapM</span>   <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMapOut</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>m</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-903"></a><span class='hs-definition'>hMapM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>hMapOut</span> <span class='hs-varid'>f</span>
<a name="line-904"></a>
<a name="line-905"></a><a name="hMapM_"></a><span class='hs-comment'>-- | GHC doesn't like its own type.</span>
<a name="line-906"></a><span class='hs-comment'>--</span>
<a name="line-907"></a><span class='hs-comment'>-- &gt; hMapM_ :: forall m a f e. (Monad m, HMapOut f a (m e)) =&gt; f -&gt; a -&gt; m ()</span>
<a name="line-908"></a><span class='hs-comment'>--</span>
<a name="line-909"></a><span class='hs-comment'>-- Without explicit type signature, it's Ok. Sigh.</span>
<a name="line-910"></a><span class='hs-comment'>-- Anyway, Hugs does insist on a better type. So we restrict as follows:</span>
<a name="line-911"></a><span class='hs-comment'>--</span>
<a name="line-912"></a><span class='hs-definition'>hMapM_</span>   <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMapOut</span> <span class='hs-varid'>f</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-913"></a><span class='hs-definition'>hMapM_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>sequence_</span> <span class='hs-varop'>.</span>  <span class='hs-varid'>disambiguate</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hMapM</span> <span class='hs-varid'>f</span>
<a name="line-914"></a> <span class='hs-keyword'>where</span>
<a name="line-915"></a>  <span class='hs-varid'>disambiguate</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>q</span> <span class='hs-conid'>()</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>q</span> <span class='hs-conid'>()</span><span class='hs-keyglyph'>]</span>
<a name="line-916"></a>  <span class='hs-varid'>disambiguate</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>id</span>
<a name="line-917"></a>
<a name="line-918"></a>
<a name="line-919"></a>
<a name="line-920"></a>
<a name="line-921"></a>
<a name="line-922"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-923"></a><span class='hs-comment'>-- * Ensure a list to contain HNats only</span>
<a name="line-924"></a><span class='hs-comment'>-- | We do so constructively, converting the HList whose elements</span>
<a name="line-925"></a><span class='hs-comment'>-- are Proxy HNat to [HNat]. The latter kind is unpopulated and</span>
<a name="line-926"></a><span class='hs-comment'>-- is present only at the type level.</span>
<a name="line-927"></a>
<a name="line-928"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HNats</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HNat</span><span class='hs-keyglyph'>]</span>
<a name="line-929"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HNats</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-930"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HNats</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HNats</span> <span class='hs-varid'>l</span>
<a name="line-931"></a>
<a name="line-932"></a><a name="hNats"></a><span class='hs-definition'>hNats</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNats</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-933"></a><span class='hs-definition'>hNats</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span>
<a name="line-934"></a>
<a name="line-935"></a>
<a name="line-936"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-937"></a><span class='hs-comment'>-- * Membership tests</span>
<a name="line-938"></a>
<a name="line-939"></a><span class='hs-comment'>-- | Check to see if an HList contains an element with a given type</span>
<a name="line-940"></a><span class='hs-comment'>-- This is a type-level only test</span>
<a name="line-941"></a>
<a name="line-942"></a><a name="HMember"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMember</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-943"></a><a name="instance%20HMember%20e1%20(e%20':%20l)%20br%20class%20HMember'%20(b0%20::%20Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(b%20::%20Bool)%20%7c%20b0%20e1%20l%20-%3e%20b%20instance%20HMember'%20True%20e1%20l%20True%20instance%20(HMember%20e1%20l%20br)%20=%3e%20HMember'%20False%20e1%20l%20br%20--%20%7c%20The%20following%20is%20a%20similar%20type-only%20membership%20test%20--%20It%20uses%20the%20user-supplied%20curried%20type%20equality%20predicate%20pred%20type%20family%20HMemberP%20pred%20e1%20(l%20::%20%5b*%5d)%20::%20Bool%20type%20instance%20HMemberP%20pred%20e1%20'%5b%5d%20=%20False%20type%20instance%20HMemberP%20pred%20e1%20(e%20':%20l)%20=%20HMemberP'%20pred%20e1%20l%20(ApplyR%20pred%20(e1,e))%20type%20family%20HMemberP'%20pred%20e1%20(l%20::%20%5b*%5d)%20pb%20::%20Bool%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20True)%20=%20True%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20False)%20=%20HMemberP%20pred%20e1%20l%20hMember%20::%20HMember%20e%20l%20b%20=%3e%20Proxy%20e%20-%3e%20Proxy%20l%20-%3e%20Proxy%20b%20hMember%20_%20_%20=%20Proxy%20--%20**%20Another%20type-level%20membership%20test%20--%20--%20%7c%20Check%20to%20see%20if%20an%20element%20e%20occurs%20in%20a%20list%20l%20--%20If%20not,%20return%20'Nothing%20--%20If%20the%20element%20does%20occur,%20return%20'Just%20l1%20--%20where%20l1%20is%20a%20type-level%20list%20without%20e%20class%20HMemberM%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r%20::%20Maybe%20%5bk%5d)%20%7c%20e1%20l%20-%3e%20r%20instance%20HMemberM%20e1%20'%5b%5d%20'Nothing%20instance%20(HEq%20e1%20e%20b,%20HMemberM1%20b%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMember</span> <span class='hs-varid'>e1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-conid'>False</span>
<a name="line-944"></a><a name="instance%20HMember%20e1%20(e%20':%20l)%20br%20class%20HMember'%20(b0%20::%20Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(b%20::%20Bool)%20%7c%20b0%20e1%20l%20-%3e%20b%20instance%20HMember'%20True%20e1%20l%20True%20instance%20(HMember%20e1%20l%20br)%20=%3e%20HMember'%20False%20e1%20l%20br%20--%20%7c%20The%20following%20is%20a%20similar%20type-only%20membership%20test%20--%20It%20uses%20the%20user-supplied%20curried%20type%20equality%20predicate%20pred%20type%20family%20HMemberP%20pred%20e1%20(l%20::%20%5b*%5d)%20::%20Bool%20type%20instance%20HMemberP%20pred%20e1%20'%5b%5d%20=%20False%20type%20instance%20HMemberP%20pred%20e1%20(e%20':%20l)%20=%20HMemberP'%20pred%20e1%20l%20(ApplyR%20pred%20(e1,e))%20type%20family%20HMemberP'%20pred%20e1%20(l%20::%20%5b*%5d)%20pb%20::%20Bool%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20True)%20=%20True%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20False)%20=%20HMemberP%20pred%20e1%20l%20hMember%20::%20HMember%20e%20l%20b%20=%3e%20Proxy%20e%20-%3e%20Proxy%20l%20-%3e%20Proxy%20b%20hMember%20_%20_%20=%20Proxy%20--%20**%20Another%20type-level%20membership%20test%20--%20--%20%7c%20Check%20to%20see%20if%20an%20element%20e%20occurs%20in%20a%20list%20l%20--%20If%20not,%20return%20'Nothing%20--%20If%20the%20element%20does%20occur,%20return%20'Just%20l1%20--%20where%20l1%20is%20a%20type-level%20list%20without%20e%20class%20HMemberM%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r%20::%20Maybe%20%5bk%5d)%20%7c%20e1%20l%20-%3e%20r%20instance%20HMemberM%20e1%20'%5b%5d%20'Nothing%20instance%20(HEq%20e1%20e%20b,%20HMemberM1%20b%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HEq</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMember'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-varid'>br</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMember</span>  <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>br</span>
<a name="line-945"></a><a name="HMember'"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMember'</span> <span class='hs-layout'>(</span><span class='hs-varid'>b0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b0</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-946"></a><a name="instance%20HMember'%20False%20e1%20l%20br%20--%20%7c%20The%20following%20is%20a%20similar%20type-only%20membership%20test%20--%20It%20uses%20the%20user-supplied%20curried%20type%20equality%20predicate%20pred%20type%20family%20HMemberP%20pred%20e1%20(l%20::%20%5b*%5d)%20::%20Bool%20type%20instance%20HMemberP%20pred%20e1%20'%5b%5d%20=%20False%20type%20instance%20HMemberP%20pred%20e1%20(e%20':%20l)%20=%20HMemberP'%20pred%20e1%20l%20(ApplyR%20pred%20(e1,e))%20type%20family%20HMemberP'%20pred%20e1%20(l%20::%20%5b*%5d)%20pb%20::%20Bool%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20True)%20=%20True%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20False)%20=%20HMemberP%20pred%20e1%20l%20hMember%20::%20HMember%20e%20l%20b%20=%3e%20Proxy%20e%20-%3e%20Proxy%20l%20-%3e%20Proxy%20b%20hMember%20_%20_%20=%20Proxy%20--%20**%20Another%20type-level%20membership%20test%20--%20--%20%7c%20Check%20to%20see%20if%20an%20element%20e%20occurs%20in%20a%20list%20l%20--%20If%20not,%20return%20'Nothing%20--%20If%20the%20element%20does%20occur,%20return%20'Just%20l1%20--%20where%20l1%20is%20a%20type-level%20list%20without%20e%20class%20HMemberM%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r%20::%20Maybe%20%5bk%5d)%20%7c%20e1%20l%20-%3e%20r%20instance%20HMemberM%20e1%20'%5b%5d%20'Nothing%20instance%20(HEq%20e1%20e%20b,%20HMemberM1%20b%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMember'</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-conid'>True</span>
<a name="line-947"></a><a name="instance%20HMember'%20False%20e1%20l%20br%20--%20%7c%20The%20following%20is%20a%20similar%20type-only%20membership%20test%20--%20It%20uses%20the%20user-supplied%20curried%20type%20equality%20predicate%20pred%20type%20family%20HMemberP%20pred%20e1%20(l%20::%20%5b*%5d)%20::%20Bool%20type%20instance%20HMemberP%20pred%20e1%20'%5b%5d%20=%20False%20type%20instance%20HMemberP%20pred%20e1%20(e%20':%20l)%20=%20HMemberP'%20pred%20e1%20l%20(ApplyR%20pred%20(e1,e))%20type%20family%20HMemberP'%20pred%20e1%20(l%20::%20%5b*%5d)%20pb%20::%20Bool%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20True)%20=%20True%20type%20instance%20HMemberP'%20pred%20e1%20l%20(Proxy%20False)%20=%20HMemberP%20pred%20e1%20l%20hMember%20::%20HMember%20e%20l%20b%20=%3e%20Proxy%20e%20-%3e%20Proxy%20l%20-%3e%20Proxy%20b%20hMember%20_%20_%20=%20Proxy%20--%20**%20Another%20type-level%20membership%20test%20--%20--%20%7c%20Check%20to%20see%20if%20an%20element%20e%20occurs%20in%20a%20list%20l%20--%20If%20not,%20return%20'Nothing%20--%20If%20the%20element%20does%20occur,%20return%20'Just%20l1%20--%20where%20l1%20is%20a%20type-level%20list%20without%20e%20class%20HMemberM%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r%20::%20Maybe%20%5bk%5d)%20%7c%20e1%20l%20-%3e%20r%20instance%20HMemberM%20e1%20'%5b%5d%20'Nothing%20instance%20(HEq%20e1%20e%20b,%20HMemberM1%20b%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMember</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-varid'>br</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMember'</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-varid'>br</span>
<a name="line-948"></a>
<a name="line-949"></a><span class='hs-comment'>-- | The following is a similar type-only membership test</span>
<a name="line-950"></a><span class='hs-comment'>-- It uses the user-supplied curried type equality predicate pred</span>
<a name="line-951"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HMemberP</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-952"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberP</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-953"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberP</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMemberP'</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplyR</span> <span class='hs-varid'>pred</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-954"></a>
<a name="line-955"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HMemberP'</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>pb</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-956"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberP'</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-957"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberP'</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMemberP</span> <span class='hs-varid'>pred</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span>
<a name="line-958"></a>
<a name="line-959"></a>
<a name="line-960"></a><a name="hMember"></a><span class='hs-definition'>hMember</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HMember</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span>
<a name="line-961"></a><span class='hs-definition'>hMember</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span>
<a name="line-962"></a>
<a name="line-963"></a><a name="HMemberM"></a><span class='hs-comment'>-- ** Another type-level membership test</span>
<a name="line-964"></a><a name="HMemberM"></a><span class='hs-comment'>--</span>
<a name="line-965"></a><a name="HMemberM"></a><span class='hs-comment'>-- | Check to see if an element e occurs in a list l</span>
<a name="line-966"></a><a name="HMemberM"></a><span class='hs-comment'>-- If not, return 'Nothing</span>
<a name="line-967"></a><a name="HMemberM"></a><span class='hs-comment'>-- If the element does occur, return 'Just l1</span>
<a name="line-968"></a><a name="HMemberM"></a><span class='hs-comment'>-- where l1 is a type-level list without e</span>
<a name="line-969"></a><a name="HMemberM"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMemberM</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-970"></a><a name="instance%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberM</span> <span class='hs-varid'>e1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>Nothing</span>
<a name="line-971"></a><a name="instance%20HMemberM%20e1%20(e%20':%20l)%20res%20class%20HMemberM1%20(b::Bool)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM1%20True%20e1%20(e%20':%20l)%20('Just%20l)%20instance%20(HMemberM%20e1%20l%20r,%20HMemberM2%20r%20e1%20(e%20':%20l)%20res)%20=%3e%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HEq</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMemberM1</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-972"></a>      <span class='hs-keyglyph'>=&gt;</span>  <span class='hs-conid'>HMemberM</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>res</span>
<a name="line-973"></a>
<a name="line-974"></a><a name="HMemberM1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMemberM1</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-975"></a><a name="instance%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberM1</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>Just</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-976"></a><a name="instance%20HMemberM1%20False%20e1%20(e%20':%20l)%20res%20class%20HMemberM2%20(b::Maybe%20%5bk%5d)%20(e1%20::%20k)%20(l%20::%20%5bk%5d)%20(r::Maybe%20%5bk%5d)%20%7c%20b%20e1%20l%20-%3e%20r%20instance%20HMemberM2%20Nothing%20e1%20l%20Nothing%20instance%20HMemberM2%20(Just%20l1)%20e1%20(e%20':%20l)%20(Just%20(e%20':%20l1))%20--%20--------------------------------------------------------------------------%20--%20*%20Staged%20equality%20for%20lists%20--%20$note%20removed.%20use%20Typeable%20instead%20%7b-%20--%20*%20Static%20set%20property%20based%20on%20HEq%20class%20HSet%20l%20instance%20HSet%20HNil%20instance%20(HMember%20e%20l%20HFalse,%20HSet%20l)%20=%3e%20HSet%20(HCons%20e%20l)%20-%7d%20--%20*%20Find%20an%20element%20in%20a%20set%20based%20on%20HEq%20--%20%7c%20It%20is%20a%20pure%20type-level%20operation%20class%20HFind1%20e%20l%20n%20=%3e%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMemberM</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>HMemberM2</span> <span class='hs-varid'>r</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-977"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HMemberM1</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>res</span>
<a name="line-978"></a>
<a name="line-979"></a><a name="HFind"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HMemberM2</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-980"></a><a name="instance%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberM2</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-conid'>Nothing</span>
<a name="line-981"></a><a name="instance%20HFind%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HMemberM2</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-982"></a>
<a name="line-983"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-984"></a>
<a name="line-985"></a><span class='hs-comment'>-- * Staged equality for lists</span>
<a name="line-986"></a><span class='hs-comment'>-- $note removed. use Typeable instead</span>
<a name="line-987"></a>
<a name="line-988"></a>
<a name="line-989"></a><span class='hs-comment'>{-
<a name="line-990"></a>-- * Static set property based on HEq
<a name="line-991"></a>class HSet l
<a name="line-992"></a>instance HSet HNil
<a name="line-993"></a>instance (HMember e l HFalse, HSet l) =&gt; HSet (HCons e l)
<a name="line-994"></a>-}</span>
<a name="line-995"></a>
<a name="line-996"></a><a name="HFind"></a><span class='hs-comment'>-- * Find an element in a set based on HEq</span>
<a name="line-997"></a><a name="HFind"></a><span class='hs-comment'>-- | It is a pure type-level operation</span>
<a name="line-998"></a><a name="HFind"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFind1</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFind</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-999"></a><a name="instance%20HFind%20e%20l%20n%20class%20HFind1%20(e%20::%20k)%20(l%20::%20%5bk%5d)%20(n%20::%20HNat)%20%7c%20e%20l%20-%3e%20n%20instance%20(HEq%20e1%20e2%20b,%20HFind2%20b%20e1%20l%20n)%20=%3e%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HFind1</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFind</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span>
<a name="line-1000"></a>
<a name="line-1001"></a><a name="HFind1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFind1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-1002"></a>
<a name="line-1003"></a><a name="instance%20HFind1%20e1%20(e2%20':%20l)%20n%20instance%20Fail%20(FieldNotFound%20e1)%20=%3e%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HEq</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HFind2</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFind1</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>e2</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span>
<a name="line-1004"></a><a name="instance%20HFind1%20e1%20'%5b%5d%20HZero%20class%20HFind2%20(b::Bool)%20(e%20::%20k)%20(l::%5bk%5d)%20(n::%20HNat)%20%7c%20b%20e%20l%20-%3e%20n%20instance%20HFind2%20True%20e%20l%20HZero%20instance%20HFind1%20e%20l%20n%20=%3e%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Fail</span> <span class='hs-layout'>(</span><span class='hs-conid'>FieldNotFound</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFind1</span> <span class='hs-varid'>e1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-conid'>HZero</span>
<a name="line-1005"></a>
<a name="line-1006"></a><a name="HFind2"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HFind2</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-keyglyph'>::</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-1007"></a><a name="instance%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HFind2</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-conid'>HZero</span>
<a name="line-1008"></a><a name="instance%20HFind2%20False%20e%20l%20(HSucc%20n)%20--%20**%20Membership%20test%20based%20on%20type%20equality%20--%20%7c%20could%20be%20an%20associated%20type%20if%20HEq%20had%20one%20class%20HTMember%20e%20(l%20::%20%5b*%5d)%20(b%20::%20Bool)%20%7c%20e%20l%20-%3e%20b%20instance%20HTMember%20e%20'%5b%5d%20False%20instance%20(HEq%20e%20e'%20b,%20HTMember%20e%20l%20b',%20HOr%20b%20b'%20~%20b'')%20=%3e%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HFind1</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HFind2</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-1009"></a>
<a name="line-1010"></a>
<a name="line-1011"></a>
<a name="line-1012"></a><span class='hs-comment'>-- ** Membership test based on type equality</span>
<a name="line-1013"></a>
<a name="line-1014"></a><a name="HTMember"></a><span class='hs-comment'>-- | could be an associated type if HEq had one</span>
<a name="line-1015"></a><a name="HTMember"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HTMember</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-1016"></a><a name="instance%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTMember</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-conid'>False</span>
<a name="line-1017"></a><a name="instance%20HTMember%20e%20(e'%20':%20l)%20b''%20hTMember%20::%20HTMember%20e%20l%20b%20=%3e%20e%20-%3e%20HList%20l%20-%3e%20Proxy%20b%20hTMember%20_%20_%20=%20Proxy%20--%20*%20Intersection%20based%20on%20HTMember%20class%20HTIntersect%20l1%20l2%20l3%20%7c%20l1%20l2%20-%3e%20l3"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HEq</span> <span class='hs-varid'>e</span> <span class='hs-varid'>e'</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>HTMember</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>b'</span><span class='hs-layout'>,</span> <span class='hs-conid'>HOr</span> <span class='hs-varid'>b</span> <span class='hs-varid'>b'</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>b''</span><span class='hs-layout'>)</span>
<a name="line-1018"></a>      <span class='hs-keyglyph'>=&gt;</span>  <span class='hs-conid'>HTMember</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>b''</span>
<a name="line-1019"></a>
<a name="line-1020"></a><a name="hTMember"></a><span class='hs-definition'>hTMember</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HTMember</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span>
<a name="line-1021"></a><span class='hs-definition'>hTMember</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span>
<a name="line-1022"></a>
<a name="line-1023"></a>
<a name="line-1024"></a><span class='hs-comment'>-- * Intersection based on HTMember</span>
<a name="line-1025"></a>
<a name="line-1026"></a><a name="HTIntersect"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HTIntersect</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-varid'>l3</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l3</span>
<a name="line-1027"></a> <span class='hs-keyword'>where</span>
<a name="line-1028"></a>  <span class='hs-comment'>-- | Like 'Data.List.intersect'</span>
<a name="line-1029"></a>  <span class='hs-varid'>hTIntersect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l3</span>
<a name="line-1030"></a>
<a name="line-1031"></a><a name="instance%20HTIntersect%20'%5b%5d%20l%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTIntersect</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>l</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1032"></a> <span class='hs-keyword'>where</span>
<a name="line-1033"></a>  <span class='hs-varid'>hTIntersect</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1034"></a>
<a name="line-1035"></a><a name="instance%20HTIntersect%20(h%20':%20t)%20l1%20l2"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-conid'>HTMember</span> <span class='hs-varid'>h</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>b</span>
<a name="line-1036"></a>         <span class='hs-layout'>,</span> <span class='hs-conid'>HTIntersectBool</span> <span class='hs-varid'>b</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span>
<a name="line-1037"></a>         <span class='hs-layout'>)</span>
<a name="line-1038"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTIntersect</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span>
<a name="line-1039"></a> <span class='hs-keyword'>where</span>
<a name="line-1040"></a>  <span class='hs-varid'>hTIntersect</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hTIntersectBool</span> <span class='hs-varid'>b</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span>
<a name="line-1041"></a>   <span class='hs-keyword'>where</span>
<a name="line-1042"></a>    <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hTMember</span> <span class='hs-varid'>h</span> <span class='hs-varid'>l1</span>
<a name="line-1043"></a>
<a name="line-1044"></a><a name="HTIntersectBool"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HTIntersectBool</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l2</span>
<a name="line-1045"></a> <span class='hs-keyword'>where</span>
<a name="line-1046"></a> <span class='hs-varid'>hTIntersectBool</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>h</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l2</span>
<a name="line-1047"></a>
<a name="line-1048"></a><a name="instance%20HTIntersectBool%20True%20h%20t%20l1%20(h%20':%20l2)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTIntersect</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span>
<a name="line-1049"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTIntersectBool</span> <span class='hs-conid'>True</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-1050"></a> <span class='hs-keyword'>where</span>
<a name="line-1051"></a>  <span class='hs-varid'>hTIntersectBool</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>h</span> <span class='hs-layout'>(</span><span class='hs-varid'>hTIntersect</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span>
<a name="line-1052"></a>
<a name="line-1053"></a><a name="instance%20HTIntersectBool%20False%20h%20t%20l1%20l2"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTIntersect</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span>
<a name="line-1054"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTIntersectBool</span> <span class='hs-conid'>False</span> <span class='hs-varid'>h</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span>
<a name="line-1055"></a> <span class='hs-keyword'>where</span>
<a name="line-1056"></a>  <span class='hs-varid'>hTIntersectBool</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hTIntersect</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l1</span>
<a name="line-1057"></a>
<a name="line-1058"></a>
<a name="line-1059"></a><span class='hs-comment'>-- * Convert between heterogeneous lists and homogeneous ones</span>
<a name="line-1060"></a>
<a name="line-1061"></a><span class='hs-comment'>-- | @hMapOut id@ is similar, except this function is restricted</span>
<a name="line-1062"></a><span class='hs-comment'>-- to HLists that actually contain a value (so the list produced</span>
<a name="line-1063"></a><span class='hs-comment'>-- will be nonempty). This restriction allows adding a functional</span>
<a name="line-1064"></a><span class='hs-comment'>-- dependency, which means that less type annotations can be necessary.</span>
<a name="line-1065"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HList2List</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span>
<a name="line-1066"></a> <span class='hs-keyword'>where</span>
<a name="line-1067"></a>  <span class='hs-varid'>hList2List</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-1068"></a>  <span class='hs-varid'>list2HListSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1069"></a>
<a name="line-1070"></a>
<a name="line-1071"></a><a name="list2HList"></a><span class='hs-definition'>list2HList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList2List</span> <span class='hs-varid'>l</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1072"></a><span class='hs-definition'>list2HList</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>list2HListSuffix</span>
<a name="line-1073"></a>
<a name="line-1074"></a>
<a name="line-1075"></a><a name="instance%20HList2List%20'%5be%5d%20e"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HList2List</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>e</span>
<a name="line-1076"></a> <span class='hs-keyword'>where</span>
<a name="line-1077"></a>  <span class='hs-varid'>hList2List</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-1078"></a>
<a name="line-1079"></a>  <span class='hs-varid'>list2HListSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span>
<a name="line-1080"></a>  <span class='hs-varid'>list2HListSuffix</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-1081"></a>
<a name="line-1082"></a>
<a name="line-1083"></a><a name="instance%20HList2List%20(e%20':%20e'%20':%20l)%20e"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HList2List</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-1084"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HList2List</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>e'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-1085"></a> <span class='hs-keyword'>where</span>
<a name="line-1086"></a>  <span class='hs-varid'>hList2List</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span><span class='hs-conop'>:</span><span class='hs-varid'>hList2List</span> <span class='hs-varid'>l</span>
<a name="line-1087"></a>
<a name="line-1088"></a>  <span class='hs-varid'>list2HListSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>hl</span><span class='hs-layout'>,</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>hl</span><span class='hs-layout'>,</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1089"></a>                                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>list2HListSuffix</span> <span class='hs-varid'>es</span>
<a name="line-1090"></a>  <span class='hs-varid'>list2HListSuffix</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-1091"></a>
<a name="line-1092"></a><a name="listAsHList"></a><span class='hs-comment'>-- | @Prism [s] [t] (HList s) (HList t)@</span>
<a name="line-1093"></a><span class='hs-definition'>listAsHList</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prism</span> <span class='hs-varid'>hList2List</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>list2HListSuffix</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>of</span>
<a name="line-1094"></a>                                 <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>hl</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>hl</span>
<a name="line-1095"></a>                                 <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span>
<a name="line-1096"></a>
<a name="line-1097"></a><a name="listAsHList'"></a><span class='hs-comment'>-- | @Prism' [a] (HList s)@</span>
<a name="line-1098"></a><span class='hs-comment'>--</span>
<a name="line-1099"></a><span class='hs-comment'>-- where @s ~ HReplicateR n a@</span>
<a name="line-1100"></a><span class='hs-definition'>listAsHList'</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>listAsHList</span> <span class='hs-layout'>(</span><span class='hs-varid'>simple</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1101"></a>
<a name="line-1102"></a>
<a name="line-1103"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-1104"></a><span class='hs-comment'>-- * With 'HMaybe'</span>
<a name="line-1105"></a>
<a name="line-1106"></a><span class='hs-comment'>-- ** Turn list in a list of justs</span>
<a name="line-1107"></a><span class='hs-comment'>-- | the same as @map Just@</span>
<a name="line-1108"></a><span class='hs-comment'>--</span>
<a name="line-1109"></a><span class='hs-comment'>-- &gt;&gt;&gt; toHJust (2 .*. 'a' .*. HNil)</span>
<a name="line-1110"></a><span class='hs-comment'>-- H[HJust 2,HJust 'a']</span>
<a name="line-1111"></a><span class='hs-comment'>--</span>
<a name="line-1112"></a><span class='hs-comment'>-- &gt;&gt;&gt; toHJust2 (2 .*. 'a' .*. HNil)</span>
<a name="line-1113"></a><span class='hs-comment'>-- H[HJust 2,HJust 'a']</span>
<a name="line-1114"></a>
<a name="line-1115"></a><a name="ToHJust"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-layout'>(</span><span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ToHJust</span> <span class='hs-varid'>l</span>
<a name="line-1116"></a> <span class='hs-keyword'>where</span>
<a name="line-1117"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1118"></a>  <span class='hs-varid'>toHJust</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1119"></a>
<a name="line-1120"></a><a name="instance%20ToHJust%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ToHJust</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1121"></a> <span class='hs-keyword'>where</span>
<a name="line-1122"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>ToHJustR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1123"></a>  <span class='hs-varid'>toHJust</span> <span class='hs-conid'>HNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1124"></a>
<a name="line-1125"></a><a name="instance%20ToHJust%20(e%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ToHJust</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ToHJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1126"></a> <span class='hs-keyword'>where</span>
<a name="line-1127"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>ToHJustR</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HJust</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>l</span>
<a name="line-1128"></a>  <span class='hs-varid'>toHJust</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHJust</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1129"></a>
<a name="line-1130"></a><a name="toHJust2"></a><span class='hs-comment'>-- | alternative implementation. The Apply instance is in "Data.HList.FakePrelude".</span>
<a name="line-1131"></a><span class='hs-comment'>-- A longer type could be inferred.</span>
<a name="line-1132"></a><span class='hs-definition'>toHJust2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapCxt</span> <span class='hs-varid'>r</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-1133"></a>             <span class='hs-conid'>ToHJust</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>a</span> <span class='hs-comment'>-- added to get equivalent inference</span>
<a name="line-1134"></a>             <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>b</span>
<a name="line-1135"></a><span class='hs-definition'>toHJust2</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-1136"></a>
<a name="line-1137"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-1138"></a><span class='hs-comment'>-- ** Extract justs from list of maybes</span>
<a name="line-1139"></a><span class='hs-comment'>--</span>
<a name="line-1140"></a><span class='hs-comment'>-- &gt;&gt;&gt; let xs = 2 .*. 'a' .*. HNil</span>
<a name="line-1141"></a><span class='hs-comment'>-- &gt;&gt;&gt; fromHJust (toHJust xs) == xs</span>
<a name="line-1142"></a><span class='hs-comment'>-- True</span>
<a name="line-1143"></a>
<a name="line-1144"></a><a name="FromHJust"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromHJustR</span> <span class='hs-layout'>(</span><span class='hs-conid'>ToHJustR</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromHJust</span> <span class='hs-varid'>l</span>
<a name="line-1145"></a> <span class='hs-keyword'>where</span>
<a name="line-1146"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1147"></a>  <span class='hs-varid'>fromHJust</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromHJustR</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1148"></a>
<a name="line-1149"></a><a name="instance%20FromHJust%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromHJust</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1150"></a> <span class='hs-keyword'>where</span>
<a name="line-1151"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1152"></a>  <span class='hs-varid'>fromHJust</span> <span class='hs-conid'>HNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1153"></a>
<a name="line-1154"></a><a name="instance%20FromHJust%20(HNothing%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromHJust</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromHJust</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNothing</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1155"></a> <span class='hs-keyword'>where</span>
<a name="line-1156"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNothing</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-varid'>l</span>
<a name="line-1157"></a>  <span class='hs-varid'>fromHJust</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromHJust</span> <span class='hs-varid'>l</span>
<a name="line-1158"></a>
<a name="line-1159"></a><a name="instance%20FromHJust%20(HJust%20e%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromHJust</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromHJust</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1160"></a> <span class='hs-keyword'>where</span>
<a name="line-1161"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>FromHJustR</span> <span class='hs-varid'>l</span>
<a name="line-1162"></a>  <span class='hs-varid'>fromHJust</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromHJust</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1163"></a>
<a name="line-1164"></a><span class='hs-comment'>-- *** alternative implementation</span>
<a name="line-1165"></a>
<a name="line-1166"></a><a name="fromHJust2"></a><span class='hs-comment'>-- | This implementation is shorter.</span>
<a name="line-1167"></a><span class='hs-definition'>fromHJust2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMapCxt</span> <span class='hs-varid'>r</span> <span class='hs-conid'>HFromJust</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span> <span class='hs-varid'>b</span>
<a name="line-1168"></a><span class='hs-definition'>fromHJust2</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-conid'>HFromJust</span> <span class='hs-varid'>xs</span>
<a name="line-1169"></a>
<a name="line-1170"></a><a name="HFromJust"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HFromJust</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HFromJust</span>
<a name="line-1171"></a><a name="instance%20ApplyAB%20HFromJust%20hJustA%20a"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>hJustA</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HJust</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>HFromJust</span> <span class='hs-varid'>hJustA</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-1172"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HJust</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-1173"></a>
<a name="line-1174"></a>
<a name="line-1175"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-1176"></a><span class='hs-comment'>-- * Annotated lists</span>
<a name="line-1177"></a>
<a name="line-1178"></a><a name="HAddTag"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HAddTag</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HAddTag</span> <span class='hs-varid'>t</span>
<a name="line-1179"></a><a name="HRmTag"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HRmTag</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HRmTag</span>
<a name="line-1180"></a>
<a name="line-1181"></a><a name="hAddTag"></a><span class='hs-comment'>-- hAddTag :: HMapCxt (HAddTag t) l r =&gt; t -&gt; HList l -&gt; HList r</span>
<a name="line-1182"></a><span class='hs-definition'>hAddTag</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAddTag</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-1183"></a>
<a name="line-1184"></a><a name="hRmTag"></a><span class='hs-comment'>-- hRmTag ::  HMapCxt HRmTag l =&gt; HList l -&gt; HList (HMapR HRmTag l)</span>
<a name="line-1185"></a><span class='hs-definition'>hRmTag</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-conid'>HRmTag</span> <span class='hs-varid'>l</span>
<a name="line-1186"></a>
<a name="line-1187"></a><a name="instance%20ApplyAB%20(HAddTag%20t)%20e%20et"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>et</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAddTag</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-varid'>et</span>
<a name="line-1188"></a> <span class='hs-keyword'>where</span>
<a name="line-1189"></a>  <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAddTag</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1190"></a>
<a name="line-1191"></a>
<a name="line-1192"></a><a name="instance%20ApplyAB%20HRmTag%20(e,t)%20e'"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>e'</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>HRmTag</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>e'</span>
<a name="line-1193"></a> <span class='hs-keyword'>where</span>
<a name="line-1194"></a>  <span class='hs-varid'>applyAB</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-1195"></a>
<a name="line-1196"></a>
<a name="line-1197"></a><a name="hFlag"></a><span class='hs-comment'>-- | Annotate list with a type-level Boolean</span>
<a name="line-1198"></a><span class='hs-comment'>--</span>
<a name="line-1199"></a><span class='hs-comment'>-- &gt; hFlag :: HMapCxt (HAddTag (Proxy True)) l r =&gt; HList l -&gt; HList r</span>
<a name="line-1200"></a><span class='hs-definition'>hFlag</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hAddTag</span> <span class='hs-varid'>hTrue</span> <span class='hs-varid'>l</span>
<a name="line-1201"></a>
<a name="line-1202"></a>
<a name="line-1203"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-1204"></a><span class='hs-comment'>-- * Splitting by HTrue and HFalse</span>
<a name="line-1205"></a>
<a name="line-1206"></a><span class='hs-comment'>-- | Analogus to Data.List.'Data.List.partition' 'snd'. See also 'HPartition'</span>
<a name="line-1207"></a><span class='hs-comment'>--</span>
<a name="line-1208"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (.=.) :: p x -&gt; y -&gt; Tagged x y; _ .=. y = Tagged y</span>
<a name="line-1209"></a><span class='hs-comment'>-- &gt;&gt;&gt; hSplit $ hTrue .=. 2 .*. hTrue .=. 3 .*. hFalse .=. 1 .*. HNil</span>
<a name="line-1210"></a><span class='hs-comment'>-- (H[2,3],H[1])</span>
<a name="line-1211"></a><span class='hs-comment'>--</span>
<a name="line-1212"></a><span class='hs-comment'>-- it might make more sense to instead have @LVPair Bool e@</span>
<a name="line-1213"></a><span class='hs-comment'>-- instead of @(e, Proxy Bool)@ since the former has the same</span>
<a name="line-1214"></a><span class='hs-comment'>-- runtime representation as @e@</span>
<a name="line-1215"></a>
<a name="line-1216"></a><a name="HSplit"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HSplit</span> <span class='hs-varid'>l</span>
<a name="line-1217"></a> <span class='hs-keyword'>where</span>
<a name="line-1218"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1219"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1220"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1221"></a>
<a name="line-1222"></a><a name="instance%20HSplit%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplit</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1223"></a> <span class='hs-keyword'>where</span>
<a name="line-1224"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1225"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1226"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-conid'>HNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span><span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1227"></a>
<a name="line-1228"></a><a name="instance%20HSplit%20((e,%20Proxy%20True)%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplit</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplit</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1229"></a> <span class='hs-keyword'>where</span>
<a name="line-1230"></a>
<a name="line-1231"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span>
<a name="line-1232"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span>
<a name="line-1233"></a>
<a name="line-1234"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span>
<a name="line-1235"></a>   <span class='hs-keyword'>where</span>
<a name="line-1236"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplit</span> <span class='hs-varid'>l</span>
<a name="line-1237"></a>
<a name="line-1238"></a><a name="instance%20HSplit%20((e,Proxy%20False)%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplit</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplit</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1239"></a> <span class='hs-keyword'>where</span>
<a name="line-1240"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span>
<a name="line-1241"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-conid'>Proxy</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span>
<a name="line-1242"></a>
<a name="line-1243"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l''</span><span class='hs-layout'>)</span>
<a name="line-1244"></a>   <span class='hs-keyword'>where</span>
<a name="line-1245"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplit</span> <span class='hs-varid'>l</span>
<a name="line-1246"></a>
<a name="line-1247"></a>
<a name="line-1248"></a><a name="instance%20HSplit%20(Tagged%20True%20e%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplit</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1249"></a> <span class='hs-keyword'>where</span>
<a name="line-1250"></a>
<a name="line-1251"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span>
<a name="line-1252"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>True</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span>
<a name="line-1253"></a>
<a name="line-1254"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span>
<a name="line-1255"></a>   <span class='hs-keyword'>where</span>
<a name="line-1256"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplit</span> <span class='hs-varid'>l</span>
<a name="line-1257"></a>
<a name="line-1258"></a><a name="instance%20HSplit%20(Tagged%20False%20e%20':%20l)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplit</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1259"></a> <span class='hs-keyword'>where</span>
<a name="line-1260"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitT</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HSplitT</span> <span class='hs-varid'>l</span>
<a name="line-1261"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>HSplitF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-conid'>False</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HSplitF</span> <span class='hs-varid'>l</span>
<a name="line-1262"></a>
<a name="line-1263"></a>  <span class='hs-varid'>hSplit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>Tagged</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>e</span> <span class='hs-varid'>l''</span><span class='hs-layout'>)</span>
<a name="line-1264"></a>   <span class='hs-keyword'>where</span>
<a name="line-1265"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>l''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplit</span> <span class='hs-varid'>l</span>
<a name="line-1266"></a><span class='hs-comment'>{-
<a name="line-1267"></a>
<a name="line-1268"></a>Let expansion makes a difference to Hugs:
<a name="line-1269"></a>
<a name="line-1270"></a>HListPrelude&gt; let x = (hFlag (HCons "1" HNil)) in hSplit x
<a name="line-1271"></a>(HCons "1" HNil,HNil)
<a name="line-1272"></a>HListPrelude&gt; hSplit (hFlag (HCons "1" HNil))
<a name="line-1273"></a>ERROR - Unresolved overloading
<a name="line-1274"></a>*** Type       : HSplit (HCons ([Char],HTrue) HNil) a b =&gt; (a,b)
<a name="line-1275"></a>*** Expression : hSplit (hFlag (HCons "1" HNil))
<a name="line-1276"></a>
<a name="line-1277"></a>
<a name="line-1278"></a>-}</span>
<a name="line-1279"></a>
<a name="line-1280"></a><span class='hs-comment'>-- --------------------------------------------------------------------------</span>
<a name="line-1281"></a><span class='hs-comment'>-- * Splitting by Length</span>
<a name="line-1282"></a>
<a name="line-1283"></a><a name="HSplitAt"></a><span class='hs-comment'>{- | 'splitAt'
<a name="line-1284"></a>
<a name="line-1285"></a>setup
<a name="line-1286"></a>
<a name="line-1287"></a>&gt;&gt;&gt; let two = hSucc (hSucc hZero)
<a name="line-1288"></a>&gt;&gt;&gt; let xsys = hEnd $ hBuild 1 2 3 4
<a name="line-1289"></a>
<a name="line-1290"></a>If a length is explicitly provided, the resulting lists are inferred
<a name="line-1291"></a>
<a name="line-1292"></a>&gt;&gt;&gt; hSplitAt two xsys
<a name="line-1293"></a>(H[1,2],H[3,4])
<a name="line-1294"></a>
<a name="line-1295"></a>&gt;&gt;&gt; let sameLength_ :: SameLength a b =&gt; r a -&gt; r b -&gt; r a; sameLength_ = const
<a name="line-1296"></a>&gt;&gt;&gt; let len2 x = x `sameLength_` HCons () (HCons () HNil)
<a name="line-1297"></a>
<a name="line-1298"></a>If the first chunk of the list (a) has to be a certain length, the type of the
<a name="line-1299"></a>Proxy argument can be inferred.
<a name="line-1300"></a>
<a name="line-1301"></a>&gt;&gt;&gt; case hSplitAt Proxy xsys of (a,b) -&gt; (len2 a, b)
<a name="line-1302"></a>(H[1,2],H[3,4])
<a name="line-1303"></a>
<a name="line-1304"></a>-}</span>
<a name="line-1305"></a><a name="HSplitAt"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span>
<a name="line-1306"></a>       <span class='hs-conid'>HAppendList1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>xsys</span>
<a name="line-1307"></a>       <span class='hs-layout'>)</span>
<a name="line-1308"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span>
<a name="line-1309"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span>
<a name="line-1310"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xsys</span>
<a name="line-1311"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-1312"></a>                     <span class='hs-keyword'>where</span>
<a name="line-1313"></a>    <span class='hs-varid'>hSplitAt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1314"></a>
<a name="line-1315"></a><a name="instance%20HSplitAt%20n%20xsys%20xs%20ys"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSplitAt1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span><span class='hs-layout'>,</span>
<a name="line-1316"></a>          <span class='hs-conid'>HAppendList1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>xsys</span><span class='hs-layout'>,</span>
<a name="line-1317"></a>          <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-1318"></a>    <span class='hs-conid'>HSplitAt</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyword'>where</span>
<a name="line-1319"></a>      <span class='hs-varid'>hSplitAt</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplitAt1</span> <span class='hs-conid'>HNil</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span>
<a name="line-1320"></a>
<a name="line-1321"></a><a name="HSplitAt1"></a><span class='hs-comment'>-- | helper for 'HSplitAt'</span>
<a name="line-1322"></a><a name="HSplitAt1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HSplitAt1</span> <span class='hs-varid'>accum</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>accum</span> <span class='hs-varid'>n</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyword'>where</span>
<a name="line-1323"></a>    <span class='hs-varid'>hSplitAt1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>accum</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1324"></a>
<a name="line-1325"></a><a name="instance%20HSplitAt1%20accum%20HZero%20ys%20xs%20ys"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HRevApp</span> <span class='hs-varid'>accum</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplitAt1</span> <span class='hs-varid'>accum</span> <span class='hs-conid'>HZero</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyword'>where</span>
<a name="line-1326"></a>    <span class='hs-varid'>hSplitAt1</span> <span class='hs-varid'>xs</span> <span class='hs-sel'>_zero</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>hReverse_</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1327"></a>
<a name="line-1328"></a><a name="instance%20HSplitAt1%20accum%20(HSucc%20n)%20(b%20':%20bs)%20xs%20ys"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSplitAt1</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>accum</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>bs</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span>
<a name="line-1329"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSplitAt1</span> <span class='hs-varid'>accum</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyword'>where</span>
<a name="line-1330"></a>    <span class='hs-varid'>hSplitAt1</span> <span class='hs-varid'>accum</span> <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>b</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSplitAt1</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>b</span> <span class='hs-varid'>accum</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hPred</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>bs</span>
<a name="line-1331"></a>
<a name="line-1332"></a><a name="HLengthEq"></a><span class='hs-comment'>{- | a better way to write @HLength xs ~ n@ because:
<a name="line-1333"></a>
<a name="line-1334"></a>1. it works properly with ghc-7.10 (probably another example of ghc bug #10009)
<a name="line-1335"></a>
<a name="line-1336"></a>2. it works backwards a bit in that if @n@ is known, then @xs@ can be
<a name="line-1337"></a>   refined:
<a name="line-1338"></a>
<a name="line-1339"></a>&gt;&gt;&gt; undefined :: HLengthEq xs HZero =&gt; HList xs
<a name="line-1340"></a>H[]
<a name="line-1341"></a>
<a name="line-1342"></a>-}</span>
<a name="line-1343"></a><a name="HLengthEq"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLength'</span> <span class='hs-layout'>(</span><span class='hs-conid'>HReplicateR</span> <span class='hs-varid'>n</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span>
<a name="line-1344"></a>        <span class='hs-conid'>HLengthEq1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>HLengthEq2</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HNat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-1345"></a>
<a name="line-1346"></a><a name="instance%20HLengthEq%20xs%20n%20class%20HLengthEq1%20(xs%20::%20%5b*%5d)%20n%20--%20pick%20the%20instance%20based%20on%20n's%20constructor%20instance%20(HLengthEq%20xs%20n,%20xxs%20~%20(x%20':%20xs))%20=%3e%20HLengthEq1%20xxs%20(HSucc%20n)%20instance%20(xxs%20~%20'%5b%5d)%20=%3e%20HLengthEq1%20xxs%20HZero%20class%20HLengthEq2%20(xs%20::%20%5b*%5d)%20n%20%7c%20xs%20-%3e%20n%20--%20pick%20the%20instance%20based%20on%20xs'%20constructor%20instance%20(HLengthEq%20xs%20n,%20sn%20~%20HSucc%20n)%20=%3e%20HLengthEq2%20(x%20':%20xs)%20sn%20instance%20zero%20~%20HZero%20=%3e%20HLengthEq2%20'%5b%5d%20zero%20--%20%7c%20@HAppendList1%20xs%20ys%20xsys@%20is%20the%20type-level%20way%20of%20saying%20@xs%20++%20ys%20==%20xsys@%20--%20--%20used%20by%20'HSplitAt'%20class%20HStripPrefix%20xs%20xsys%20ys%20=%3e%20HAppendList1%20(xs%20::%20%5bk%5d)%20(ys%20::%20%5bk%5d)%20(xsys%20::%20%5bk%5d)%20%7c%20xs%20ys%20-%3e%20xsys,%20xs%20xsys%20-%3e%20ys%20--%20,%20ys%20xsys%20-%3e%20xs%20--%20hard%20to%20prove%20instance%20HAppendList1%20'%5b%5d%20ys%20ys%20instance%20(HAppendList1%20xs%20ys%20zs)%20=%3e%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLength'</span> <span class='hs-layout'>(</span><span class='hs-conid'>HReplicateR</span> <span class='hs-varid'>n</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span>
<a name="line-1347"></a>          <span class='hs-conid'>HLengthEq1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>HLengthEq2</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span>
<a name="line-1348"></a>
<a name="line-1349"></a><a name="HLengthEq1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HLengthEq1</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-comment'>-- pick the instance based on n's constructor</span>
<a name="line-1350"></a><a name="instance%20HLengthEq1%20xxs%20(HSucc%20n)%20instance%20(xxs%20~%20'%5b%5d)%20=%3e%20HLengthEq1%20xxs%20HZero%20class%20HLengthEq2%20(xs%20::%20%5b*%5d)%20n%20%7c%20xs%20-%3e%20n%20--%20pick%20the%20instance%20based%20on%20xs'%20constructor%20instance%20(HLengthEq%20xs%20n,%20sn%20~%20HSucc%20n)%20=%3e%20HLengthEq2%20(x%20':%20xs)%20sn%20instance%20zero%20~%20HZero%20=%3e%20HLengthEq2%20'%5b%5d%20zero%20--%20%7c%20@HAppendList1%20xs%20ys%20xsys@%20is%20the%20type-level%20way%20of%20saying%20@xs%20++%20ys%20==%20xsys@%20--%20--%20used%20by%20'HSplitAt'%20class%20HStripPrefix%20xs%20xsys%20ys%20=%3e%20HAppendList1%20(xs%20::%20%5bk%5d)%20(ys%20::%20%5bk%5d)%20(xsys%20::%20%5bk%5d)%20%7c%20xs%20ys%20-%3e%20xsys,%20xs%20xsys%20-%3e%20ys%20--%20,%20ys%20xsys%20-%3e%20xs%20--%20hard%20to%20prove%20instance%20HAppendList1%20'%5b%5d%20ys%20ys%20instance%20(HAppendList1%20xs%20ys%20zs)%20=%3e%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq1</span> <span class='hs-varid'>xxs</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-1351"></a><a name="instance%20HLengthEq1%20xxs%20HZero%20class%20HLengthEq2%20(xs%20::%20%5b*%5d)%20n%20%7c%20xs%20-%3e%20n%20--%20pick%20the%20instance%20based%20on%20xs'%20constructor%20instance%20(HLengthEq%20xs%20n,%20sn%20~%20HSucc%20n)%20=%3e%20HLengthEq2%20(x%20':%20xs)%20sn%20instance%20zero%20~%20HZero%20=%3e%20HLengthEq2%20'%5b%5d%20zero%20--%20%7c%20@HAppendList1%20xs%20ys%20xsys@%20is%20the%20type-level%20way%20of%20saying%20@xs%20++%20ys%20==%20xsys@%20--%20--%20used%20by%20'HSplitAt'%20class%20HStripPrefix%20xs%20xsys%20ys%20=%3e%20HAppendList1%20(xs%20::%20%5bk%5d)%20(ys%20::%20%5bk%5d)%20(xsys%20::%20%5bk%5d)%20%7c%20xs%20ys%20-%3e%20xsys,%20xs%20xsys%20-%3e%20ys%20--%20,%20ys%20xsys%20-%3e%20xs%20--%20hard%20to%20prove%20instance%20HAppendList1%20'%5b%5d%20ys%20ys%20instance%20(HAppendList1%20xs%20ys%20zs)%20=%3e%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>~</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq1</span> <span class='hs-varid'>xxs</span> <span class='hs-conid'>HZero</span>
<a name="line-1352"></a>
<a name="line-1353"></a><a name="HLengthEq2"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HLengthEq2</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-comment'>-- pick the instance based on xs' constructor</span>
<a name="line-1354"></a><a name="instance%20HLengthEq2%20(x%20':%20xs)%20sn%20instance%20zero%20~%20HZero%20=%3e%20HLengthEq2%20'%5b%5d%20zero%20--%20%7c%20@HAppendList1%20xs%20ys%20xsys@%20is%20the%20type-level%20way%20of%20saying%20@xs%20++%20ys%20==%20xsys@%20--%20--%20used%20by%20'HSplitAt'%20class%20HStripPrefix%20xs%20xsys%20ys%20=%3e%20HAppendList1%20(xs%20::%20%5bk%5d)%20(ys%20::%20%5bk%5d)%20(xsys%20::%20%5bk%5d)%20%7c%20xs%20ys%20-%3e%20xsys,%20xs%20xsys%20-%3e%20ys%20--%20,%20ys%20xsys%20-%3e%20xs%20--%20hard%20to%20prove%20instance%20HAppendList1%20'%5b%5d%20ys%20ys%20instance%20(HAppendList1%20xs%20ys%20zs)%20=%3e%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HLengthEq</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>sn</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HSucc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq2</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sn</span>
<a name="line-1355"></a><a name="instance%20HLengthEq2%20'%5b%5d%20zero%20--%20%7c%20@HAppendList1%20xs%20ys%20xsys@%20is%20the%20type-level%20way%20of%20saying%20@xs%20++%20ys%20==%20xsys@%20--%20--%20used%20by%20'HSplitAt'%20class%20HStripPrefix%20xs%20xsys%20ys%20=%3e%20HAppendList1%20(xs%20::%20%5bk%5d)%20(ys%20::%20%5bk%5d)%20(xsys%20::%20%5bk%5d)%20%7c%20xs%20ys%20-%3e%20xsys,%20xs%20xsys%20-%3e%20ys%20--%20,%20ys%20xsys%20-%3e%20xs%20--%20hard%20to%20prove%20instance%20HAppendList1%20'%5b%5d%20ys%20ys%20instance%20(HAppendList1%20xs%20ys%20zs)%20=%3e%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-varid'>zero</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HZero</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HLengthEq2</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>zero</span>
<a name="line-1356"></a>
<a name="line-1357"></a>
<a name="line-1358"></a><a name="HAppendList1"></a><span class='hs-comment'>-- | @HAppendList1 xs ys xsys@ is the type-level way of saying @xs ++ ys == xsys@</span>
<a name="line-1359"></a><a name="HAppendList1"></a><span class='hs-comment'>--</span>
<a name="line-1360"></a><a name="HAppendList1"></a><span class='hs-comment'>-- used by 'HSplitAt'</span>
<a name="line-1361"></a><a name="HAppendList1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HStripPrefix</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>ys</span>
<a name="line-1362"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppendList1</span> <span class='hs-layout'>(</span><span class='hs-varid'>xs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1363"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xsys</span><span class='hs-layout'>,</span>
<a name="line-1364"></a>          <span class='hs-varid'>xs</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ys</span>
<a name="line-1365"></a>          <span class='hs-comment'>-- , ys xsys -&gt; xs</span>
<a name="line-1366"></a>          <span class='hs-comment'>-- hard to prove</span>
<a name="line-1367"></a>
<a name="line-1368"></a><a name="instance%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HAppendList1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>ys</span>
<a name="line-1369"></a><a name="instance%20HAppendList1%20(x%20':%20xs)%20ys%20(x%20':%20zs)%20--%20%7c%20analog%20of%20'Data.List.stripPrefix'%20class%20HStripPrefix%20xs%20xsys%20ys%20%7c%20xs%20xsys%20-%3e%20ys%20instance%20(x'%20~%20x,%20HStripPrefix%20xs%20xsys%20ys)%20=%3e%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HAppendList1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>zs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HAppendList1</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>ys</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>zs</span><span class='hs-layout'>)</span>
<a name="line-1370"></a>
<a name="line-1371"></a>
<a name="line-1372"></a><a name="HStripPrefix"></a><span class='hs-comment'>-- | analog of 'Data.List.stripPrefix'</span>
<a name="line-1373"></a><a name="HStripPrefix"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HStripPrefix</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xsys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ys</span>
<a name="line-1374"></a><a name="instance%20HStripPrefix%20(x'%20':%20xs)%20(x%20':%20xsys)%20ys%20instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>HStripPrefix</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xsys</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HStripPrefix</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xsys</span><span class='hs-layout'>)</span> <span class='hs-varid'>ys</span>
<a name="line-1375"></a><a name="instance%20HStripPrefix%20'%5b%5d%20ys%20ys%20--%20*%20Conversion%20to%20and%20from%20tuples%20class%20HTuple%20v%20t%20%7c%20v%20-%3e%20t,%20t%20-%3e%20v"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HStripPrefix</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>ys</span>
<a name="line-1376"></a>
<a name="line-1377"></a>
<a name="line-1378"></a><span class='hs-comment'>-- * Conversion to and from tuples</span>
<a name="line-1379"></a>
<a name="line-1380"></a><a name="HTuple"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HTuple</span> <span class='hs-varid'>v</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>where</span>
<a name="line-1381"></a>    <span class='hs-comment'>-- | alternatively: @hUncurry (,,,)@</span>
<a name="line-1382"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span>
<a name="line-1383"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>v</span>
<a name="line-1384"></a>
<a name="line-1385"></a><a name="hTuple"></a><span class='hs-comment'>-- | @Iso (HList v) (HList v') a b@</span>
<a name="line-1386"></a><span class='hs-definition'>hTuple</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iso</span> <span class='hs-varid'>hToTuple</span> <span class='hs-varid'>hFromTuple</span> <span class='hs-varid'>x</span>
<a name="line-1387"></a>
<a name="line-1388"></a><a name="hTuple'"></a><span class='hs-comment'>-- | @Iso' (HList v) a@</span>
<a name="line-1389"></a><span class='hs-definition'>hTuple'</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>hTuple</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1390"></a>
<a name="line-1391"></a><a name="instance%20HTuple%20'%5b%5d%20()"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>where</span>
<a name="line-1392"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-conid'>HNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-1393"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1394"></a>
<a name="line-1395"></a><a name="instance%20HTuple%20'%5ba,b%5d%20(a,b)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1396"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-1397"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1398"></a>
<a name="line-1399"></a><a name="instance%20HTuple%20'%5ba,b,c%5d%20(a,b,c)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1400"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1401"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1402"></a>
<a name="line-1403"></a><a name="instance%20HTuple%20'%5ba,b,c,d%5d%20(a,b,c,d)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1404"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-1405"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1406"></a>
<a name="line-1407"></a><a name="instance%20HTuple%20'%5ba,b,c,d,e%5d%20(a,b,c,d,e)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1408"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1409"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1410"></a>
<a name="line-1411"></a><a name="instance%20HTuple%20'%5ba,b,c,d,e,f%5d%20(a,b,c,d,e,f)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTuple</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1412"></a>    <span class='hs-varid'>hToTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>f</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1413"></a>    <span class='hs-varid'>hFromTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>f</span> <span class='hs-varop'>`HCons`</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1414"></a>
<a name="line-1415"></a>
<a name="line-1416"></a><a name="HTails"></a><span class='hs-comment'>-- | 'tails'</span>
<a name="line-1417"></a><a name="HTails"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HTails</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-1418"></a>    <span class='hs-varid'>hTails</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>b</span>
<a name="line-1419"></a>
<a name="line-1420"></a><a name="instance%20HTails%20'%5b%5d%20'%5bHList%20'%5b%5d%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HTails</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-1421"></a>    <span class='hs-varid'>hTails</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-conid'>HNil</span> <span class='hs-conid'>HNil</span>
<a name="line-1422"></a>
<a name="line-1423"></a><a name="instance%20HTails%20(x%20':%20xs)%20(HList%20(x%20':%20xs)%20':%20ys)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HTails</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HTails</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1424"></a>    <span class='hs-varid'>hTails</span> <span class='hs-varid'>xxs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-sel'>_x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>xxs</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hTails</span> <span class='hs-varid'>xs</span>
<a name="line-1425"></a>
<a name="line-1426"></a>
<a name="line-1427"></a><a name="HInits"></a><span class='hs-comment'>-- | 'inits'</span>
<a name="line-1428"></a><a name="HInits"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HInits</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-1429"></a>    <span class='hs-varid'>hInits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>b</span>
<a name="line-1430"></a>
<a name="line-1431"></a><a name="instance%20HInits%20a%20(HList%20'%5b%5d%20':%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HInits1</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HInits</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1432"></a>    <span class='hs-varid'>hInits</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hInits1</span> <span class='hs-varid'>xs</span>
<a name="line-1433"></a>
<a name="line-1434"></a>
<a name="line-1435"></a><a name="HInits1"></a><span class='hs-comment'>-- | behaves like @tail . inits@</span>
<a name="line-1436"></a><a name="HInits1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HInits1</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-1437"></a>    <span class='hs-varid'>hInits1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>b</span>
<a name="line-1438"></a>
<a name="line-1439"></a><a name="instance%20HInits1%20'%5b%5d%20'%5bHList%20'%5b%5d%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HInits1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-1440"></a>    <span class='hs-varid'>hInits1</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-conid'>HNil</span> <span class='hs-conid'>HNil</span>
<a name="line-1441"></a>
<a name="line-1442"></a><a name="instance%20HInits1%20(x%20':%20xs)%20(HList%20'%5bx%5d%20':%20ys')"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HInits1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span><span class='hs-layout'>,</span>
<a name="line-1443"></a>          <span class='hs-conid'>HMapCxt</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>ys'</span><span class='hs-layout'>,</span>
<a name="line-1444"></a>          <span class='hs-conid'>HMapCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>ys'</span><span class='hs-layout'>,</span>
<a name="line-1445"></a>          <span class='hs-conid'>HMapTail</span> <span class='hs-varid'>ys'</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1446"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HInits1</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span>  <span class='hs-varid'>ys'</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1447"></a>    <span class='hs-varid'>hInits1</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-conid'>HNil</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hMap</span> <span class='hs-layout'>(</span><span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hInits1</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-1448"></a>
<a name="line-1449"></a>
<a name="line-1450"></a><a name="FHCons2"></a><span class='hs-comment'>-- | similar to 'FHCons'</span>
<a name="line-1451"></a><a name="FHCons2"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span>
<a name="line-1452"></a>
<a name="line-1453"></a><a name="instance%20ApplyAB%20(FHCons2%20x)%20hxs%20hxxs"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>hxs</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span>
<a name="line-1454"></a>          <span class='hs-varid'>hxxs</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1455"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>hxs</span> <span class='hs-varid'>hxxs</span> <span class='hs-keyword'>where</span>
<a name="line-1456"></a>  <span class='hs-varid'>applyAB</span> <span class='hs-layout'>(</span><span class='hs-conid'>FHCons2</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span>
<a name="line-1457"></a>
<a name="line-1458"></a>
<a name="line-1459"></a><span class='hs-comment'>-- | evidence to satisfy the fundeps in HInits</span>
<a name="line-1460"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HMapCons</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1461"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapCons</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HMapCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b</span>
<a name="line-1462"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapCons</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1463"></a>
<a name="line-1464"></a><span class='hs-comment'>-- | evidence to satisfy the fundeps in HInits</span>
<a name="line-1465"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>HMapTail</span> <span class='hs-layout'>(</span><span class='hs-varid'>xxs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span>
<a name="line-1466"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapTail</span> <span class='hs-layout'>(</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HList</span> <span class='hs-keyword'>as</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-conid'>HMapTail</span> <span class='hs-varid'>bs</span>
<a name="line-1467"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>HMapTail</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span>
<a name="line-1468"></a>
<a name="line-1469"></a>
<a name="line-1470"></a><span class='hs-comment'>-- * partition</span>
<a name="line-1471"></a>
<a name="line-1472"></a><a name="HPartitionEq"></a><span class='hs-comment'>{- | @HPartitionEq f x1 xs xi xo@ is analogous to
<a name="line-1473"></a>
<a name="line-1474"></a>&gt; (xi,xo) = partition (f x1) xs
<a name="line-1475"></a>
<a name="line-1476"></a>where @f@ is a \"function\" passed in using it's instance of 'HEqBy'
<a name="line-1477"></a>-}</span>
<a name="line-1478"></a><a name="HPartitionEq"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyword'>where</span>
<a name="line-1479"></a>    <span class='hs-varid'>hPartitionEq</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span>
<a name="line-1480"></a>
<a name="line-1481"></a><a name="instance%20HPartitionEq%20f%20x1%20'%5b%5d%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-1482"></a>    <span class='hs-varid'>hPartitionEq</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1483"></a>
<a name="line-1484"></a><a name="instance%20HPartitionEq%20f%20x1%20(x%20':%20xs)%20xi%20xo"></a><span class='hs-keyword'>instance</span>
<a name="line-1485"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>HEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-1486"></a>    <span class='hs-conid'>HPartitionEq1</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyword'>where</span>
<a name="line-1487"></a>      <span class='hs-varid'>hPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hPartitionEq1</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span>
<a name="line-1488"></a>
<a name="line-1489"></a><a name="HPartitionEq1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HPartitionEq1</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyword'>where</span>
<a name="line-1490"></a>    <span class='hs-varid'>hPartitionEq1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span>
<a name="line-1491"></a>
<a name="line-1492"></a><a name="instance%20HPartitionEq1%20True%20f%20x1%20x%20xs%20(x%20':%20xi)%20xo"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-1493"></a>    <span class='hs-conid'>HPartitionEq1</span> <span class='hs-conid'>True</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xi</span><span class='hs-layout'>)</span> <span class='hs-varid'>xo</span> <span class='hs-keyword'>where</span>
<a name="line-1494"></a>      <span class='hs-varid'>hPartitionEq1</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>of</span>
<a name="line-1495"></a>         <span class='hs-layout'>(</span><span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span>
<a name="line-1496"></a>
<a name="line-1497"></a><a name="instance%20HPartitionEq1%20False%20f%20x1%20x%20xs%20xi%20(x%20':%20xo)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-varid'>xo</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-1498"></a>    <span class='hs-conid'>HPartitionEq1</span> <span class='hs-conid'>False</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xi</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1499"></a>      <span class='hs-varid'>hPartitionEq1</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hPartitionEq</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x1</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>of</span>
<a name="line-1500"></a>         <span class='hs-layout'>(</span><span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>xi</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>xo</span><span class='hs-layout'>)</span>
<a name="line-1501"></a>
<a name="line-1502"></a>
<a name="line-1503"></a><span class='hs-comment'>-- * groupBy</span>
<a name="line-1504"></a>
<a name="line-1505"></a><a name="HGroupBy"></a><span class='hs-comment'>{- | @HGroupBy f x y@ is analogous to @y = 'groupBy' f x@
<a name="line-1506"></a>
<a name="line-1507"></a>given that @f@ is used by 'HEqBy'
<a name="line-1508"></a>-}</span>
<a name="line-1509"></a><a name="HGroupBy"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HGroupBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyword'>as</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>gs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>gs</span><span class='hs-layout'>,</span> <span class='hs-varid'>gs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>as</span> <span class='hs-keyword'>where</span>
<a name="line-1510"></a>    <span class='hs-varid'>hGroupBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>gs</span>
<a name="line-1511"></a>
<a name="line-1512"></a><a name="instance%20HGroupBy%20f%20(a%20':%20as)%20(HList%20(a%20':%20fst)%20':%20gs)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSpanEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span><span class='hs-layout'>,</span>
<a name="line-1513"></a>          <span class='hs-conid'>HGroupBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>gs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HGroupBy</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>fst</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>gs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1514"></a>    <span class='hs-varid'>hGroupBy</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hSpanEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>of</span>
<a name="line-1515"></a>                      <span class='hs-layout'>(</span><span class='hs-varid'>first</span><span class='hs-layout'>,</span> <span class='hs-varid'>second</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>first</span><span class='hs-layout'>)</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hGroupBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>second</span>
<a name="line-1516"></a>
<a name="line-1517"></a><a name="instance%20HGroupBy%20f%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HGroupBy</span> <span class='hs-varid'>f</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-1518"></a>    <span class='hs-varid'>hGroupBy</span> <span class='hs-sel'>_f</span> <span class='hs-conid'>HNil</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1519"></a>
<a name="line-1520"></a><span class='hs-comment'>-- * span</span>
<a name="line-1521"></a>
<a name="line-1522"></a><a name="HSpanEqBy"></a><span class='hs-comment'>-- | @HSpanEq x y fst snd@ is analogous to @(fst,snd) = 'span' (== x) y@</span>
<a name="line-1523"></a><a name="HSpanEqBy"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HSpanEqBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1524"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span><span class='hs-layout'>,</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>where</span>
<a name="line-1525"></a>  <span class='hs-varid'>hSpanEqBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>fst</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span>
<a name="line-1526"></a>
<a name="line-1527"></a><a name="instance%20HSpanEqBy%20f%20x%20y%20fst%20snd"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span><span class='hs-layout'>,</span>
<a name="line-1528"></a>          <span class='hs-conid'>HAppendListR</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span> <span class='hs-keyglyph'>~</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1529"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSpanEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>snd</span> <span class='hs-keyword'>where</span>
<a name="line-1530"></a>  <span class='hs-varid'>hSpanEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>hSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span>
<a name="line-1531"></a>
<a name="line-1532"></a><a name="HSpanEqBy1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HSpanEqBy1</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>o</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1533"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>i</span> <span class='hs-varid'>o</span> <span class='hs-keyword'>where</span>
<a name="line-1534"></a>  <span class='hs-varid'>hSpanEqBy1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-1535"></a>
<a name="line-1536"></a><a name="HSpanEqBy1"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HSpanEqBy2</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>o</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varop'>*</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1537"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>i</span> <span class='hs-varid'>o</span> <span class='hs-keyword'>where</span>
<a name="line-1538"></a>  <span class='hs-varid'>hSpanEqBy2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-1539"></a>
<a name="line-1540"></a>
<a name="line-1541"></a><a name="instance%20HSpanEqBy1%20f%20x%20(y%20':%20ys)%20i%20o"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>HEqBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<a name="line-1542"></a>          <span class='hs-conid'>HSpanEqBy2</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>i</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span> <span class='hs-varid'>o</span> <span class='hs-keyword'>where</span>
<a name="line-1543"></a>  <span class='hs-varid'>hSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hSpanEqBy2</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1544"></a>
<a name="line-1545"></a><a name="instance%20HSpanEqBy1%20f%20x%20'%5b%5d%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-1546"></a>    <span class='hs-varid'>hSpanEqBy1</span> <span class='hs-sel'>_f</span> <span class='hs-sel'>_x</span> <span class='hs-sel'>_xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1547"></a>
<a name="line-1548"></a><a name="instance%20HSpanEqBy2%20True%20f%20x%20y%20zs%20(y%20':%20i)%20o"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>zs</span> <span class='hs-varid'>i</span> <span class='hs-varid'>o</span>
<a name="line-1549"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HSpanEqBy2</span> <span class='hs-conid'>True</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>zs</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>o</span> <span class='hs-keyword'>where</span>
<a name="line-1550"></a>  <span class='hs-varid'>hSpanEqBy2</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>zs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hSpanEqBy1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>zs</span> <span class='hs-keyword'>of</span>
<a name="line-1551"></a>                                      <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>y</span> <span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-1552"></a>
<a name="line-1553"></a><a name="instance%20HSpanEqBy2%20False%20f%20x%20y%20ys%20'%5b%5d%20(y%20':%20ys)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HSpanEqBy2</span> <span class='hs-conid'>False</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1554"></a>  <span class='hs-varid'>hSpanEqBy2</span> <span class='hs-sel'>_b</span> <span class='hs-sel'>_f</span> <span class='hs-sel'>_x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-conid'>HCons</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1555"></a>
<a name="line-1556"></a>
<a name="line-1557"></a>
<a name="line-1558"></a><span class='hs-comment'>-- * zip</span>
<a name="line-1559"></a>
<a name="line-1560"></a><span class='hs-comment'>-- $note see alternative implementations in "Data.HList.HZip"</span>
<a name="line-1561"></a>
<a name="line-1562"></a>
<a name="line-1563"></a>
<a name="line-1564"></a><a name="instance%20HUnzip%20HList%20x%20y%20xy"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLengths</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span><span class='hs-varid'>xy</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>HZipList</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HUnzip</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span> <span class='hs-keyword'>where</span>
<a name="line-1565"></a>  <span class='hs-varid'>hUnzip</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hUnzipList</span>
<a name="line-1566"></a>
<a name="line-1567"></a><a name="instance%20HZip%20HList%20x%20y%20xy"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLengths</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span><span class='hs-varid'>xy</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>HZipList</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HZip</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>xy</span> <span class='hs-keyword'>where</span>
<a name="line-1568"></a>  <span class='hs-varid'>hZip</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hZipList</span>
<a name="line-1569"></a>
<a name="line-1570"></a>
<a name="line-1571"></a><a name="HZipList"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HZipList</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>where</span>
<a name="line-1572"></a>  <span class='hs-varid'>hZipList</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span>
<a name="line-1573"></a>  <span class='hs-varid'>hUnzipList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1574"></a>
<a name="line-1575"></a><a name="instance%20HZipList%20'%5b%5d%20'%5b%5d%20'%5b%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HZipList</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-chr'>'</span><span class='hs-conid'>[]</span> <span class='hs-keyword'>where</span>
<a name="line-1576"></a>  <span class='hs-varid'>hZipList</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HNil</span>
<a name="line-1577"></a>  <span class='hs-varid'>hUnzipList</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HNil</span><span class='hs-layout'>,</span> <span class='hs-conid'>HNil</span><span class='hs-layout'>)</span>
<a name="line-1578"></a>
<a name="line-1579"></a><a name="instance%20HZipList%20(x%20':%20xs)%20(y%20':%20ys)%20(z%20':%20zs)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>~</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-conid'>HZipList</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span> <span class='hs-varid'>zs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HZipList</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span> <span class='hs-chr'>'</span><span class='hs-conop'>:</span> <span class='hs-varid'>zs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1580"></a>  <span class='hs-varid'>hZipList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-varid'>y</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>hZipList</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>ys</span>
<a name="line-1581"></a>  <span class='hs-varid'>hUnzipList</span> <span class='hs-layout'>(</span><span class='hs-conid'>HCons</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-varid'>zs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-varid'>xs</span><span class='hs-layout'>,</span><span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hUnzipList</span> <span class='hs-varid'>zs</span> <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-varop'>`HCons`</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-1582"></a>
<a name="line-1583"></a><span class='hs-comment'>-- * Monoid instance</span>
<a name="line-1584"></a>
<a name="line-1585"></a><a name="instance%20Monoid%20(HList%20a)"></a><span class='hs-comment'>{- | Analogous to the Monoid instance for tuples
<a name="line-1586"></a>
<a name="line-1587"></a>&gt;&gt;&gt; import Data.Monoid
<a name="line-1588"></a>&gt;&gt;&gt; mempty :: HList '[(), All, [Int]]
<a name="line-1589"></a>H[(),All {getAll = True},[]]
<a name="line-1590"></a>
<a name="line-1591"></a>&gt;&gt;&gt; mappend (hBuild "a") (hBuild "b") :: HList '[String]
<a name="line-1592"></a>H["ab"]
<a name="line-1593"></a>
<a name="line-1594"></a>-}</span>
<a name="line-1595"></a><a name="instance%20Monoid%20(HList%20a)"></a><span class='hs-keyword'>instance</span>
<a name="line-1596"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>HProxies</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span>
<a name="line-1597"></a>    <span class='hs-conid'>HMapCxt</span> <span class='hs-conid'>HList</span> <span class='hs-conid'>ConstMempty</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddProxy</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span>
<a name="line-1598"></a>    <span class='hs-conid'>HZip</span> <span class='hs-conid'>HList</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a</span> <span class='hs-varid'>aa</span><span class='hs-layout'>,</span>
<a name="line-1599"></a>    <span class='hs-conid'>HMapCxt</span> <span class='hs-conid'>HList</span> <span class='hs-conid'>UncurryMappend</span> <span class='hs-varid'>aa</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>HList</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1600"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-conid'>ConstMempty</span>
<a name="line-1601"></a>            <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>hProxies</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HList</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddProxy</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1602"></a>  <span class='hs-varid'>mappend</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hMap</span> <span class='hs-conid'>UncurryMappend</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hZip</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1603"></a>
<a name="line-1604"></a>
<a name="line-1605"></a><span class='hs-comment'>-- ** helper functions</span>
<a name="line-1606"></a>
<a name="line-1607"></a><a name="ConstMempty"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConstMempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConstMempty</span>
<a name="line-1608"></a><a name="instance%20ApplyAB%20ConstMempty%20x%20y"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>ConstMempty</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>where</span>
<a name="line-1609"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-1610"></a>
<a name="line-1611"></a><a name="UncurryMappend"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>UncurryMappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UncurryMappend</span>
<a name="line-1612"></a><a name="instance%20ApplyAB%20UncurryMappend%20aa%20a"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-varid'>aa</span> <span class='hs-keyglyph'>~</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ApplyAB</span> <span class='hs-conid'>UncurryMappend</span> <span class='hs-varid'>aa</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-1613"></a>    <span class='hs-varid'>applyAB</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uncurry</span> <span class='hs-varid'>mappend</span>
<a name="line-1614"></a>
<a name="line-1615"></a>
</pre></body>
</html>
