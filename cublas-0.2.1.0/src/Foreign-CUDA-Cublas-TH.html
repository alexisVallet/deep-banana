<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Foreign/CUDA/Cublas/TH.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE TemplateHaskell #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE ForeignFunctionInterface #-}</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Cublas</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span>
<a name="line-7"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>
<a name="line-8"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&gt;=&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>join</span><span class='hs-layout'>,</span> <span class='hs-varid'>void</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Exts</span> <span class='hs-layout'>(</span><span class='hs-varid'>groupWith</span><span class='hs-layout'>)</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>Haskell</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>TH</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>GCC</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-varid'>isInfixOf</span><span class='hs-layout'>,</span> <span class='hs-varid'>isPrefixOf</span><span class='hs-layout'>,</span> <span class='hs-varid'>isSuffixOf</span><span class='hs-layout'>)</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span> <span class='hs-layout'>(</span><span class='hs-varid'>toLower</span><span class='hs-layout'>,</span> <span class='hs-varid'>toUpper</span><span class='hs-layout'>)</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapMaybe</span><span class='hs-layout'>)</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Debug</span><span class='hs-varop'>.</span><span class='hs-conid'>Trace</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>C</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>F</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Storable</span><span class='hs-varop'>.</span><span class='hs-conid'>Complex</span> <span class='hs-conid'>()</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Complex</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-25"></a>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>FilePath</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;/&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>FC</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Runtime</span><span class='hs-varop'>.</span><span class='hs-conid'>Stream</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>FC</span>
<a name="line-30"></a>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Cublas</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>BL</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Cusparse</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>SP</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Cublas</span><span class='hs-varop'>.</span><span class='hs-conid'>Error</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>BL</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>CUDA</span><span class='hs-varop'>.</span><span class='hs-conid'>Cusparse</span><span class='hs-varop'>.</span><span class='hs-conid'>Error</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>SP</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="try"></a><span class='hs-definition'>try</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Bool</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-37"></a><span class='hs-definition'>try</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>conds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>try</span> <span class='hs-varid'>conds</span>
<a name="line-38"></a><span class='hs-definition'>try</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"TH.try: No match!"</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="TypeInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TypeInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span> 
<a name="line-41"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>ctype</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hsinput</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>Convert</span> <span class='hs-conid'>Create</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hsoutput</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>Convert</span> <span class='hs-conid'>Destroy</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="TypeDat"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TypeDat</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TD</span> 
<a name="line-46"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>ct</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-47"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hst</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> 
<a name="line-48"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>c2hs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-conid'>ExpType</span><span class='hs-layout'>)</span>
<a name="line-49"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hs2c</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-conid'>ExpType</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="ExpType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ExpType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Monadic</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="TypeC"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VoidC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IntC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FloatC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DoubleC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EnumC</span> <span class='hs-conid'>String</span> 
<a name="line-54"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ComplexC</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArbStructC</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PtrC</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PhonyC</span> <span class='hs-conid'>TH</span><span class='hs-varop'>.</span><span class='hs-conid'>Name</span>
<a name="line-55"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArrC</span> <span class='hs-conid'>TypeC</span>
<a name="line-56"></a>           <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-57"></a>
<a name="line-58"></a><a name="prim"></a><span class='hs-definition'>prim</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeDat</span>
<a name="line-59"></a><span class='hs-definition'>prim</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>c2hs</span> <span class='hs-varid'>hs2c</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2hs</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pure</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pure</span><span class='hs-layout'>)</span>
<a name="line-60"></a>
<a name="line-61"></a><a name="simple"></a><span class='hs-definition'>simple</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeDat</span>
<a name="line-62"></a><span class='hs-definition'>simple</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prim</span> <span class='hs-varid'>t</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="bothc"></a><span class='hs-definition'>bothc</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Complex</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Complex</span> <span class='hs-varid'>b</span>
<a name="line-65"></a><span class='hs-definition'>bothc</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-conop'>:+</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:+</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b</span> 
<a name="line-66"></a>
<a name="line-67"></a><a name="typeDat"></a><span class='hs-definition'>typeDat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeDat</span>
<a name="line-68"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>PhonyC</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-layout'>(</span><span class='hs-varid'>varT</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-definition'>typeDat</span> <span class='hs-conid'>VoidC</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> 
<a name="line-70"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>ctype</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-conid'>DevicePtr</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>ctype</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-conid'>DevicePtr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>       <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>useDevicePtr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-71"></a>  <span class='hs-varid'>ctype</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ct</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-72"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-73"></a><span class='hs-definition'>typeDat</span> <span class='hs-conid'>IntC</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>    <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>          <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-74"></a><span class='hs-definition'>typeDat</span> <span class='hs-conid'>FloatC</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>CFloat</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-75"></a><span class='hs-definition'>typeDat</span> <span class='hs-conid'>DoubleC</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simple</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>CDouble</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-76"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>EnumC</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>toEnum</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromEnum</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-77"></a>  <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>str</span> <span class='hs-keyword'>of</span>
<a name="line-78"></a>    <span class='hs-str'>"cublasStatus_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>Status</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-79"></a>    <span class='hs-str'>"cublasOperation_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>Operation</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-80"></a>    <span class='hs-str'>"cublasSideMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>SideMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-81"></a>    <span class='hs-str'>"cublasFillMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>FillMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-82"></a>    <span class='hs-str'>"cublasPointerMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>PointerMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-83"></a>    <span class='hs-str'>"cublasAtomicsMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>AtomicsMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-84"></a>    <span class='hs-str'>"cublasDiagType_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>DiagType</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-85"></a>
<a name="line-86"></a>    <span class='hs-str'>"cusparseStatus_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Status</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-87"></a>    <span class='hs-str'>"cusparseOperation_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Operation</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-88"></a>    <span class='hs-str'>"cusparseDirection_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-89"></a>    <span class='hs-str'>"cusparseHybPartition_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>HybPartition</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-90"></a>    <span class='hs-str'>"cusparseFillMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>FillMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-91"></a>    <span class='hs-str'>"cusparsePointerMode_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>PointerMode</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-92"></a>    <span class='hs-str'>"cusparseDiagType_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>DiagType</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-93"></a>    <span class='hs-str'>"cusparseIndexBase_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>IndexBase</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-94"></a>    <span class='hs-str'>"cusparseAction_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Action</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-95"></a>    <span class='hs-str'>"cusparseMatrixType_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>MatrixType</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-96"></a>    <span class='hs-str'>"cusparseSolvePolicy_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>SolvePolicy</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-97"></a>
<a name="line-98"></a>    <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>error</span> <span class='hs-layout'>(</span><span class='hs-str'>"typeDat.EnumC : Missing type: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span>
<a name="line-99"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArbStructC</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>str</span> <span class='hs-keyword'>of</span>
<a name="line-100"></a>  <span class='hs-str'>"cublasHandle_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>Handle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-conid'>Handle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-varid'>useHandle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-101"></a>  <span class='hs-str'>"cusparseHandle_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Handle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Handle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useHandle</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-102"></a>  <span class='hs-str'>"cusparseHybMat_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>HybMat</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>HybMat</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useHybMat</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-103"></a>  <span class='hs-str'>"cusparseMatDescr_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>MatDescr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>MatDescr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useMatDescr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-104"></a>  <span class='hs-str'>"cusparseSolveAnalysisInfo_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>SolveAnalysisInfo</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>SolveAnalysisInfo</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useSolveAnalysisInfo</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-105"></a>  <span class='hs-str'>"csrsv2Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useCsrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-106"></a>  <span class='hs-str'>"csric02Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useCsric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-107"></a>  <span class='hs-str'>"csrilu02Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Csrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useCsrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-108"></a>  <span class='hs-str'>"bsrsv2Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useBsrsv2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-109"></a>  <span class='hs-str'>"bsric02Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useBsric02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-110"></a>  <span class='hs-str'>"bsrilu02Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useBsrilu02Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-111"></a>  <span class='hs-str'>"bsrsm2Info_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrsm2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-conid'>Bsrsm2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>useBsrsm2Info</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-112"></a>
<a name="line-113"></a>  <span class='hs-str'>"cudaStream_t"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prim</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-conid'>Stream</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-conid'>Stream</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>useStream</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-114"></a><span class='hs-definition'>typeDat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ComplexC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prim</span>
<a name="line-115"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>Complex</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>ctype</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-116"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>Complex</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hstype</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-117"></a>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>bothc</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>fromC</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-118"></a>  <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>bothc</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>toC</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-119"></a>  <span class='hs-keyword'>where</span>
<a name="line-120"></a>  <span class='hs-conid'>TD</span> <span class='hs-varid'>ctype</span> <span class='hs-varid'>hstype</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromC</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pure</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toC</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pure</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span>
<a name="line-121"></a>
<a name="line-122"></a>
<a name="line-123"></a><a name="convertT"></a><span class='hs-definition'>convertT</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-124"></a><a name="createT"></a><span class='hs-definition'>createT</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Create</span>
<a name="line-125"></a><a name="destroyT"></a><span class='hs-definition'>destroyT</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Destroy</span>
<a name="line-126"></a>
<a name="line-127"></a><a name="Convert"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Convert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>)</span>
<a name="line-128"></a><a name="Create"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Create</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Create</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>)</span>
<a name="line-129"></a><a name="Destroy"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Destroy</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Destroy</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>)</span>
<a name="line-130"></a>
<a name="line-131"></a><a name="pointerify"></a><span class='hs-definition'>pointerify</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-132"></a><span class='hs-definition'>pointerify</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-133"></a>
<a name="line-134"></a><a name="useT"></a><span class='hs-definition'>useT</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeInfo</span>
<a name="line-135"></a><span class='hs-definition'>useT</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>useT'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>typeDat</span> <span class='hs-keyword'>where</span>
<a name="line-136"></a>  <span class='hs-varid'>useT'</span> <span class='hs-layout'>(</span><span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>c2hs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>,</span><span class='hs-varid'>purity</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span>
<a name="line-137"></a>    <span class='hs-varid'>ct</span>
<a name="line-138"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-139"></a>    <span class='hs-conid'>Nothing</span>
<a name="line-140"></a>    <span class='hs-keyword'>where</span>
<a name="line-141"></a>    <span class='hs-varid'>exp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hs2c</span>
<a name="line-142"></a>
<a name="line-143"></a><a name="inT"></a><span class='hs-definition'>inT</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeInfo</span>
<a name="line-144"></a><span class='hs-definition'>inT</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inT'</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-145"></a>  <span class='hs-varid'>inT'</span> <span class='hs-layout'>(</span><span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>c2hs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>,</span><span class='hs-varid'>purity</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span>
<a name="line-146"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pointerify</span> <span class='hs-varid'>ct</span><span class='hs-layout'>)</span>
<a name="line-147"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-148"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>destroyT</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>free</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-149"></a>    <span class='hs-keyword'>where</span>
<a name="line-150"></a>    <span class='hs-varid'>exp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>new</span> <span class='hs-varop'>.</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>undefined</span>
<a name="line-151"></a><span class='hs-definition'>inT</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inT'</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-152"></a>  <span class='hs-varid'>inT'</span> <span class='hs-layout'>(</span><span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>c2hs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>,</span><span class='hs-varid'>purity</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span>
<a name="line-153"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pointerify</span> <span class='hs-varid'>ct</span><span class='hs-layout'>)</span>
<a name="line-154"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>[</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hst</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-155"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>destroyT</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>free</span> <span class='hs-varop'>.</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-conid'>DevicePtr</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-156"></a>    <span class='hs-keyword'>where</span>
<a name="line-157"></a>    <span class='hs-varid'>exp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>fmap</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>useDevicePtr</span> <span class='hs-varop'>.</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>newListArray</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>undefined</span>
<a name="line-158"></a>
<a name="line-159"></a><a name="outT"></a><span class='hs-definition'>outT</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeInfo</span>
<a name="line-160"></a><span class='hs-definition'>outT</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>outT'</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-161"></a>  <span class='hs-varid'>outT'</span> <span class='hs-layout'>(</span><span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2hs</span><span class='hs-layout'>,</span><span class='hs-varid'>purity</span><span class='hs-layout'>)</span> <span class='hs-varid'>hs2c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span>
<a name="line-162"></a>    <span class='hs-varid'>ct</span>
<a name="line-163"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>createT</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>malloc</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-164"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-varid'>hst</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>peek</span> <span class='hs-varid'>p</span> <span class='hs-layout'>;</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>free</span> <span class='hs-varid'>p</span><span class='hs-layout'>;</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-165"></a>    <span class='hs-keyword'>where</span>
<a name="line-166"></a>    <span class='hs-varid'>exp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>c2hs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c2hs</span>
<a name="line-167"></a>
<a name="line-168"></a><a name="inOutT"></a><span class='hs-definition'>inOutT</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeInfo</span>
<a name="line-169"></a><span class='hs-definition'>inOutT</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inOutT'</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-170"></a>  <span class='hs-varid'>inOutT'</span> <span class='hs-layout'>(</span><span class='hs-conid'>TD</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>hst</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2hs</span><span class='hs-layout'>,</span><span class='hs-varid'>purity1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>,</span><span class='hs-varid'>purity2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TI</span>
<a name="line-171"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pointerify</span> <span class='hs-varid'>ct</span><span class='hs-layout'>)</span>
<a name="line-172"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-varid'>hst</span> <span class='hs-varid'>exp1</span><span class='hs-layout'>)</span>
<a name="line-173"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>convertT</span> <span class='hs-varid'>hst</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>peek</span> <span class='hs-varid'>p</span> <span class='hs-layout'>;</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>free</span> <span class='hs-varid'>p</span><span class='hs-layout'>;</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>exp2</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-174"></a>    <span class='hs-keyword'>where</span>
<a name="line-175"></a>    <span class='hs-varid'>exp1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity1</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-varid'>new</span> <span class='hs-varop'>.</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>hs2c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hs2c</span>
<a name="line-176"></a>    <span class='hs-varid'>exp2</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>purity2</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Pure</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>c2hs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>;</span> <span class='hs-conid'>Monadic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c2hs</span>
<a name="line-177"></a>
<a name="line-178"></a><a name="convert"></a><span class='hs-definition'>convert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CTypeSpecifier</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-179"></a><span class='hs-definition'>convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>CVoidType</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VoidC</span>
<a name="line-180"></a><span class='hs-comment'>--CCharType a	 </span>
<a name="line-181"></a><span class='hs-comment'>--CShortType a	 </span>
<a name="line-182"></a><span class='hs-definition'>convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>CIntType</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>IntC</span>
<a name="line-183"></a><span class='hs-comment'>--CLongType a	 </span>
<a name="line-184"></a><span class='hs-definition'>convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFloatType</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FloatC</span>
<a name="line-185"></a><span class='hs-definition'>convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDoubleType</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DoubleC</span>
<a name="line-186"></a><span class='hs-comment'>--CSignedType a	 </span>
<a name="line-187"></a><span class='hs-comment'>--CUnsigType a	 </span>
<a name="line-188"></a><span class='hs-comment'>--CBoolType a	 </span>
<a name="line-189"></a><span class='hs-comment'>--CComplexType a</span>
<a name="line-190"></a><span class='hs-definition'>convert</span> <span class='hs-layout'>(</span><span class='hs-conid'>CTypeDef</span> <span class='hs-varid'>ident</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> 
<a name="line-191"></a>  <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>`elem`</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"cublasHandle_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"cusparseHybMat_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"cusparseHandle_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"cusparseMatDescr_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"cusparseSolveAnalysisInfo_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"cudaStream_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"csrsv2Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"csric02Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"csrilu02Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"bsrsv2Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"bsric02Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"bsrilu02Info_t"</span><span class='hs-layout'>,</span> <span class='hs-str'>"bsrsm2Info_t"</span> <span class='hs-keyglyph'>]</span> <span class='hs-layout'>,</span> <span class='hs-conid'>ArbStructC</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-192"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-varop'>==</span><span class='hs-str'>"cuComplex"</span><span class='hs-layout'>,</span> <span class='hs-conid'>ComplexC</span> <span class='hs-conid'>FloatC</span><span class='hs-layout'>)</span>
<a name="line-193"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-varop'>==</span><span class='hs-str'>"cuDoubleComplex"</span><span class='hs-layout'>,</span> <span class='hs-conid'>ComplexC</span> <span class='hs-conid'>DoubleC</span><span class='hs-layout'>)</span>
<a name="line-194"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span><span class='hs-layout'>,</span> <span class='hs-conid'>EnumC</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-195"></a>  <span class='hs-keyword'>where</span>
<a name="line-196"></a>  <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>identToString</span> <span class='hs-varid'>ident</span>
<a name="line-197"></a><span class='hs-definition'>convert</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VoidC</span>
<a name="line-198"></a>
<a name="line-199"></a><a name="convert'"></a><span class='hs-definition'>convert'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CDeclarationSpecifier</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-200"></a><span class='hs-definition'>convert'</span> <span class='hs-layout'>(</span><span class='hs-conid'>CTypeSpec</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>convert</span> <span class='hs-varid'>x</span>
<a name="line-201"></a><span class='hs-definition'>convert'</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>convert'</span> <span class='hs-varid'>xs</span>
<a name="line-202"></a><span class='hs-definition'>convert'</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"convert': invalid CDeclarationSpecifier list"</span>
<a name="line-203"></a>
<a name="line-204"></a><a name="typeOf"></a><span class='hs-definition'>typeOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-205"></a><span class='hs-definition'>typeOf</span> <span class='hs-varid'>proj</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-varid'>basetype</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>ident</span><span class='hs-layout'>)</span> <span class='hs-varid'>ptrs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-206"></a>  <span class='hs-varid'>foldr</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>proj</span> <span class='hs-varop'>$</span> <span class='hs-varid'>convert'</span> <span class='hs-varid'>basetype</span><span class='hs-layout'>)</span> <span class='hs-varid'>ptrs</span>
<a name="line-207"></a>  <span class='hs-keyword'>where</span>
<a name="line-208"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>CPtrDeclr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>F</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-209"></a>  <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"haven't implemented other things"</span>
<a name="line-210"></a>
<a name="line-211"></a><a name="pointerification"></a><span class='hs-definition'>pointerification</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span><span class='hs-layout'>)</span>
<a name="line-212"></a><span class='hs-definition'>pointerification</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ptrs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>id</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>f</span> <span class='hs-varid'>ptrs</span> <span class='hs-keyword'>where</span>
<a name="line-213"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>CPtrDeclr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PtrC</span>
<a name="line-214"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>CArrDeclr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ArrC</span>
<a name="line-215"></a>  <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-comment'>--possible there are other things that should be here?</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="baseType"></a><span class='hs-definition'>baseType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-218"></a><span class='hs-definition'>baseType</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-varid'>basetype</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>convert'</span> <span class='hs-varid'>basetype</span>
<a name="line-219"></a>
<a name="line-220"></a><a name="cType"></a><span class='hs-definition'>cType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-221"></a><span class='hs-definition'>cType</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>pointerification</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>baseType</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-222"></a>  
<a name="line-223"></a>
<a name="line-224"></a><a name="typeInfo"></a><span class='hs-definition'>typeInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeInfo</span>
<a name="line-225"></a><span class='hs-definition'>typeInfo</span> <span class='hs-varid'>fn</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>typec</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>typec</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span>
<a name="line-226"></a>  <span class='hs-keyglyph'>[</span> <span class='hs-comment'>{- CUBLAS -}</span>
<a name="line-227"></a>    <span class='hs-layout'>(</span><span class='hs-keyword'>case</span> <span class='hs-varid'>typec</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>ArrC</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-228"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>inT</span><span class='hs-layout'>)</span>
<a name="line-229"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>`elem`</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"alpha"</span><span class='hs-layout'>,</span> <span class='hs-str'>"beta"</span><span class='hs-layout'>,</span> <span class='hs-str'>"a"</span><span class='hs-layout'>,</span> <span class='hs-str'>"b"</span><span class='hs-layout'>,</span> <span class='hs-str'>"c"</span><span class='hs-layout'>,</span> <span class='hs-str'>"d1"</span><span class='hs-layout'>,</span> <span class='hs-str'>"d2"</span><span class='hs-layout'>,</span> <span class='hs-str'>"x1"</span><span class='hs-layout'>,</span> <span class='hs-str'>"y1"</span><span class='hs-layout'>,</span> <span class='hs-str'>"s"</span><span class='hs-keyglyph'>]</span>
<a name="line-230"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>inT</span><span class='hs-layout'>)</span>
<a name="line-231"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span> <span class='hs-str'>"create"</span> <span class='hs-varop'>`isPrefixOf`</span> <span class='hs-varid'>fn</span> <span class='hs-varop'>||</span> <span class='hs-varid'>n</span> <span class='hs-varop'>==</span> <span class='hs-str'>"result"</span>
<a name="line-232"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>outT</span><span class='hs-layout'>)</span>
<a name="line-233"></a>    <span class='hs-comment'>{- CuSPARSE -}</span>
<a name="line-234"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-str'>"DevHostPtr"</span> <span class='hs-varop'>`isSuffixOf`</span> <span class='hs-varid'>n</span>
<a name="line-235"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>outT</span><span class='hs-layout'>)</span>
<a name="line-236"></a>    <span class='hs-comment'>{- End -}</span>
<a name="line-237"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span>
<a name="line-238"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>useT</span><span class='hs-layout'>)</span>
<a name="line-239"></a>  <span class='hs-keyglyph'>]</span>
<a name="line-240"></a>
<a name="line-241"></a><a name="declName"></a><span class='hs-definition'>declName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-242"></a><span class='hs-definition'>declName</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>ident</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>identToString</span> <span class='hs-varid'>ident</span><span class='hs-layout'>)</span>
<a name="line-243"></a><span class='hs-definition'>declName</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-244"></a>
<a name="line-245"></a><a name="outMarshall"></a><span class='hs-definition'>outMarshall</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>
<a name="line-246"></a><span class='hs-definition'>outMarshall</span> <span class='hs-layout'>(</span><span class='hs-conid'>EnumC</span> <span class='hs-str'>"cublasStatus_t"</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>BL</span><span class='hs-varop'>.</span><span class='hs-varid'>resultIfOk</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-247"></a><span class='hs-definition'>outMarshall</span> <span class='hs-layout'>(</span><span class='hs-conid'>EnumC</span> <span class='hs-str'>"cusparseStatus_t"</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>SP</span><span class='hs-varop'>.</span><span class='hs-varid'>resultIfOk</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-248"></a><span class='hs-definition'>outMarshall</span> <span class='hs-conid'>VoidC</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-249"></a><span class='hs-definition'>outMarshall</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>const</span> <span class='hs-layout'>(</span><span class='hs-varid'>hst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>typeDat</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-250"></a>
<a name="line-251"></a>
<a name="line-252"></a>
<a name="line-253"></a><a name="createf'"></a><span class='hs-definition'>createf'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>CFunction</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span>
<a name="line-254"></a><span class='hs-definition'>createf'</span> <span class='hs-layout'>(</span><span class='hs-varid'>foreignname</span><span class='hs-layout'>,</span> <span class='hs-varid'>cf</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>fname</span><span class='hs-layout'>,</span> <span class='hs-varid'>rettype</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-255"></a>  <span class='hs-varid'>ins</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeName</span> <span class='hs-str'>"_in"</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-256"></a>  <span class='hs-varid'>toCs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeName</span> <span class='hs-str'>"_out"</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-257"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>outstatements</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>outtypes</span><span class='hs-layout'>,</span> <span class='hs-varid'>outs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varid'>unzip</span> <span class='hs-varop'>.</span> <span class='hs-varid'>filterMaybes</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unzip</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>collect</span> <span class='hs-layout'>(</span><span class='hs-varid'>zip3</span> <span class='hs-varid'>args</span> <span class='hs-varid'>argsTI</span> <span class='hs-varid'>toCs</span><span class='hs-layout'>)</span>
<a name="line-258"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>instatements</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>inMarsh</span> <span class='hs-layout'>(</span><span class='hs-varid'>zip3</span> <span class='hs-varid'>argsTI</span> <span class='hs-varid'>ins</span> <span class='hs-varid'>toCs</span><span class='hs-layout'>)</span>
<a name="line-259"></a>  <span class='hs-varid'>ret</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newName</span> <span class='hs-str'>"res"</span>
<a name="line-260"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>runstatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bindS</span> <span class='hs-layout'>(</span><span class='hs-varid'>varP</span> <span class='hs-varid'>ret</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>foldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-varid'>toCs</span><span class='hs-layout'>)</span>
<a name="line-261"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>returnstatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>checkStatusExp</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>outputConv</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>ret</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>tupE</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>varE</span> <span class='hs-varid'>outs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-262"></a>  <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>doE</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>instatements</span><span class='hs-layout'>,</span> <span class='hs-varid'>runstatement</span><span class='hs-conop'>:</span><span class='hs-varid'>outstatements</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>noBindS</span> <span class='hs-varid'>returnstatement</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-263"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>usedins</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>isused</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>zip</span> <span class='hs-varid'>argsTI</span> <span class='hs-varid'>ins</span>
<a name="line-264"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>fdec</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunD</span> <span class='hs-varid'>fcall</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Clause</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>VarP</span> <span class='hs-varid'>usedins</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>NormalB</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span>
<a name="line-265"></a>  <span class='hs-varid'>tdec</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sigD</span> <span class='hs-varid'>fcall</span> <span class='hs-varop'>$</span> <span class='hs-varid'>funTypeMod</span> <span class='hs-varid'>checkStatusType</span> <span class='hs-varid'>argsTI</span>
<a name="line-266"></a>  <span class='hs-varid'>return</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>tdec</span><span class='hs-layout'>,</span> <span class='hs-varid'>fdec</span><span class='hs-keyglyph'>]</span>
<a name="line-267"></a>  <span class='hs-keyword'>where</span>
<a name="line-268"></a>  <span class='hs-varid'>safeName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>TH</span><span class='hs-varop'>.</span><span class='hs-conid'>Name</span>
<a name="line-269"></a>  <span class='hs-varid'>safeName</span> <span class='hs-varid'>end</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-conop'>:</span><span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>newName</span> <span class='hs-layout'>(</span><span class='hs-varid'>toLower</span> <span class='hs-varid'>s</span> <span class='hs-conop'>:</span> <span class='hs-varid'>str</span> <span class='hs-varop'>++</span> <span class='hs-varid'>end</span><span class='hs-layout'>)</span>
<a name="line-270"></a>
<a name="line-271"></a>  <span class='hs-varid'>argsTI</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>functionTypeInfo</span> <span class='hs-varid'>cf</span>
<a name="line-272"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>outputConv</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c2hs</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeDat</span> <span class='hs-varid'>rettype</span><span class='hs-layout'>)</span>
<a name="line-273"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>checkStatusExp</span><span class='hs-layout'>,</span> <span class='hs-varid'>checkStatusType</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>outMarshall</span> <span class='hs-varid'>rettype</span>
<a name="line-274"></a>  <span class='hs-varid'>isused</span> <span class='hs-layout'>(</span><span class='hs-conid'>TI</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-275"></a>  <span class='hs-varid'>isused</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-276"></a>  <span class='hs-varid'>fcall</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkName</span> <span class='hs-varid'>fname</span>
<a name="line-277"></a>  <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>varE</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-varid'>foreignname</span><span class='hs-layout'>)</span>
<a name="line-278"></a>  <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>appE</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-279"></a>  <span class='hs-varid'>inMarsh</span> <span class='hs-layout'>(</span><span class='hs-varid'>ti</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>hsinput</span> <span class='hs-varid'>ti</span> <span class='hs-keyword'>of</span>
<a name="line-280"></a>    <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>bindS</span> <span class='hs-layout'>(</span><span class='hs-varid'>varP</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>appE</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-281"></a>    <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>Create</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>bindS</span> <span class='hs-layout'>(</span><span class='hs-varid'>varP</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-282"></a>  <span class='hs-varid'>collect</span> <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-conid'>TI</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>cleanup</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-283"></a>    <span class='hs-varid'>e'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>safeName</span> <span class='hs-str'>"_out"</span> <span class='hs-varid'>arg</span>
<a name="line-284"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>outinfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>cleanup</span> <span class='hs-keyword'>of</span>
<a name="line-285"></a>          <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>bindS</span> <span class='hs-layout'>(</span><span class='hs-varid'>varP</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>appE</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-286"></a>          <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>Destroy</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-layout'>(</span><span class='hs-varid'>noBindS</span> <span class='hs-layout'>(</span><span class='hs-varid'>appE</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>varE</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-287"></a>    <span class='hs-varid'>ys</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>collect</span> <span class='hs-varid'>xs</span>
<a name="line-288"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>outinfo</span><span class='hs-conop'>:</span><span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
<a name="line-289"></a>  <span class='hs-varid'>collect</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect</span> <span class='hs-varid'>xs</span>
<a name="line-290"></a>  <span class='hs-varid'>collect</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span>
<a name="line-291"></a>  <span class='hs-varid'>collecti</span> <span class='hs-layout'>(</span><span class='hs-conid'>TI</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-292"></a>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span>
<a name="line-293"></a>  <span class='hs-varid'>collecti</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-294"></a>
<a name="line-295"></a>
<a name="line-296"></a><a name="cublasFile"></a><span class='hs-definition'>cublasFile</span><span class='hs-layout'>,</span> <span class='hs-varid'>cusparseFile</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span>
<a name="line-297"></a><span class='hs-definition'>cublasFile</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CUDA_INCLUDE_DIR</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"cublas_v2.h"</span>
<a name="line-298"></a><a name="cusparseFile"></a><span class='hs-definition'>cusparseFile</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CUDA_INCLUDE_DIR</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"cusparse_v2.h"</span>
<a name="line-299"></a>
<a name="line-300"></a>
<a name="line-301"></a><a name="filterMaybes"></a><span class='hs-definition'>filterMaybes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-302"></a><span class='hs-definition'>filterMaybes</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-303"></a><span class='hs-definition'>filterMaybes</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-conop'>:</span> <span class='hs-varid'>filterMaybes</span> <span class='hs-varid'>xs</span>
<a name="line-304"></a><span class='hs-definition'>filterMaybes</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterMaybes</span> <span class='hs-varid'>xs</span>
<a name="line-305"></a>
<a name="line-306"></a>
<a name="line-307"></a><a name="funname"></a><span class='hs-definition'>funname</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-308"></a><span class='hs-definition'>funname</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>ident</span> <span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>identToString</span> <span class='hs-varid'>ident</span>
<a name="line-309"></a><span class='hs-definition'>funname</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Weird!"</span>
<a name="line-310"></a>
<a name="line-311"></a><a name="desired"></a><span class='hs-definition'>desired</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CFunction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-312"></a><span class='hs-definition'>desired</span> <span class='hs-varid'>prefix</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-313"></a>    <span class='hs-varid'>any</span> <span class='hs-layout'>(</span><span class='hs-varop'>`isPrefixOf`</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>prefix</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-str'>"Get"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-str'>"SDCZX"</span><span class='hs-layout'>)</span>
<a name="line-314"></a>
<a name="line-315"></a><a name="infol"></a><span class='hs-definition'>infol</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Show</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span>  <span class='hs-conid'>CDerivedDeclarator</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-316"></a><span class='hs-definition'>infol</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunDeclr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-varid'>ys</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>f</span> <span class='hs-varid'>ys</span> <span class='hs-keyword'>where</span>
<a name="line-317"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-varid'>specs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>show</span> <span class='hs-varid'>specs</span>
<a name="line-318"></a><span class='hs-definition'>infol</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-319"></a>
<a name="line-320"></a><a name="funArgs"></a><span class='hs-definition'>funArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclarator</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-321"></a><span class='hs-definition'>funArgs</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>CFunDeclr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-varid'>ys</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>ys</span>
<a name="line-322"></a><span class='hs-definition'>funArgs</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-323"></a>
<a name="line-324"></a><a name="funDecl"></a><span class='hs-definition'>funDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclarator</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-325"></a><span class='hs-definition'>funDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>declarator</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>declarator</span>
<a name="line-326"></a><span class='hs-definition'>funDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-327"></a>
<a name="line-328"></a><a name="maybeFunction"></a><span class='hs-definition'>maybeFunction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunction</span><span class='hs-layout'>)</span>
<a name="line-329"></a><span class='hs-definition'>maybeFunction</span> <span class='hs-varid'>d</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>CDecl</span> <span class='hs-varid'>returnType</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-330"></a>  <span class='hs-varid'>args</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>funArgs</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>funDecl</span> <span class='hs-varid'>d</span>
<a name="line-331"></a>  <span class='hs-varid'>retName</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>declName</span> <span class='hs-varid'>d</span>
<a name="line-332"></a>  <span class='hs-varid'>argNames</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>declName</span> <span class='hs-varid'>args</span>
<a name="line-333"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>argTypes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>cType</span> <span class='hs-varid'>args</span>
<a name="line-334"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>retName</span><span class='hs-layout'>,</span> <span class='hs-varid'>convert'</span> <span class='hs-varid'>returnType</span><span class='hs-layout'>,</span> <span class='hs-varid'>zip</span> <span class='hs-varid'>argNames</span> <span class='hs-varid'>argTypes</span> <span class='hs-layout'>)</span>
<a name="line-335"></a>
<a name="line-336"></a><a name="maybeExternalDec"></a><span class='hs-definition'>maybeExternalDec</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CExternalDeclaration</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclaration</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-337"></a><span class='hs-definition'>maybeExternalDec</span> <span class='hs-layout'>(</span><span class='hs-conid'>CDeclExt</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>d</span>
<a name="line-338"></a><span class='hs-definition'>maybeExternalDec</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-339"></a>
<a name="line-340"></a><a name="CVar"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CVar</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>TypeC</span><span class='hs-layout'>)</span>
<a name="line-341"></a><a name="CFunction"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CFunction</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span> <span class='hs-conid'>String</span> <span class='hs-layout'>,</span> <span class='hs-conid'>TypeC</span> <span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CVar</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>)</span>
<a name="line-342"></a>
<a name="line-343"></a><a name="getFunctions"></a><span class='hs-definition'>getFunctions</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CFunction</span><span class='hs-keyglyph'>]</span>
<a name="line-344"></a><span class='hs-definition'>getFunctions</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-345"></a>  <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>CTranslUnit</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parseCFile</span> <span class='hs-layout'>(</span><span class='hs-varid'>newGCC</span> <span class='hs-str'>"/usr/bin/gcc"</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>fp</span>
<a name="line-346"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>maybeExternalDec</span> <span class='hs-varop'>&gt;=&gt;</span> <span class='hs-varid'>maybeFunction</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-347"></a>
<a name="line-348"></a><a name="createf"></a><span class='hs-definition'>createf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CFunction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Dec</span>
<a name="line-349"></a><span class='hs-definition'>createf</span> <span class='hs-varid'>fp</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-350"></a>  <span class='hs-varid'>forImpD</span> <span class='hs-varid'>cCall</span> <span class='hs-keyword'>safe</span><span class='hs-comment'>{-unsafe-}</span> <span class='hs-layout'>(</span><span class='hs-varid'>fp</span> <span class='hs-varop'>++</span> <span class='hs-chr'>' '</span><span class='hs-conop'>:</span><span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varid'>cFunType</span>
<a name="line-351"></a>  <span class='hs-keyword'>where</span>
<a name="line-352"></a>  <span class='hs-varid'>cFunType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>f</span> <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>ct</span> <span class='hs-varop'>.</span> <span class='hs-varid'>typeDat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-353"></a>  <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>IO</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>ct</span> <span class='hs-varop'>.</span> <span class='hs-varid'>typeDat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ret</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-354"></a>  <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-355"></a>
<a name="line-356"></a>
<a name="line-357"></a><a name="sharedDecs"></a><span class='hs-definition'>sharedDecs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CFunction</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>CFunction</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-358"></a><span class='hs-definition'>sharedDecs</span> <span class='hs-varid'>prefix</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>xs''</span> <span class='hs-keyword'>where</span>
<a name="line-359"></a>  <span class='hs-varid'>g</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-varid'>ret</span><span class='hs-layout'>,</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-360"></a>    <span class='hs-varid'>newname</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>dropc</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>goodName</span> <span class='hs-varid'>prefix</span> <span class='hs-varid'>s</span>
<a name="line-361"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>newname</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-362"></a>  <span class='hs-varid'>xs'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapMaybe</span> <span class='hs-varid'>g</span> <span class='hs-varid'>xs</span>
<a name="line-363"></a>  <span class='hs-varid'>fst3</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>
<a name="line-364"></a>  <span class='hs-varid'>dropc</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>last</span> <span class='hs-varid'>name</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'c'</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>init</span> <span class='hs-varid'>name</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>name</span> <span class='hs-comment'>--for dot, ger, ...</span>
<a name="line-365"></a>  <span class='hs-varid'>xs''</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst3</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>head</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span>
<a name="line-366"></a>    <span class='hs-varid'>filter</span> <span class='hs-varid'>sdFilter</span> <span class='hs-varop'>.</span> <span class='hs-varid'>groupWith</span> <span class='hs-layout'>(</span><span class='hs-varid'>tail</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst3</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>xs'</span>
<a name="line-367"></a>  <span class='hs-varid'>sdFilter</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>xs</span> <span class='hs-varop'>==</span> <span class='hs-num'>4</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span>
<a name="line-368"></a>    <span class='hs-varid'>any</span> <span class='hs-layout'>(</span><span class='hs-varop'>`isInfixOf`</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"rot_v2"</span><span class='hs-layout'>,</span> <span class='hs-str'>"rotg_v2"</span><span class='hs-layout'>,</span> <span class='hs-str'>"hybsv_analysis"</span><span class='hs-layout'>,</span> <span class='hs-str'>"numericBoost"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>)</span>
<a name="line-369"></a>
<a name="line-370"></a><a name="mkClass"></a><span class='hs-definition'>mkClass</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CFunction</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Dec</span>
<a name="line-371"></a><span class='hs-definition'>mkClass</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>prefix</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>classD</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>className</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PlainTV</span> <span class='hs-varid'>typeName</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>decs</span> <span class='hs-keyword'>where</span>
<a name="line-372"></a>  <span class='hs-varid'>className</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkName</span> <span class='hs-layout'>(</span><span class='hs-varid'>toUpper</span> <span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>prefix</span><span class='hs-layout'>)</span>
<a name="line-373"></a>  <span class='hs-varid'>typeName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkName</span> <span class='hs-str'>"a"</span>
<a name="line-374"></a>  <span class='hs-varid'>decs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>phonifyF</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-375"></a>  <span class='hs-varid'>mkPhony</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypeC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-376"></a>  <span class='hs-varid'>mkPhony</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PtrC</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkPhony</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-377"></a>  <span class='hs-varid'>mkPhony</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArrC</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ArrC</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkPhony</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-378"></a>  <span class='hs-varid'>mkPhony</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>t'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PhonyC</span> <span class='hs-varid'>typeName</span> <span class='hs-keyword'>in</span>
<a name="line-379"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>DoubleC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t'</span><span class='hs-layout'>;</span> <span class='hs-conid'>FloatC</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t'</span><span class='hs-layout'>;</span> <span class='hs-conid'>ComplexC</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t'</span><span class='hs-layout'>;</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>y</span>
<a name="line-380"></a>  <span class='hs-varid'>phonifyF</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CFunction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CFunction</span>
<a name="line-381"></a>  <span class='hs-varid'>phonifyF</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPhony</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varid'>mkPhony</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-382"></a>  <span class='hs-varid'>f</span> <span class='hs-varid'>cfunc</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sigD</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkName</span> <span class='hs-layout'>(</span><span class='hs-varid'>tail</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>funType</span> <span class='hs-varop'>$</span> <span class='hs-varid'>functionTypeInfo</span> <span class='hs-varid'>cfunc</span><span class='hs-layout'>)</span>
<a name="line-383"></a>
<a name="line-384"></a><a name="mkClassInstances"></a><span class='hs-definition'>mkClassInstances</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span><span class='hs-conid'>CFunction</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span>
<a name="line-385"></a><span class='hs-definition'>mkClassInstances</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>prefix</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>makeInstance</span> <span class='hs-varid'>c</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-str'>"sdcz"</span> <span class='hs-keyword'>where</span>
<a name="line-386"></a>  <span class='hs-varid'>makeInstance</span> <span class='hs-varid'>c</span> <span class='hs-varid'>decs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>instanceD</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>classSig</span> <span class='hs-layout'>(</span><span class='hs-varid'>decs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-387"></a>    <span class='hs-varid'>classSig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>appT</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-conid'>ConT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkName</span> <span class='hs-layout'>(</span><span class='hs-varid'>toUpper</span> <span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>prefix</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ct</span> <span class='hs-varop'>.</span> <span class='hs-varid'>typeDat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>typeMap</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-388"></a>  <span class='hs-varid'>f</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>funcs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>!!</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>createf'</span> <span class='hs-layout'>(</span><span class='hs-varid'>foreignn</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-389"></a>    <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>foreignn</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-conop'>:</span><span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-varop'>==</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>funcs</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="typeMap"></a><span class='hs-definition'>typeMap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypeC</span>
<a name="line-392"></a><span class='hs-definition'>typeMap</span> <span class='hs-chr'>'c'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ComplexC</span> <span class='hs-conid'>FloatC</span>
<a name="line-393"></a><span class='hs-definition'>typeMap</span> <span class='hs-chr'>'z'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ComplexC</span> <span class='hs-conid'>DoubleC</span>
<a name="line-394"></a><span class='hs-definition'>typeMap</span> <span class='hs-chr'>'d'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DoubleC</span>
<a name="line-395"></a><span class='hs-definition'>typeMap</span> <span class='hs-chr'>'s'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FloatC</span>
<a name="line-396"></a><span class='hs-definition'>typeMap</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"typeMap: Invalid character"</span>
<a name="line-397"></a>
<a name="line-398"></a><a name="makeClassDecs"></a><span class='hs-definition'>makeClassDecs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-399"></a><span class='hs-definition'>makeClassDecs</span> <span class='hs-varid'>str</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-400"></a>  <span class='hs-varid'>sds</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sharedDecs</span> <span class='hs-varid'>str</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getFunctions</span> <span class='hs-varid'>fp</span>
<a name="line-401"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sequence</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkClass</span> <span class='hs-varid'>str</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>head</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varid'>sds</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>mkClassInstances</span> <span class='hs-varid'>str</span> <span class='hs-varid'>sds</span><span class='hs-layout'>)</span>
<a name="line-402"></a>
<a name="line-403"></a><a name="makeFFIDecs"></a><span class='hs-definition'>makeFFIDecs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-404"></a><span class='hs-definition'>makeFFIDecs</span> <span class='hs-varid'>str</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sequence</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>createf</span> <span class='hs-varid'>fp</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>desired</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getFunctions</span> <span class='hs-varid'>fp</span>
<a name="line-405"></a>
<a name="line-406"></a><a name="makeAllFuncs"></a><span class='hs-definition'>makeAllFuncs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-407"></a><span class='hs-definition'>makeAllFuncs</span> <span class='hs-varid'>str</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>concat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>sequence</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>createf'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>alter</span><span class='hs-layout'>)</span><span class='hs-varop'>.</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>desired</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getFunctions</span> <span class='hs-varid'>fp</span> <span class='hs-keyword'>where</span>
<a name="line-408"></a>  <span class='hs-varid'>alter</span> <span class='hs-layout'>(</span><span class='hs-varid'>fname</span><span class='hs-layout'>,</span> <span class='hs-varid'>rettype</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-409"></a>    <span class='hs-varid'>newname</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>goodName</span> <span class='hs-varid'>str</span> <span class='hs-varid'>fname</span>
<a name="line-410"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fname</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>newname</span><span class='hs-layout'>,</span> <span class='hs-varid'>rettype</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-411"></a>
<a name="line-412"></a><a name="goodName"></a><span class='hs-definition'>goodName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-413"></a><span class='hs-definition'>goodName</span> <span class='hs-varid'>prefix</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>where</span>
<a name="line-414"></a>  <span class='hs-varid'>v2suff</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"_v2"</span>
<a name="line-415"></a>  <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>prefix</span>
<a name="line-416"></a>  <span class='hs-varid'>f</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>pre</span> <span class='hs-varop'>==</span> <span class='hs-varid'>prefix</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>toLower</span> <span class='hs-varid'>x</span> <span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Nothing</span>
<a name="line-417"></a>    <span class='hs-keyword'>where</span>
<a name="line-418"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pre</span><span class='hs-layout'>,</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitAt</span> <span class='hs-varid'>l</span> <span class='hs-varid'>str</span>
<a name="line-419"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>name'</span><span class='hs-layout'>,</span> <span class='hs-varid'>v2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>name</span> <span class='hs-comment'>-</span> <span class='hs-varid'>length</span> <span class='hs-varid'>v2suff</span><span class='hs-layout'>)</span> <span class='hs-varid'>name</span>
<a name="line-420"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-conop'>:</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>v2</span> <span class='hs-varop'>==</span> <span class='hs-varid'>v2suff</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>name'</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>name</span>
<a name="line-421"></a>
<a name="line-422"></a><a name="doIO"></a><span class='hs-definition'>doIO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-423"></a><span class='hs-definition'>doIO</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>join</span> <span class='hs-varop'>.</span> <span class='hs-varid'>runIO</span>
<a name="line-424"></a>
<a name="line-425"></a><a name="inTypes"></a><span class='hs-definition'>inTypes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TypeInfo</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>
<a name="line-426"></a><span class='hs-definition'>inTypes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapMaybe</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>where</span>
<a name="line-427"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>TI</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>t</span>
<a name="line-428"></a>  <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-429"></a>
<a name="line-430"></a><a name="outTypes"></a><span class='hs-definition'>outTypes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TypeInfo</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>
<a name="line-431"></a><span class='hs-definition'>outTypes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapMaybe</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>where</span>
<a name="line-432"></a>  <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>TI</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Convert</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>t</span>
<a name="line-433"></a>  <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-434"></a>
<a name="line-435"></a><a name="functionTypeInfo"></a><span class='hs-definition'>functionTypeInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CFunction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TypeInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-436"></a><span class='hs-definition'>functionTypeInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>fname</span><span class='hs-layout'>,</span> <span class='hs-varid'>ret</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeInfo</span> <span class='hs-varid'>fname</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-437"></a>
<a name="line-438"></a><a name="funTypeMod"></a><span class='hs-definition'>funTypeMod</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TypeInfo</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-439"></a><span class='hs-definition'>funTypeMod</span> <span class='hs-varid'>f</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>z</span> <span class='hs-varid'>ins</span> <span class='hs-keyword'>where</span>
<a name="line-440"></a>  <span class='hs-varid'>arrow</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-441"></a>  <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>IO</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span> <span class='hs-varid'>f</span> <span class='hs-varop'>$</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>appT</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleT</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>outs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>outs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-442"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>ins</span><span class='hs-layout'>,</span> <span class='hs-varid'>outs</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>inTypes</span><span class='hs-layout'>,</span> <span class='hs-varid'>outTypes</span><span class='hs-keyglyph'>]</span>
<a name="line-443"></a>
<a name="line-444"></a><a name="funType"></a><span class='hs-definition'>funType</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TypeInfo</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span>
<a name="line-445"></a><span class='hs-definition'>funType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>funTypeMod</span> <span class='hs-varid'>id</span>
</pre></body>
</html>
